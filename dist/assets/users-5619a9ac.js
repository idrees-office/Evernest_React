import{W as u,u as X,r as o,s as G,X as d,S as b,j as t,a as r}from"./index-9dd09a4e.js";import{o as E}from"./status-5b7b9adf.js";import{S as F}from"./react-select.esm-c2a6b27f.js";import{I as J}from"./IconTrashLines-2fbdee87.js";import{I as K}from"./IconPencil-5169c7e7.js";import{T as Z}from"./Table-a324c4ee.js";import"./IconThumbUp-56591cb9.js";import"./IconTrash-4b3a5361.js";import"./objectWithoutPropertiesLoose-f3b3ace0.js";import"./extends-4c19d496.js";import"./floating-ui.dom.browser.min-b8726d47.js";import"./index-2bbd50e4.js";const m={createApi:`${u()}/users/create_user`,roleApi:`${u()}/users/get_user_role`,listApi:`${u()}/users/user_list`,destoryApi:`${u()}/users/delete_user`,updateApi:`${u()}/users/update_user`},me=()=>{const v=X(),c=o.useRef({userformRef:null}),[T,D]=o.useState([]),[U,_]=o.useState(null),[a,R]=o.useState({}),[$,k]=o.useState(null),[B,p]=o.useState(null),A=o.useRef(!1),[f,g]=o.useState(1),[w,I]=o.useState(10),[j,L]=o.useState(0),[h,O]=o.useState({columnAccessor:"client_user_id",direction:"asc"}),[x,z]=o.useState("");o.useEffect(()=>{A.current||(v(G("Create User")),Q(),A.current=!0),N()},[v,f,w,h,x]);const Q=async()=>{var e;try{const s=await d.get(m.roleApi);if(s.data){const n=s.data.map(l=>({value:l.id,label:l.name}));k(n)}}catch(s){((e=s.response)==null?void 0:e.status)===403&&(window.location.href="/error")}},N=async()=>{var e;try{const s={page:f,per_page:w,sort_field:h.columnAccessor,sort_order:h.direction,search:x},n=await d.get(m.listApi,{params:s});n.data&&(D(n.data.data||[]),L(n.data.total||0))}catch(s){((e=s.response)==null?void 0:e.status)===403&&(window.location.href="/error"),S()}},Y=async e=>{var s,n,l;e.preventDefault();try{if(c.current.userformRef){const i=new FormData(c.current.userformRef),P=i.get("client_user_id"),y=P?await d.post(`${m.updateApi}/${P}`,i):await d.post(m.createApi,i);(y.status===200||y.status===201)&&(C(y.data.message),N(),R({}),c.current.userformRef.reset(),p(null),_(null))}}catch(i){(n=(s=i.response)==null?void 0:s.data)!=null&&n.errors?R(i.response.data.errors):((l=i.response)==null?void 0:l.status)===403?window.location.href="/error":S()}},C=e=>{b.fire({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,title:e,icon:"success"})},S=()=>{b.fire({text:"Something went wrong on the server",icon:"error",title:"Server Error"})},q=async e=>{if(c.current.userformRef){const s=c.current.userformRef;s.reset(),s.client_user_id.value=e.client_user_id||"",s.client_user_name.value=e.client_user_name||"",s.client_user_email.value=e.client_user_email||"",s.client_user_phone.value=e.client_user_phone||"",s.client_user_designation.value=e.client_user_designation||"",s.client_sort_order.value=e.client_sort_order||"",_(e.client_user_status||"");const n=e.roles&&e.roles[0];if(n){const l={value:n.id,label:n.name};p(l)}else p(null)}},H=async e=>{var n;if((await b.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",cancelButtonText:"No, cancel!"})).isConfirmed)try{const l=await d.delete(m.destoryApi+`/${e.client_user_id}`);(l.status===200||l.status===201)&&(C("User deleted successfully"),N())}catch(l){((n=l.response)==null?void 0:n.status)===403&&(window.location.href="/error"),S()}},M=e=>{p(e)},V=e=>{z(e.target.value),g(1)},W=[{accessor:"id",title:"#",sortable:!0,width:80,key:"id"},{accessor:"client_user_name",title:"Name",sortable:!0,key:"name"},{accessor:"client_user_email",title:"Email",sortable:!0,key:"email"},{accessor:"roles",title:"Role",sortable:!0,key:"role",render:e=>{var s;return t("span",{children:((s=e.roles[0])==null?void 0:s.name)||"N/A"})}},{accessor:"actions",title:"Actions",width:120,key:"actions",render:e=>r("div",{className:"flex space-x-2",children:[t("button",{type:"button",onClick:()=>q(e),className:"btn px-1 py-0.5 rounded text-white bg-info",children:t(K,{})},"edit"),t("button",{type:"button",onClick:()=>H(e),className:"btn px-1 py-0.5 rounded text-white bg-red-600",children:t(J,{})},"delete")]})}];return t("form",{ref:e=>c.current.userformRef=e,onSubmit:Y,className:"space-y-5",children:r("div",{className:"flex flex-wrap -mx-4",children:[t("div",{className:"w-full lg:w-1/3 px-4",children:t("div",{className:"panel",children:t("div",{className:"panel-body",children:r("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[r("div",{className:"form-group",children:[t("label",{htmlFor:"client_user_name",children:"Username"}),t("input",{name:"client_user_name",type:"text",placeholder:"Username",className:"form-input"}),t("input",{type:"hidden",name:"client_user_id",id:"client_user_id"}),a.client_user_name&&r("span",{className:"text-red-500 text-sm",children:[" ",a.client_user_name," "]},"name-error")]}),r("div",{className:"form-group",children:[t("label",{htmlFor:"client_user_phone",children:"Phone"}),t("input",{name:"client_user_phone",type:"tel",placeholder:"Phone",className:"form-input"}),a.client_user_phone&&r("span",{className:"text-red-500 text-sm",children:[" ",a.client_user_phone," "]},"phone-error")]}),r("div",{className:"form-group",children:[t("label",{htmlFor:"client_user_designation",children:"Designation"}),t("input",{name:"client_user_designation",type:"text",placeholder:"Designation",className:"form-input"}),a.client_user_designation&&r("span",{className:"text-red-500 text-sm",children:[" ",a.client_user_designation," "]},"designation-error")]}),r("div",{className:"form-group",children:[t("label",{htmlFor:"client_user_email",children:"Email"}),t("input",{name:"client_user_email",type:"email",placeholder:"Email",className:"form-input"}),a.client_user_email&&r("span",{className:"text-red-500 text-sm",children:[" ",a.client_user_email," "]},"email-error")]}),r("div",{className:"form-group",children:[t("label",{htmlFor:"password",children:"Password"}),t("input",{name:"password",type:"password",placeholder:"Password",className:"form-input"}),a.password&&r("span",{className:"text-red-500 text-sm",children:[" ",a.password," "]},"password-error")]}),r("div",{className:"form-group",children:[t("label",{htmlFor:"client_user_status",children:"Status"}),t(F,{name:"client_user_status",placeholder:"Select an option",options:E,value:E.find(e=>e.value===U),onChange:e=>_((e==null?void 0:e.value)||null)}),a.client_user_status&&r("span",{className:"text-red-500 text-sm",children:[" ",a.client_user_status," "]},"status-error")]}),r("div",{className:"form-group",children:[t("label",{htmlFor:"client_sort_order",children:"Sort Order"}),t("input",{name:"client_sort_order",type:"text",placeholder:"Sort Order",className:"form-input"}),a.client_sort_order&&r("span",{className:"text-red-500 text-sm",children:[" ",a.client_sort_order," "]},"sortorder-error")]}),r("div",{className:"form-group",children:[t("label",{htmlFor:"role_id",children:"Role"}),t(F,{name:"role_id",placeholder:"Select an option",options:$||[],value:B,onChange:M}),a.role_id&&r("span",{className:"text-red-500 text-sm",children:[" ",a.role_id," "]},"roleId-error")]}),t("div",{className:"sm:col-span-2 flex justify-end",children:t("button",{type:"submit",className:"btn btn-primary",children:"Submit"})})]})})})}),t("div",{className:"w-full lg:w-2/3 px-2 mt-6 lg:mt-0 md-mt-0",children:t("div",{className:"datatables",children:t(Z,{columns:W,rows:T,title:"Detail of the all users",totalRecords:j,currentPage:f,recordsPerPage:w,onPageChange:e=>g(e),onRecordsPerPageChange:e=>{I(e),g(1)},onSortChange:O,onSearchChange:V,sortStatus:h,isLoading:!1,minHeight:200,noRecordsText:"No users found",searchValue:x})})})]})})};export{me as default};
