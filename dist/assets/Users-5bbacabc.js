import{X as h,u as de,r as o,s as ue,Y as _,b as t,j as a,A as me,S as R}from"./index-d59f277c.js";import{o as U,e as k,d as I}from"./status-503f0e18.js";import{S as N}from"./react-select.esm-4368b147.js";import{I as pe}from"./IconTrashLines-1b03c55f.js";import{I as he}from"./IconPencil-ec8e8150.js";import{T as _e}from"./Table-4c9b24cf.js";import{F as j}from"./index-1facbe79.js";/* empty css                  *//* empty css                  */import"./IconSquareCheck-9a8f19e9.js";import"./IconStar-11bacbfc.js";import"./IconTrash-d7895fd8.js";import"./objectWithoutPropertiesLoose-f3b3ace0.js";import"./extends-4c19d496.js";import"./floating-ui.dom.browser.min-b8726d47.js";import"./index-42c94d87.js";const f={createApi:`${h()}/users/create_user`,roleApi:`${h()}/users/get_user_role?for_select=1`,listApi:`${h()}/users/user_list`,destoryApi:`${h()}/users/delete_user`,updateApi:`${h()}/users/update_user`},Ee=()=>{const P=de(),d=o.useRef({userformRef:null}),[E,$]=o.useState([]),[B,x]=o.useState(null);o.useState(null);const[n,F]=o.useState({}),[Y,z]=o.useState(null),[H,g]=o.useState(null),A=o.useRef(!1),[v,w]=o.useState(1),[S,L]=o.useState(10),[O,J]=o.useState(0),[y,Q]=o.useState({columnAccessor:"client_user_id",direction:"asc"}),[T,X]=o.useState(""),[fe,q]=o.useState([]),[M,V]=o.useState(null),[ge,G]=o.useState(null),[ye,K]=o.useState(null);o.useEffect(()=>{A.current||(P(ue("Create User")),W(),A.current=!0)},[P]),o.useEffect(()=>{C()},[v,S,y,T]);const W=async()=>{var e;try{const s=await _.get(f.roleApi);if(s.data){const r=s.data.map(l=>({value:l.id,label:l.name}));z(r)}}catch(s){((e=s.response)==null?void 0:e.status)===403&&(window.location.href="/error")}},C=async()=>{var e;try{const s={page:v,per_page:S,sort_field:y.columnAccessor,sort_order:y.direction,search:T},r=await _.get(f.listApi,{params:s});if(r.data){const l=r.data.data.data||[];$(l);const i=r.data.users.filter(b=>{var u;return(u=b.roles)==null?void 0:u.some(p=>p.name==="Team Head")});console.log(i),q(i),J(r.data.data.total||0)}}catch(s){((e=s.response)==null?void 0:e.status)===403&&(window.location.href="/error")}},Z=async e=>{var s,r,l;e.preventDefault();try{if(d.current.userformRef){const i=new FormData(d.current.userformRef);c.forEach((p,be)=>{p.file&&(i.append("user_files[]",p.file),i.append("documentType[]",p.documentType||""))});const b=i.get("client_user_id"),u=b?await _.post(`${f.updateApi}/${b}`,i):await _.post(f.createApi,i);(u.status===200||u.status===201)&&(D(u.data.message),C(),F({}),d.current.userformRef.reset(),g(null),x(null))}}catch(i){(r=(s=i.response)==null?void 0:s.data)!=null&&r.errors?F(i.response.data.errors):((l=i.response)==null?void 0:l.status)===403&&(window.location.href="/error")}},D=e=>{R.fire({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,title:e,icon:"success"})},ee=async e=>{if(d.current.userformRef){const s=d.current.userformRef;s.reset(),s.client_user_id.value=e.client_user_id||"",s.client_user_name.value=e.client_user_name||"",s.client_user_email.value=e.client_user_email||"",s.client_user_phone.value=e.client_user_phone||"",s.client_user_designation.value=e.client_user_designation||"",s.client_sort_order.value=e.client_sort_order||"",x(e.client_user_status||"");const r=e.roles&&e.roles[0];if(r){const l={value:r.id,label:r.name};g(l)}else g(null)}},te=async e=>{var r;if((await R.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",cancelButtonText:"No, cancel!"})).isConfirmed)try{const l=await _.delete(f.destoryApi+`/${e.client_user_id}`);(l.status===200||l.status===201)&&(D("User deleted successfully"),C())}catch(l){((r=l.response)==null?void 0:r.status)===403&&(window.location.href="/error")}},se=e=>{g(e)},re=e=>{X(e.target.value),w(1)},ae=e=>{w(e)},ne=e=>{L(e),w(1)},[c,m]=o.useState([{id:1,file:null,documentType:null}]),le=()=>{const e=c[c.length-1];if(c.length===0){m([{id:1,file:null,documentType:null}]);return}if(!(e!=null&&e.file)||!(e!=null&&e.documentType)){R.fire({icon:"warning",title:"Incomplete Row",text:"Please upload a file and select a document type before adding a new row."});return}const s=c.reduce((r,l)=>l.id>r?l.id:r,0);m([...c,{id:s+1,file:null,documentType:null}])},oe=(e=null)=>{m(c.filter(s=>s.id!==e.id))},ie=(e,s)=>{var l;const r=(l=e.target.files)==null?void 0:l[0];r&&m(c.map(i=>i.id===s?{...i,file:r}:i))},ce=[{accessor:"client_user_id",title:"#",width:80,key:"id"},{accessor:"client_user_name",title:"Name",sortable:!0,key:"client_user_name_column"},{accessor:"client_user_email",title:"Email",sortable:!0,key:"email-column"},{accessor:"actions",title:"Actions",width:120,key:"actions-column",render:e=>a("div",{className:"flex space-x-2",children:[t("button",{type:"button",onClick:()=>ee(e),className:"btn px-1 py-0.5 rounded text-white bg-info",children:t(he,{})},`edit-${e.client_user_id}`),t("button",{type:"button",onClick:()=>te(e),className:"btn px-1 py-0.5 rounded text-white bg-red-600",children:t(pe,{})},`delete-${e.client_user_id}`)]})}];return t("form",{ref:e=>d.current.userformRef=e,onSubmit:Z,className:"space-y-5",children:a("div",{className:"flex flex-wrap -mx-4",children:[t("div",{className:"w-full lg:w-1/3 px-4",children:t("div",{className:"panel",children:a("div",{className:"panel-body",children:[a("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[a("div",{className:"form-group",children:[t("label",{htmlFor:"client_user_name",children:"Username"}),t("input",{name:"client_user_name",type:"text",placeholder:"Username",className:"form-input"}),t("input",{type:"text",name:"client_user_id",id:"client_user_id"}),n.client_user_name&&t("span",{className:"text-red-500 text-sm",children:n.client_user_name})]}),a("div",{className:"form-group",children:[t("label",{htmlFor:"client_user_phone",children:"Phone"}),t("input",{name:"client_user_phone",type:"tel",placeholder:"Phone",className:"form-input"}),n.client_user_phone&&t("span",{className:"text-red-500 text-sm",children:n.client_user_phone})]}),a("div",{className:"form-group",children:[t("label",{htmlFor:"client_user_designation",children:"Designation"}),t("input",{name:"client_user_designation",type:"text",placeholder:"Designation",className:"form-input"}),n.client_user_designation&&t("span",{className:"text-red-500 text-sm",children:n.client_user_designation})]}),a("div",{className:"form-group",children:[t("label",{htmlFor:"client_user_email",children:"Email"}),t("input",{name:"client_user_email",type:"email",placeholder:"Email",className:"form-input"}),n.client_user_email&&t("span",{className:"text-red-500 text-sm",children:n.client_user_email})]}),a("div",{className:"form-group",children:[t("label",{htmlFor:"password",children:"Password"}),t("input",{name:"password",type:"password",placeholder:"Password",className:"form-input"}),n.password&&t("span",{className:"text-red-500 text-sm",children:n.password})]}),a("div",{className:"form-group",children:[t("label",{htmlFor:"client_user_status",children:"Status"}),t(N,{name:"client_user_status",placeholder:"Select an option",options:U,value:U.find(e=>e.value===B),onChange:e=>x((e==null?void 0:e.value)||null)}),n.client_user_status&&t("span",{className:"text-red-500 text-sm",children:n.client_user_status})]}),a("div",{className:"form-group",children:[t("label",{htmlFor:"client_sort_order",children:"Sort Order"}),t("input",{name:"client_sort_order",type:"text",placeholder:"Sort Order",className:"form-input"}),n.client_sort_order&&t("span",{className:"text-red-500 text-sm",children:n.client_sort_order})]}),a("div",{className:"form-group",children:[t("label",{htmlFor:"role_id",children:"Role"}),t(N,{name:"role_id",placeholder:"Select an option",options:Y||[],value:H,onChange:se}),n.role_id&&t("span",{className:"text-red-500 text-sm",children:n.role_id})]})]}),a("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 mt-4",children:[a("div",{className:"form-group",children:[t("label",{htmlFor:"client_user_dob",children:"Date of Birth"}),t(j,{name:"client_user_dob",options:{dateFormat:"Y-m-d"},className:"form-input",placeholder:"Y-m-d",onChange:e=>{G(e[0])}}),n.client_user_dob&&a("span",{className:"text-red-500 text-sm",children:[" ",n.client_user_dob," "]})]}),a("div",{className:"form-group",children:[t("label",{htmlFor:"client_user_joing_date",children:"Joing Date"}),t(j,{options:{dateFormat:"Y-m-d"},name:"client_user_joing_date",className:"form-input",placeholder:"Y-m-d",onChange:e=>K(e[0])}),n.client_user_joing_date&&t("span",{className:"text-red-500 text-sm",children:n.client_user_joing_date})]}),a("div",{className:"form-group",children:[t("label",{htmlFor:"client_user_type",children:"Type"}),t(N,{name:"client_user_type",placeholder:"Employee Type",options:k,value:k.find(e=>e.value===M),onChange:e=>V((e==null?void 0:e.value)||null)}),n.client_user_type&&t("span",{className:"text-red-500 text-sm",children:n.client_user_type})]})]}),a("div",{className:"mt-8",children:[t("div",{className:"table-responsive",children:a("table",{children:[t("thead",{children:a("tr",{children:[t("th",{children:"File"}),t("th",{className:"w-1",children:"File Name"}),t("th",{className:"w-1"})]})}),a("tbody",{children:[c.length<=0&&a("tr",{children:[" ",t("td",{colSpan:5,className:"!text-center font-semibold",children:" No Item Available "})," "]}),c.map(e=>a("tr",{className:"align-top",children:[t("td",{children:t("div",{className:"relative inline-block",children:a("label",{className:"cursor-pointer inline-block bg-gray-200 text-gray-800 text-sm font-medium px-4 py-2 rounded-md shadow hover:bg-gray-300 transition min-w-[200px]",children:["Upload File",t("input",{type:"file",className:"hidden",onChange:s=>ie(s,e.id)})]})})}),t("td",{children:t("div",{className:"relative z-[100]",children:t(N,{placeholder:"Document Type",options:I,value:I.find(s=>s.value===e.documentType),onChange:s=>m(c.map(r=>r.id===e.id?{...r,documentType:(s==null?void 0:s.value)||null}:r)),className:"min-w-[200px]",menuPortalTarget:document.body,styles:{menuPortal:s=>({...s,zIndex:9999}),menu:s=>({...s,zIndex:9999})}})})}),t("td",{children:a("button",{type:"button",onClick:()=>oe(e),children:[" ",t(me,{className:"w-5 h-5"})," "]})})]},e.id))]})]})}),t("div",{className:"flex justify-between sm:flex-row flex-col mt-6 px-4",children:t("div",{className:"sm:mb-0 mb-6",children:t("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:()=>le(),children:" + "})})})]}),t("div",{className:"sm:col-span-2 flex justify-end mt-4",children:t("button",{type:"submit",className:"btn btn-primary",children:" Submit "})})]})})}),t("div",{className:"w-full lg:w-2/3 px-2 mt-6 lg:mt-0 md-mt-0",children:t("div",{className:"datatables",children:t(_e,{columns:ce,rows:E,title:"List of all Users",idAccessor:"client_user_id",totalRecords:O,currentPage:v,recordsPerPage:S,onPageChange:ae,onRecordsPerPageChange:ne,onSortChange:Q,onSearchChange:re,sortStatus:y,isLoading:!1,minHeight:200,noRecordsText:"No users found",searchValue:T})})})]})})};export{Ee as default};
