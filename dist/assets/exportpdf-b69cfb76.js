import{u as G,c as H,T as J,r as s,b as K,s as Q,a as c,j as t,a1 as _,a2 as X}from"./index-fe5baaac.js";import{T as Z}from"./Table-e1ed3aa9.js";import{I as ee}from"./IconBell-d99e5090.js";import{I as te}from"./IconPlus-eedb2f6d.js";import{L as ae}from"./loader-88e97bac.js";import{S as k}from"./react-select.esm-7abf61d7.js";import{L as se}from"./LeadModal-a00a8d17.js";/* empty css                  */import{D as re}from"./status-2cad2f88.js";import{E as oe}from"./jspdf.plugin.autotable-a78f8a73.js";import"./floating-ui.dom.browser.min-b8726d47.js";import"./extends-4c19d496.js";import"./objectWithoutPropertiesLoose-f3b3ace0.js";import"./transition-f432e32a.js";import"./IconThumbUp-91d06cd2.js";import"./IconTrash-43205dbe.js";const Le=()=>{const l=G();H();const w=J(),v=re(),d=s.useRef({fetched:!1,form:null,prevPage:1,prevPerPage:10,prevSortStatus:{columnAccessor:"id",direction:"desc"}}),[y,p]=s.useState([]),[ne,f]=s.useState(!0),[D,L]=s.useState(!1),[C,A]=s.useState(null),[g,T]=s.useState(null),[i,R]=s.useState(""),[b,U]=s.useState(""),[u,m]=s.useState(1),[h,I]=s.useState(10),[n,W]=s.useState({columnAccessor:"id",direction:"desc"}),{leads:N,loading:x,agents:S,total:E,last_page:ce}=K(e=>e.leadslices);s.useEffect(()=>{l(Q("All Leads"));const e=()=>{l(_({page:u,perPage:h,sortField:n.columnAccessor,sortOrder:n.direction,search:b}))};if(!d.current.fetched){d.current.fetched=!0,e();return}e(),d.current.prevPage=u,d.current.prevPerPage=h,d.current.prevSortStatus=n},[l,u,h,n,b]),s.useEffect(()=>{(i.length>=3||i.length===0)&&(U(i),m(1))},[i]);const F=S==null?void 0:S.map(e=>({value:e==null?void 0:e.client_user_id,label:e==null?void 0:e.client_user_name,phone:e==null?void 0:e.client_user_phone})),j=(e,a)=>{a?(p(r=>[...r,e]),f(!1)):(p(r=>r.filter(o=>o.id!==e.id)),y.length===1&&f(!0))},z=e=>{A(e)},M=e=>{T(e.value)},O=async()=>{var r;if(!C){w.error("Please select an agent before downloading.");return}if(!g){w.error("Please select a status before downloading.");return}const e=new FormData;e.append("lead_status",g),e.append("agent_id",C.toString());const a=await l(X({formData:e}));if(a.payload.status===200||a.payload.status===201){l(_({page:u,perPage:h,sortField:n.columnAccessor,sortOrder:n.direction,search:b}));const o=new oe;o.setFontSize(16),B(g),o.text(`Agent: ${a.payload.agent_name}`,10,10),o.text("Lead Status: Not Responding",180,10,{align:"right"}),o.text(" ",10,10);const $=[["Lead Title","Comment","Time"]],q=(r=a.payload.data)==null?void 0:r.map(P=>[P.lead_title,P.lead_comment,Y(P.updated_at)]);o.autoTable({head:$,body:q,startY:30,columnStyles:{0:{cellWidth:"auto"},1:{cellWidth:"auto"},2:{cellWidth:"auto"}},theme:"grid",styles:{cellPadding:3,fontSize:12,fontStyle:"normal"},headStyles:{fillColor:[22,160,133],textColor:[255,255,255],fontStyle:"bold"},bodyStyles:{fillColor:[240,240,240]}}),o.save("reports.pdf")}},Y=e=>new Date(e).toLocaleString(),B=e=>{const a=v.find(r=>r.value===e);return a?a.label:"Unknown Status"},V=(Array.isArray(N)?N:[]).map(e=>({id:e.lead_id||"Unknown",title:e.lead_title||"Unknown",name:e.customer_name||"Unknown",phone:e.customer_phone||"Unknown",source:e.lead_source||"Unknown",date:e.created_at?new Date(e.created_at).toLocaleString():"Unknown"}));return c("div",{children:[c("div",{className:"panel flex items-center justify-between overflow-visible whitespace-nowrap p-3 text-dark relative",children:[c("div",{className:"flex items-center",children:[c("div",{className:"rounded-full bg-primary p-1.5 text-white ring-2 ring-primary/30 ltr:mr-3 rtl:ml-3",children:[" ",t(ee,{})," "]}),t("span",{className:"ltr:mr-3 rtl:ml-3",children:" Details of Your Agents Pdf Reports. "})]}),c("div",{className:"flex items-center space-x-2",children:[t("div",{className:"w-[300px]",children:t(k,{placeholder:"Select an option",options:F,classNamePrefix:"custom-select",className:"custom-multiselect z-10",onChange:e=>{(e==null?void 0:e.value)!==void 0&&z(e.value)}})}),t(k,{placeholder:"Move Lead....",options:v,onChange:e=>M(e),name:"lead_status",className:"cursor-pointer custom-multiselect z-10 w-[300px]"}),c("button",{onClick:()=>{O()},type:"button",className:"btn btn-secondary btn-sm",children:[t(te,{})," Download "]})]})]}),t("div",{className:"datatables mt-6",children:x?t(ae,{}):t(Z,{title:"All Leads",columns:[{accessor:"id",title:"Select",sortable:!1,render:e=>t("input",{type:"checkbox",className:"form-checkbox",checked:y.some(a=>a.id===e.id),onChange:a=>j(e,a.target.checked)})},{accessor:"title",title:"Title",sortable:!0},{accessor:"name",title:"Name",sortable:!0},{accessor:"phone",title:"Phone",sortable:!0},{accessor:"source",title:"Source",sortable:!0,render:e=>{switch(e.source){case"Facebook":return t("span",{className:"badge bg-info",children:"Facebook"});case"Instagram":return t("span",{className:"badge bg-secondary",children:"Instagram"});case"created own":return t("span",{className:"badge bg-success",children:"Created own"});case"Website":return t("span",{className:"badge bg-warning",children:"Website"});case"Reshuffle":return t("span",{className:"badge bg-primary",children:"Reshuffle"});case"Walk-in":return t("span",{className:"badge bg-danger",children:"Walk-in"});case"Other":return t("span",{className:"badge bg-secondary",children:"Other"});default:return t("span",{className:"badge bg-secondary",children:"Unknown"})}}},{accessor:"date",title:"Date",sortable:!0}],rows:V,totalRecords:E||0,currentPage:u,recordsPerPage:h,onPageChange:e=>{m(e),p([]),f(!0)},onRecordsPerPageChange:e=>{I(e),m(1),p([]),f(!0)},onSortChange:e=>{W(e),m(1)},sortStatus:n,isLoading:x,onSearchChange:e=>{R(e.target.value),m(1)},searchValue:i,noRecordsText:"No records found matching your search criteria"})}),t(se,{isOpen:D,onClose:()=>L(!1)})]})};export{Le as default};
