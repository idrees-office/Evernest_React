import{u as H,c as J,T as K,r as n,a as Q,s as X,a2 as h,j as u,b as s,a0 as Z,S as ee,a1 as se,a3 as ae}from"./index-e5b9a1fc.js";import{T as te}from"./Table-fb60cd86.js";import{I as re}from"./IconBell-be3f708a.js";import{I as ce}from"./IconPlus-7515cf00.js";import{I as ne}from"./IconTrash-513b1d69.js";import{S as A}from"./react-select.esm-cb5aa5f0.js";import{L as oe}from"./LeadModal-28e0747e.js";/* empty css                  */import"./index-c6201f19.js";import"./floating-ui.dom.browser.min-b8726d47.js";import"./extends-4c19d496.js";import"./objectWithoutPropertiesLoose-f3b3ace0.js";import"./transition-90a8ab85.js";const _e=()=>{const o=H();J();const i=K();n.useRef({fetched:!1,form:null,prevPage:1,prevPerPage:10,prevSortStatus:{columnAccessor:"id",direction:"desc"}});const[C,f]=n.useState(!1),[r,b]=n.useState(new Set),[le,w]=n.useState(!0),[P,y]=n.useState(!1),[l,L]=n.useState(""),[c,T]=n.useState({columnAccessor:"id",direction:"desc"}),[z,x]=n.useState(null),[F,ie]=n.useState(null),[D,de]=n.useState(""),{leads:v,loading:I,agents:N,total:R,last_page:ue,current_page:S,per_page:m}=Q(e=>e.leadslices),[U,p]=n.useState(!1);n.useEffect(()=>{o(X("Re-Assign Leads")),B()},[o,S,m,c,l]);const B=()=>{o(h({page:l?1:S,perPage:m,sortField:c.columnAccessor,sortOrder:c.direction,search:l}))},k=(N==null?void 0:N.map(e=>({value:e==null?void 0:e.client_user_id,label:e==null?void 0:e.client_user_name,phone:e==null?void 0:e.client_user_phone})))||[],g=n.useMemo(()=>(Array.isArray(v)?v:[]).map(e=>({id:e.lead_id||"Unknown",title:e.lead_title||"Unknown",name:e.customer_name||"Unknown",phone:e.customer_phone||"Unknown",source:e.lead_source||"Unknown",created_at:e.created_at||"Unknown",updated_at:e.updated_at||"Unknown",assigned_at:e.assigned_at||"Unknown"})),[v]),E=()=>{y(!0)},M=(e,a)=>{const t=new Set(r);a?(t.add(e.id),p(!0)):(t.delete(e.id),p(!1)),b(t),w(t.size===0),f(!1)},j=e=>{const a=new Set(r);e?(g.forEach(t=>a.add(t.id)),p(!0)):(g.forEach(t=>a.delete(t.id)),p(!1)),b(a),w(a.size===0),f(e)},W=async(e,a)=>{if(r.size===0){i.error("Please select at least one lead to assign");return}const t=new FormData;Array.from(r).forEach(d=>t.append("lead_id[]",d)),t.append("agent_id",e.toString()),t.append("agent_phone",a.toString());try{const d=await o(Z({formData:t}));(d.payload.status===200||d.payload.status===201)&&(i.success(`${r.size} leads have been assigned successfully`),b(new Set),w(!0),f(!1),x(null),p(!1),o(h({page:l?1:S,perPage:m,sortField:c.columnAccessor,sortOrder:c.direction,search:l})))}catch{i.error("Failed to assign leads")}},Y=async()=>{if(r.size===0){i.error("Please select at least one lead to remove");return}if((await ee.fire({title:"Are you sure?",text:`You are about to remove ${r.size} selected lead(s). This action cannot be undone.`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel"})).isConfirmed)try{const a=new FormData;Array.from(r).forEach(d=>a.append("lead_id[]",d));const t=await o(se({formData:a}));t.payload.status===200||t.payload.status===201?(i.success(`${r.size} leads removed successfully`),b(new Set),w(!0),f(!1)):i.error("Failed to remove leads. Please try again.")}catch{i.error("An error occurred while removing leads.")}},$=e=>{o(h({page:e,sortField:c.columnAccessor,sortOrder:c.direction,search:l}))},O=e=>{o(h({perPage:e,sortField:c.columnAccessor,sortOrder:c.direction,search:l}))},V=e=>{T(e),o(h({sortField:e.columnAccessor,sortOrder:e.direction,search:l}))},q=e=>{const a=e.target.value;L(a),o(h({page:1,perPage:m,sortField:c.columnAccessor,sortOrder:c.direction,search:a}))},G=async e=>{x(e),await o(ae({page:1,perPage:m,sortField:c.columnAccessor,sortOrder:c.direction,search:l,date_range:D,agent_id:e,status_id:F}))},_=[{accessor:"id",width:"30px",title:u("div",{className:"flex items-center",children:[s("input",{type:"checkbox",className:"form-checkbox mr-2",checked:C||g.length>0&&g.every(e=>r.has(e.id)),onChange:e=>j(e.target.checked)}),"Select",r.size>0&&u("span",{className:"ml-2 text-xs",children:["(",r.size," selected)"]})]}),sortable:!1,render:e=>s("input",{type:"checkbox",className:"form-checkbox",checked:r.has(e.id),onChange:a=>M(e,a.target.checked)})},{accessor:"title",title:"Title",sortable:!0,width:320,cellsClassName:"break-all whitespace-normal",render:e=>s("div",{className:"break-words whitespace-normal max-w-xs truncate",children:e.title})},{accessor:"name",title:"Name",sortable:!0,width:200,cellsClassName:"break-all whitespace-normal",render:e=>s("div",{className:"break-words whitespace-normal max-w-xs truncate",children:e.name})},{accessor:"phone",title:"Phone",sortable:!0},{accessor:"source",title:"Source",sortable:!0,render:e=>{switch(e.source){case"Facebook":return s("span",{className:"badge bg-info",children:"Facebook"});case"Instagram":return s("span",{className:"badge bg-secondary",children:"Instagram"});case"created own":return s("span",{className:"badge bg-success",children:"Created own"});case"Website":return s("span",{className:"badge bg-warning",children:"Website"});case"Reshuffle":return s("span",{className:"badge bg-primary",children:"Reshuffle"});case"Walk-in":return s("span",{className:"badge bg-danger",children:"Walk-in"});case"Other":return s("span",{className:"badge bg-secondary",children:"Other"});default:return s("span",{className:"badge bg-secondary",children:"Unknown"})}}},{accessor:"created_at",title:"Lead Created",sortable:!0},{accessor:"updated_at",title:"Last Updated",sortable:!0},{accessor:"assigned_at",title:"Last Assigned",sortable:!0}];return u("div",{children:[u("div",{className:"panel flex items-center justify-between overflow-visible whitespace-nowrap p-3 text-dark relative",children:[u("div",{className:"flex items-center",children:[s("div",{className:"rounded-full bg-primary p-1.5 text-white ring-2 ring-primary/30 ltr:mr-3 rtl:ml-3",children:s(re,{})}),s("span",{className:"ltr:mr-3 rtl:ml-3",children:"Details of Your New Leads: "}),u("button",{onClick:E,className:"btn btn-success btn-sm",children:[s(ce,{})," Add Lead"]})]}),u("div",{className:"flex items-center space-x-2",children:[s("div",{className:"w-full md:w-[200px]",children:s(A,{placeholder:"Select an Agent",options:k,isDisabled:U,classNamePrefix:"custom-select",className:"custom-multiselect z-10",value:k.find(e=>e.value===z)||null,onChange:e=>{(e==null?void 0:e.value)!==void 0&&G(e.value)}})}),s(A,{placeholder:"Select an option",options:k,isDisabled:r.size===0,className:"cursor-pointer custom-multiselect z-10 w-[300px]",onChange:e=>{(e==null?void 0:e.value)!==void 0&&W(e.value,e.phone)}}),s("button",{onClick:Y,type:"button",className:"btn btn-default btn-sm",style:{background:"#d33",color:"#fff"},disabled:r.size===0,children:s(ne,{})})]})]}),s("div",{className:"datatables mt-6",children:s(te,{title:"Re-Assign Leads",columns:_||[],rows:g,totalRecords:R||0,currentPage:S,recordsPerPage:m,onPageChange:$,onRecordsPerPageChange:O,onSortChange:V,sortStatus:c,isLoading:I,onSearchChange:q,searchValue:l,noRecordsText:"No records found matching your search criteria"})}),s(oe,{isOpen:P,onClose:()=>y(!1)})]})};export{_e as default};
