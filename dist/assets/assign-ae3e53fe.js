import{u as $,T as H,r as l,a as _,s as q,$ as f,j as g,F as G,b as s,a0 as J,S as K,a1 as Q}from"./index-2dba8996.js";import{T as X}from"./Table-16b363b1.js";import{I as Z}from"./IconBell-c048f2df.js";import{I as ee}from"./IconPlus-84d4365c.js";import{I as se}from"./IconTrash-7df99e7d.js";import{S as P}from"./react-select.esm-68f30528.js";import{L as re}from"./LeadModal-65b74799.js";/* empty css                  */import{C as ae}from"./status-6c9686c6.js";import"./index-31b51ebe.js";import"./floating-ui.dom.browser.min-b8726d47.js";import"./extends-4c19d496.js";import"./objectWithoutPropertiesLoose-f3b3ace0.js";import"./transition-0b4b1ff0.js";import"./IconSquareCheck-9e533aff.js";import"./IconStar-4b527f13.js";import"./IconCalendar-38d3009b.js";const Ne=()=>{const o=$(),m=H(),[p,i]=l.useState([]),[k,d]=l.useState(!0),[v,C]=l.useState(!1),[c,x]=l.useState(""),S=l.useRef({fetched:!1,form:null,prevPage:1,prevPerPage:10}),[a,A]=l.useState({columnAccessor:"id",direction:"desc"}),{leads:y,loading:L,agents:w,total:F,current_page:b,per_page:h}=_(e=>e.leadslices);_(e=>e.auth.user||{});const[te,T]=l.useState("");l.useEffect(()=>{if(o(q("New Leads")),!S.current.fetched){N(),S.current.fetched=!0;return}},[o,b,h,a,c]);const N=e=>{o(f({page:c?1:b,perPage:h,sortField:a.columnAccessor==="date"?"created_at":a.columnAccessor,sortOrder:a.direction,search:c,cityname:e}))},D=(w==null?void 0:w.map(e=>({value:e==null?void 0:e.client_user_id,label:e==null?void 0:e.client_user_name,phone:e==null?void 0:e.client_user_phone,customLabel:g(G,{children:[e==null?void 0:e.client_user_name,(e==null?void 0:e.client_user_designation)&&s("span",{style:{marginLeft:8},children:s("span",{className:"badge bg-success",style:{color:"#fff"},children:e.client_user_designation})})]})})))||[],I=({label:e,customLabel:r})=>r||e,R=l.useMemo(()=>(Array.isArray(y)?y:[]).map(e=>({id:e.lead_id||"Unknown",title:e.lead_title||"Unknown",name:e.customer_name||"Unknown",phone:e.customer_phone||"Unknown",source:e.lead_source||"Unknown",date:e.created_at})),[y]),O=()=>{C(!0)},B=e=>{i([]),T((e==null?void 0:e.value)||""),N(e==null?void 0:e.value),d(!0)},M=(e,r)=>{r?(i(u=>[...u,e]),d(!1)):(i(u=>u.filter(n=>n.id!==e.id)),p.length===1&&d(!0))},U=async(e,r)=>{if(p.length===0){m.error("Please select at least one lead to assign");return}const u=p.map(t=>t.id),n=new FormData;u.forEach(t=>n.append("lead_id[]",t)),n.append("agent_id",e.toString()),n.append("agent_phone",r.toString());try{const t=await o(J({formData:n}));(t.payload.status===200||t.payload.status===201)&&(m.success("Leads Have Been Assigned Successfully"),i([]),d(!0),o(f({page:c?1:b,perPage:h,sortField:a.columnAccessor,sortOrder:a.direction,search:c})))}catch{m.error("Failed to assign leads")}},j=async()=>{if(p.length===0){m.error("Please select at least one lead to remove");return}if((await K.fire({title:"Are you sure?",text:`You are about to remove ${p.length} selected lead(s). This action cannot be undone.`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel"})).isConfirmed)try{const r=p.map(t=>t.id),u=new FormData;r.forEach(t=>u.append("lead_id[]",t));const n=await o(Q({formData:u}));n.payload.status===200||n.payload.status===201?(m.success("Lead removed successfully"),i([]),d(!0)):m.error("Failed to remove leads. Please try again.")}catch{m.error("An error occurred while removing leads.")}},E=e=>{o(f({page:e,sortField:a.columnAccessor,sortOrder:a.direction,search:c})),i([]),d(!0)},W=e=>{o(f({perPage:e,sortField:a.columnAccessor,sortOrder:a.direction,search:c})),i([]),d(!0)},Y=e=>{A(e),o(f({page:1,perPage:h,sortField:e.columnAccessor==="date"?"created_at":e.columnAccessor,sortOrder:e.direction,search:c})),i([]),d(!0)},z=e=>{const r=e.target.value;x(r),o(f({page:1,perPage:h,sortField:a.columnAccessor,sortOrder:a.direction,search:r}))},V=[{accessor:"id",title:"Select",sortable:!1,render:e=>s("input",{type:"checkbox",className:"form-checkbox",checked:p.some(r=>r.id===e.id),onChange:r=>M(e,r.target.checked)})},{accessor:"title",title:"Title",sortable:!0},{accessor:"name",title:"Name",sortable:!0},{accessor:"phone",title:"Phone",sortable:!0},{accessor:"source",title:"Source",sortable:!0,render:e=>{switch(e.source){case"Facebook":return s("span",{className:"badge bg-info",children:"Facebook"});case"Instagram":return s("span",{className:"badge bg-secondary",children:"Instagram"});case"created own":return s("span",{className:"badge bg-success",children:"Created own"});case"Website":return s("span",{className:"badge bg-warning",children:"Website"});case"Reshuffle":return s("span",{className:"badge bg-primary",children:"Reshuffle"});case"Walk-in":return s("span",{className:"badge bg-danger",children:"Walk-in"});case"Marketing":return s("span",{className:"badge bg-success",children:"Marketing"});case"Other":return s("span",{className:"badge bg-secondary",children:"Other"});default:return s("span",{className:"badge bg-secondary",children:"Unknown"})}}},{accessor:"date",title:"Date",sortable:!0}];return g("div",{children:[g("div",{className:"panel flex items-center justify-between overflow-visible whitespace-nowrap p-3 text-dark relative",children:[g("div",{className:"flex items-center",children:[s("div",{className:"rounded-full bg-primary p-1.5 text-white ring-2 ring-primary/30 ltr:mr-3 rtl:ml-3",children:s(Z,{})}),s("span",{className:"ltr:mr-3 rtl:ml-3",children:"Details of Your New Leads: "}),g("button",{onClick:O,className:"btn btn-success btn-sm",children:[s(ee,{}),"Add Lead "]})]}),g("div",{className:"flex items-center space-x-2",children:[s(P,{placeholder:"Choose City..",options:ae.map(e=>({value:e.value,label:e.name})),onChange:B,className:"cursor-pointer custom-multiselect z-10 w-[300px]",isClearable:!0}),s(P,{placeholder:"Select an option",options:D,isDisabled:k,className:"cursor-pointer custom-multiselect z-10 w-[300px]",formatOptionLabel:I,getOptionLabel:e=>e.label,getOptionValue:e=>e.value,onChange:e=>{(e==null?void 0:e.value)!==void 0&&U(e.value,e.phone)}}),s("button",{onClick:j,type:"button",className:"btn btn-default btn-sm",style:{background:"#d33",color:"#fff"},children:s(se,{})})]})]}),s("div",{className:"datatables mt-6",children:s(X,{title:"New Leads",columns:V,rows:R,totalRecords:F||0,currentPage:b,recordsPerPage:h,onPageChange:E,onRecordsPerPageChange:W,onSortChange:Y,sortStatus:a,isLoading:L,onSearchChange:z,searchValue:c,noRecordsText:"No records found matching your search criteria"})}),s(re,{isOpen:v,onClose:()=>C(!1)})]})};export{Ne as default};
