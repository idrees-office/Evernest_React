import{u as $,T as H,r as l,b as _,s as q,a0 as f,a as g,F as G,j as s,a1 as J,S as K,a2 as Q}from"./index-fd330a89.js";import{T as X}from"./Table-f77f40b1.js";import{I as Z}from"./IconBell-ff853338.js";import{I as ee}from"./IconPlus-19f17580.js";import{I as se}from"./IconTrash-4e6f493a.js";import{S as P}from"./react-select.esm-508bfdab.js";import{L as re}from"./LeadModal-d9ec93d7.js";/* empty css                  */import{C as ae}from"./status-9783e7d5.js";import"./index-a2d4dba2.js";import"./floating-ui.dom-86c7411f.js";import"./extends-4c19d496.js";import"./objectWithoutPropertiesLoose-75170e70.js";import"./transition-13febe14.js";import"./IconSquareCheck-d42f7918.js";import"./IconStar-2e13c2a3.js";const Ce=()=>{const o=$(),d=H(),[u,m]=l.useState([]),[k,p]=l.useState(!0),[v,S]=l.useState(!1),[c,x]=l.useState(""),C=l.useRef({fetched:!1,form:null,prevPage:1,prevPerPage:10,prevSortStatus:{columnAccessor:"id",direction:"desc"}}),[a,L]=l.useState({columnAccessor:"id",direction:"desc"}),{leads:y,loading:A,agents:w,total:F,current_page:b,per_page:h}=_(e=>e.leadslices);_(e=>e.auth.user||{});const[te,T]=l.useState("");l.useEffect(()=>{if(o(q("New Leads")),!C.current.fetched){N(),C.current.fetched=!0;return}},[o,b,h,a,c]);const N=e=>{o(f({page:c?1:b,perPage:h,sortField:a.columnAccessor,sortOrder:a.direction,search:c,cityname:e}))},D=(w==null?void 0:w.map(e=>({value:e==null?void 0:e.client_user_id,label:e==null?void 0:e.client_user_name,phone:e==null?void 0:e.client_user_phone,customLabel:g(G,{children:[e==null?void 0:e.client_user_name,(e==null?void 0:e.client_user_designation)&&s("span",{style:{marginLeft:8},children:s("span",{className:"badge bg-success",style:{color:"#fff"},children:e.client_user_designation})})]})})))||[],I=({label:e,customLabel:r})=>r||e,R=l.useMemo(()=>(Array.isArray(y)?y:[]).map(e=>({id:e.lead_id||"Unknown",title:e.lead_title||"Unknown",name:e.customer_name||"Unknown",phone:e.customer_phone||"Unknown",source:e.lead_source||"Unknown",date:e.created_at})),[y]),M=()=>{S(!0)},O=e=>{m([]),T((e==null?void 0:e.value)||""),N(e==null?void 0:e.value),p(!0)},B=(e,r)=>{r?(m(i=>[...i,e]),p(!1)):(m(i=>i.filter(n=>n.id!==e.id)),u.length===1&&p(!0))},U=async(e,r)=>{if(u.length===0){d.error("Please select at least one lead to assign");return}const i=u.map(t=>t.id),n=new FormData;i.forEach(t=>n.append("lead_id[]",t)),n.append("agent_id",e.toString()),n.append("agent_phone",r.toString());try{const t=await o(J({formData:n}));(t.payload.status===200||t.payload.status===201)&&(d.success("Leads Have Been Assigned Successfully"),m([]),p(!0),o(f({page:c?1:b,perPage:h,sortField:a.columnAccessor,sortOrder:a.direction,search:c})))}catch{d.error("Failed to assign leads")}},j=async()=>{if(u.length===0){d.error("Please select at least one lead to remove");return}if((await K.fire({title:"Are you sure?",text:`You are about to remove ${u.length} selected lead(s). This action cannot be undone.`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel"})).isConfirmed)try{const r=u.map(t=>t.id),i=new FormData;r.forEach(t=>i.append("lead_id[]",t));const n=await o(Q({formData:i}));n.payload.status===200||n.payload.status===201?(d.success("Lead removed successfully"),m([]),p(!0)):d.error("Failed to remove leads. Please try again.")}catch{d.error("An error occurred while removing leads.")}},E=e=>{o(f({page:e,sortField:a.columnAccessor,sortOrder:a.direction,search:c})),m([]),p(!0)},W=e=>{o(f({perPage:e,sortField:a.columnAccessor,sortOrder:a.direction,search:c})),m([]),p(!0)},Y=e=>{L(e),o(f({page:1,perPage:h,sortField:a.columnAccessor,sortOrder:a.direction,search:c}))},z=e=>{const r=e.target.value;x(r),o(f({page:1,perPage:h,sortField:a.columnAccessor,sortOrder:a.direction,search:r}))},V=[{accessor:"id",title:"Select",sortable:!1,render:e=>s("input",{type:"checkbox",className:"form-checkbox",checked:u.some(r=>r.id===e.id),onChange:r=>B(e,r.target.checked)})},{accessor:"title",title:"Title",sortable:!0},{accessor:"name",title:"Name",sortable:!0},{accessor:"phone",title:"Phone",sortable:!0},{accessor:"source",title:"Source",sortable:!0,render:e=>{switch(e.source){case"Facebook":return s("span",{className:"badge bg-info",children:"Facebook"});case"Instagram":return s("span",{className:"badge bg-secondary",children:"Instagram"});case"created own":return s("span",{className:"badge bg-success",children:"Created own"});case"Website":return s("span",{className:"badge bg-warning",children:"Website"});case"Reshuffle":return s("span",{className:"badge bg-primary",children:"Reshuffle"});case"Walk-in":return s("span",{className:"badge bg-danger",children:"Walk-in"});case"Marketing":return s("span",{className:"badge bg-success",children:"Marketing"});case"Other":return s("span",{className:"badge bg-secondary",children:"Other"});default:return s("span",{className:"badge bg-secondary",children:"Unknown"})}}},{accessor:"date",title:"Date",sortable:!0}];return g("div",{children:[g("div",{className:"panel flex items-center justify-between overflow-visible whitespace-nowrap p-3 text-dark relative",children:[g("div",{className:"flex items-center",children:[s("div",{className:"rounded-full bg-primary p-1.5 text-white ring-2 ring-primary/30 ltr:mr-3 rtl:ml-3",children:s(Z,{})}),s("span",{className:"ltr:mr-3 rtl:ml-3",children:"Details of Your New Leads: "}),g("button",{onClick:M,className:"btn btn-success btn-sm",children:[s(ee,{})," Add Lead"]})]}),g("div",{className:"flex items-center space-x-2",children:[s(P,{placeholder:"Choose City..",options:ae.map(e=>({value:e.value,label:e.name})),onChange:O,className:"cursor-pointer custom-multiselect z-10 w-[300px]",isClearable:!0}),s(P,{placeholder:"Select an option",options:D,isDisabled:k,className:"cursor-pointer custom-multiselect z-10 w-[300px]",formatOptionLabel:I,getOptionLabel:e=>e.label,getOptionValue:e=>e.value,onChange:e=>{(e==null?void 0:e.value)!==void 0&&U(e.value,e.phone)}}),s("button",{onClick:j,type:"button",className:"btn btn-default btn-sm",style:{background:"#d33",color:"#fff"},children:s(se,{})})]})]}),s("div",{className:"datatables mt-6",children:s(X,{title:"New Leads",columns:V,rows:R,totalRecords:F||0,currentPage:b,recordsPerPage:h,onPageChange:E,onRecordsPerPageChange:W,onSortChange:Y,sortStatus:a,isLoading:A,onSearchChange:z,searchValue:c,noRecordsText:"No records found matching your search criteria"})}),s(re,{isOpen:v,onClose:()=>S(!1)})]})};export{Ce as default};
