import{j as t,r as n,a as c,B as E,u as H,c as z,T as V,b as X,s as q,W as G,a4 as h}from"./index-6a84f326.js";import{T as J}from"./Table-58755329.js";import{I as K}from"./IconBell-d37e8199.js";import{S as Q}from"./react-select.esm-4861509e.js";import{L as Z}from"./LeadModal-dbba95d7.js";/* empty css                  */import{a as D,D as ee}from"./status-649356ba.js";import"./jspdf.plugin.autotable-39fab5ce.js";import{F as te}from"./flatpickr-c0e3cbe1.js";import{Y as _,y as C}from"./transition-29fff656.js";import"./index-7a58ac82.js";import"./floating-ui.dom.browser.min-b8726d47.js";import"./extends-4c19d496.js";import"./objectWithoutPropertiesLoose-f3b3ace0.js";import"./IconSquareCheck-91eaff04.js";import"./IconStar-cc0fc9bd.js";import"./IconTrash-847d5a95.js";const ae=a=>{const r=D.find(l=>l.value==a);return r&&typeof r.notes=="string"?r.notes:"Status Changed"},re=a=>{const r=D.find(l=>l.value==a);return r&&typeof r.notes2=="string"?r.notes2:"Status Changed"},se=a=>{if(!a)return"Invalid Time";const r=new Date(a);return r.toLocaleDateString()+" "+r.toLocaleTimeString()},ne=({isOpen:a,onClose:r,comments:l=[]})=>t(_,{appear:!0,show:a,as:n.Fragment,children:c(C,{as:"div",open:a,onClose:r,className:"relative z-[51]",children:[t(_.Child,{as:n.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:t("div",{className:"fixed inset-0 bg-[black]/60"})}),t("div",{className:"fixed inset-0 overflow-y-auto",children:t("div",{className:"flex min-h-full items-center justify-center px-4 py-8",children:t(_.Child,{as:n.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:c(C.Panel,{className:"panel border-0 p-0 rounded-lg overflow-hidden w-full max-w-6xl h-[90vh] text-black dark:text-white-dark",children:[t("button",{type:"button",onClick:r,className:"absolute top-4 ltr:right-4 rtl:left-4 text-gray-400 hover:text-gray-800 dark:hover:text-gray-600 outline-none",children:t(E,{className:"w-6 h-6"})}),t("div",{className:"text-xl font-semibold bg-[#fbfbfb] dark:bg-[#121c2c] ltr:pl-6 rtl:pr-6 py-4 ltr:pr-[60px] rtl:pl-[60px]",children:"History of the Leads"}),c("div",{className:"p-6 h-full flex flex-col",children:[t("div",{className:"flex-1 overflow-y-auto",children:t("div",{className:"table-responsive text-[#515365] dark:text-white-light font-semibold",children:t("div",{className:"max-w-[1200px] mx-auto",children:l==null?void 0:l.map((s,d)=>{var v,g,x;return c("div",{className:"flex",children:[t("p",{className:"text-[#3b3f5c] dark:text-white-light min-w-[150px] max-w-[180px] text-base font-semibold py-3",children:se(s.created_at)}),t("div",{className:`
                                                            relative
                                                            before:absolute before:left-1/2 before:-translate-x-1/2 before:top-[18px] 
                                                            before:w-3 before:h-3 before:border-[3px] before:rounded-full
                                                            after:absolute after:left-1/2 after:-translate-x-1/2 after:top-[30px] 
                                                            after:-bottom-[15px] after:w-0 after:h-auto after:border-l-[3px] 
                                                            after:rounded-full
                                                            ${d%5===0?"before:border-primary after:border-primary":d%5===1?"before:border-dark after:border-dark":d%5===2?"before:border-success after:border-success":d%5===3?"before:border-danger after:border-danger":"before:border-warning after:border-warning"}
                                                        `}),c("div",{className:"p-3 self-center ltr:ml-3 rtl:mr-3 w-full",children:[c("div",{className:"flex items-center gap-3 mb-2",children:[t("span",{className:"text-[#3b3f5c] dark:text-white-light font-semibold text-[15px]",children:(s==null?void 0:s.user_name)||(d>0?(v=l[d-1])==null?void 0:v.user_name:"System")}),t("span",{className:"text-gray-500 dark:text-gray-400 text-[15px]",dangerouslySetInnerHTML:{__html:ae(s.lead_status)}}),s.lead_status===2&&t("span",{className:"text-blue-500 dark:text-blue-400 text-[15px]",children:((g=s==null?void 0:s.agent)==null?void 0:g.client_user_name)||(s==null?void 0:s.agent_name)}),d>0&&t("div",{className:"text-gray-500 dark:text-gray-400 text-[15px]",dangerouslySetInnerHTML:{__html:re((x=l[d-1])==null?void 0:x.lead_status)}})]}),s.lead_comment&&t("div",{className:"bg-gray-50 dark:bg-gray-800 p-2 border-l-4 border-gray-200 dark:border-gray-600 rounded-r",children:t("p",{className:"text-[#3b3f5c] dark:text-white-light text-base italic",children:s.lead_comment})})]})]},s.lead_comment_id)})})})}),t("div",{className:"ltr:text-right rtl:text-left flex justify-end items-center mt-6 pt-4 border-t border-gray-200 dark:border-gray-600",children:t("button",{type:"button",className:"btn btn-outline-danger px-6 py-2 text-base",onClick:r,children:"Close"})})]})]})})})})]})}),Te=()=>{const a=H();z();const r=V();ee();const l=n.useRef({fetched:!1,form:null,prevPage:1,prevPerPage:10,prevSortStatus:{columnAccessor:"lead_id",direction:"desc"}}),[s,d]=n.useState([]),[v,g]=n.useState(!0),[x,T]=n.useState(!1),[m,A]=n.useState(null);n.useState(null);const[u,F]=n.useState(""),[o,L]=n.useState({columnAccessor:"lead_id",direction:"desc"}),{leads:y,loading:R,agents:S,total:I,last_page:oe,current_page:N,per_page:p}=X(e=>e.leadslices),[f,w]=n.useState(""),[M,k]=n.useState(!1),[O,U]=n.useState(null);n.useEffect(()=>{a(q("Agents Reports"));const e=()=>{a(h({page:u?1:N,perPage:p,sortField:o.columnAccessor,sortOrder:o.direction,search:u,date_range:f}))};if(!l.current.fetched){e(),l.current.fetched=!0;return}},[a,N,p,o,u]);const j=S==null?void 0:S.map(e=>({value:e==null?void 0:e.client_user_id,label:e==null?void 0:e.client_user_name,phone:e==null?void 0:e.client_user_phone})),Y=e=>{A(e)},$=async()=>{if(!m){r.error("Please select an agent before Search.");return}a(h({page:1,perPage:p,sortField:o.columnAccessor,sortOrder:o.direction,search:u,date_range:f,agent_id:m}))},P=e=>{const i=e.getFullYear(),b=String(e.getMonth()+1).padStart(2,"0"),B=String(e.getDate()).padStart(2,"0");return`${i}-${b}-${B}`},W=n.useMemo(()=>(Array.isArray(y)?y:[]).map(e=>({id:e.lead_id||"Unknown",title:e.lead_title||"Unknown",name:e.customer_name||"Unknown",phone:e.customer_phone||"Unknown",source:e.lead_source||"Unknown",date:e.assigned_at?new Date(e.assigned_at).toLocaleString():"Unknown"})),[y]);return c("div",{children:[c("div",{className:"panel flex items-center justify-between overflow-visible whitespace-nowrap p-3 text-dark relative",children:[c("div",{className:"flex items-center",children:[c("div",{className:"rounded-full bg-primary p-1.5 text-white ring-2 ring-primary/30 ltr:mr-3 rtl:ml-3",children:[" ",t(K,{})," "]}),t("span",{className:"ltr:mr-3 rtl:ml-3",children:" Details of Your Agents Reports. "})]}),c("div",{className:"flex items-center space-x-2",children:[t("div",{className:"w-[500px]",children:t(Q,{placeholder:"Select an option",options:j,classNamePrefix:"custom-select",className:"custom-multiselect z-10",onChange:e=>{(e==null?void 0:e.value)!==void 0&&Y(e.value)}})}),t(te,{options:{mode:"range",dateFormat:"Y-m-d"},className:"form-input",placeholder:"Y-m-d",onChange:e=>{if(e.length===2){const i=P(e[0]),b=P(e[1]);w(`${i},${b}`)}else w("")}}),c("button",{onClick:()=>{$()},type:"button",className:"btn btn-secondary btn-sm",children:[t(G,{})," Â  Search "]})]})]}),t("div",{className:"datatables mt-6",children:t(J,{title:"All Leads",columns:[{accessor:"title",title:"Title",sortable:!0},{accessor:"name",title:"Name",sortable:!0},{accessor:"phone",title:"Phone",sortable:!0},{accessor:"source",title:"Source",sortable:!0,render:e=>{switch(e.source){case"Facebook":return t("span",{className:"badge bg-info",children:"Facebook"});case"Instagram":return t("span",{className:"badge bg-secondary",children:"Instagram"});case"created own":return t("span",{className:"badge bg-success",children:"Created own"});case"Website":return t("span",{className:"badge bg-warning",children:"Website"});case"Reshuffle":return t("span",{className:"badge bg-primary",children:"Reshuffle"});case"Walk-in":return t("span",{className:"badge bg-danger",children:"Walk-in"});case"Other":return t("span",{className:"badge bg-secondary",children:"Other"});default:return t("span",{className:"badge bg-secondary",children:"Unknown"})}}},{accessor:"date",title:"Date",sortable:!0},{accessor:"actions",title:"Actions",render:e=>{const i=y.find(b=>b.lead_id===e.id);return t("button",{type:"button",className:"btn btn-secondary btn-sm",style:{height:"23px",borderRadius:"13px"},onClick:()=>{k(!0),U((i==null?void 0:i.comments)||[])},children:"View"})}}],rows:W,totalRecords:I||0,currentPage:N,recordsPerPage:p,onPageChange:e=>{a(h({page:e,sortField:o.columnAccessor,sortOrder:o.direction,search:u,agent_id:m,date_range:f})),d([]),g(!0)},onRecordsPerPageChange:e=>{a(h({perPage:e,sortField:o.columnAccessor,sortOrder:o.direction,search:u,agent_id:m,date_range:f})),d([]),g(!0)},onSortChange:e=>{L(e),a(h({page:1,perPage:p,sortField:o.columnAccessor,sortOrder:o.direction,search:u,agent_id:m,date_range:f}))},sortStatus:o,isLoading:R,onSearchChange:e=>{const i=e.target.value;F(i),a(h({page:1,perPage:p,sortField:o.columnAccessor,sortOrder:o.direction,search:i}))},searchValue:u,noRecordsText:"No records found matching your search criteria"})}),t(Z,{isOpen:x,onClose:()=>T(!1)}),t(ne,{isOpen:M,onClose:()=>k(!1),comments:O})]})};export{Te as default};
