import{u as F,c as I,T as B,r as l,b as U,s as M,a as p,j as a,a1 as g,$ as j,S as E,a0 as O}from"./index-9f5f6518.js";import{T as W}from"./Table-4d21af28.js";import{I as Y}from"./IconBell-7fbab6e1.js";import{I as $}from"./IconPlus-543f85e3.js";import{I as z}from"./IconTrash-68423ecf.js";import{S as H}from"./react-select.esm-09403cb9.js";import{L as V}from"./LeadModal-85ab76d2.js";/* empty css                  */import"./index-e2449742.js";import"./floating-ui.dom.browser.min-b8726d47.js";import"./extends-4c19d496.js";import"./objectWithoutPropertiesLoose-f3b3ace0.js";import"./transition-30b65ffa.js";const he=()=>{const o=F();I();const i=B(),v=l.useRef({fetched:!1,form:null,prevPage:1,prevPerPage:10,prevSortStatus:{columnAccessor:"id",direction:"desc"}}),[d,m]=l.useState([]),[C,h]=l.useState(!0),[P,y]=l.useState(!1),[u,N]=l.useState(""),[t,k]=l.useState({columnAccessor:"id",direction:"desc"}),{leads:b,loading:_,agents:w,total:x,last_page:q,current_page:S,per_page:f}=U(e=>e.leadslices);l.useEffect(()=>{o(M("Re-Assign Leads"));const e=()=>{o(g({page:u?1:S,perPage:f,sortField:t.columnAccessor,sortOrder:t.direction,search:u}))};if(!v.current.fetched){e(),v.current.fetched=!0;return}},[o,S,f,t,u]);const A=(w==null?void 0:w.map(e=>({value:e==null?void 0:e.client_user_id,label:e==null?void 0:e.client_user_name,phone:e==null?void 0:e.client_user_phone})))||[],L=l.useMemo(()=>(Array.isArray(b)?b:[]).map(e=>({id:e.lead_id||"Unknown",title:e.lead_title||"Unknown",name:e.customer_name||"Unknown",phone:e.customer_phone||"Unknown",source:e.lead_source||"Unknown",date:e.created_at?new Date(e.created_at).toLocaleString():"Unknown"})),[b]),T=()=>{y(!0)},R=(e,s)=>{s?(m(c=>[...c,e]),h(!1)):(m(c=>c.filter(n=>n.id!==e.id)),d.length===1&&h(!0))},D=async(e,s)=>{if(d.length===0){i.error("Please select at least one lead to assign");return}const c=d.map(r=>r.id),n=new FormData;c.forEach(r=>n.append("lead_id[]",r)),n.append("agent_id",e.toString()),n.append("agent_phone",s.toString());try{const r=await o(j({formData:n}));(r.payload.status===200||r.payload.status===201)&&(i.success("Leads Have Been Assigned Successfully"),m([]),h(!0))}catch{i.error("Failed to assign leads")}};return p("div",{children:[p("div",{className:"panel flex items-center justify-between overflow-visible whitespace-nowrap p-3 text-dark relative",children:[p("div",{className:"flex items-center",children:[a("div",{className:"rounded-full bg-primary p-1.5 text-white ring-2 ring-primary/30 ltr:mr-3 rtl:ml-3",children:a(Y,{})}),a("span",{className:"ltr:mr-3 rtl:ml-3",children:"Details of Your New Leads: "}),p("button",{onClick:T,className:"btn btn-success btn-sm",children:[a($,{})," Add Lead"]})]}),p("div",{className:"flex items-center space-x-2",children:[a(H,{placeholder:"Select an option",options:A,isDisabled:C,className:"cursor-pointer custom-multiselect z-10 w-[300px]",onChange:e=>{(e==null?void 0:e.value)!==void 0&&D(e.value,e.phone)}}),a("button",{onClick:async()=>{if(d.length===0){i.error("Please select at least one lead to remove");return}if((await E.fire({title:"Are you sure?",text:`You are about to remove ${d.length} selected lead(s). This action cannot be undone.`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel"})).isConfirmed)try{const s=d.map(r=>r.id),c=new FormData;s.forEach(r=>c.append("lead_id[]",r));const n=await o(O({formData:c}));n.payload.status===200||n.payload.status===201?(i.success("Lead removed successfully"),m([]),h(!0)):i.error("Failed to remove leads. Please try again.")}catch{i.error("An error occurred while removing leads.")}},type:"button",className:"btn btn-default btn-sm",style:{background:"#d33",color:"#fff"},children:a(z,{})})]})]}),a("div",{className:"datatables mt-6",children:a(W,{title:"New Leads",columns:[{accessor:"id",title:"Select",sortable:!1,render:e=>a("input",{type:"checkbox",className:"form-checkbox",checked:d.some(s=>s.id===e.id),onChange:s=>R(e,s.target.checked)})},{accessor:"title",title:"Title",sortable:!0},{accessor:"name",title:"Name",sortable:!0},{accessor:"phone",title:"Phone",sortable:!0},{accessor:"source",title:"Source",sortable:!0,render:e=>{switch(e.source){case"Facebook":return a("span",{className:"badge bg-info",children:"Facebook"});case"Instagram":return a("span",{className:"badge bg-secondary",children:"Instagram"});case"created own":return a("span",{className:"badge bg-success",children:"Created own"});case"Website":return a("span",{className:"badge bg-warning",children:"Website"});case"Reshuffle":return a("span",{className:"badge bg-primary",children:"Reshuffle"});case"Walk-in":return a("span",{className:"badge bg-danger",children:"Walk-in"});case"Other":return a("span",{className:"badge bg-secondary",children:"Other"});default:return a("span",{className:"badge bg-secondary",children:"Unknown"})}}},{accessor:"date",title:"Date",sortable:!0}],rows:L,totalRecords:x||0,currentPage:S,recordsPerPage:f,onPageChange:e=>{o(g({page:e,sortField:t.columnAccessor,sortOrder:t.direction,search:u})),m([]),h(!0)},onRecordsPerPageChange:e=>{o(g({perPage:e,sortField:t.columnAccessor,sortOrder:t.direction,search:u})),m([]),h(!0)},onSortChange:e=>{k(e),o(g({sortField:e.columnAccessor,sortOrder:e.direction,search:u}))},sortStatus:t,isLoading:_,onSearchChange:e=>{const s=e.target.value;N(s),o(g({page:1,perPage:f,sortField:t.columnAccessor,sortOrder:t.direction,search:s}))},searchValue:u,noRecordsText:"No records found matching your search criteria"})}),a(V,{isOpen:P,onClose:()=>y(!1)})]})};export{he as default};
