import{X as d,u as W,r as n,s as Z,Y as m,j as t,a as o,S as P}from"./index-fd330a89.js";import{o as A}from"./status-9783e7d5.js";import{S as T}from"./react-select.esm-508bfdab.js";import{I as ee}from"./IconTrashLines-2154eee6.js";import{I as te}from"./IconPencil-ccf7807f.js";import{T as se}from"./Table-f77f40b1.js";import"./IconSquareCheck-d42f7918.js";import"./IconStar-2e13c2a3.js";import"./IconTrash-4e6f493a.js";import"./objectWithoutPropertiesLoose-75170e70.js";import"./extends-4c19d496.js";import"./floating-ui.dom-86c7411f.js";import"./index-a2d4dba2.js";const p={createApi:`${d()}/users/create_user`,roleApi:`${d()}/users/get_user_role?for_select=1`,listApi:`${d()}/users/user_list`,destoryApi:`${d()}/users/delete_user`,updateApi:`${d()}/users/update_user`},ge=()=>{const b=W(),c=n.useRef({userformRef:null}),[$,U]=n.useState([]),[F,g]=n.useState(null);n.useState(null);const[r,v]=n.useState({}),[E,D]=n.useState(null),[k,_]=n.useState(null),R=n.useRef(!1),[x,w]=n.useState(1),[N,B]=n.useState(10),[I,j]=n.useState(0),[h,H]=n.useState({columnAccessor:"client_user_id",direction:"asc"}),[S,L]=n.useState(""),[re,z]=n.useState([]);n.useEffect(()=>{R.current||(b(Z("Create User")),O(),R.current=!0)},[b]),n.useEffect(()=>{y()},[x,N,h,S]);const O=async()=>{var e;try{const s=await m.get(p.roleApi);if(s.data){const a=s.data.map(l=>({value:l.id,label:l.name}));D(a)}}catch(s){((e=s.response)==null?void 0:e.status)===403&&(window.location.href="/error")}},y=async()=>{var e;try{const s={page:x,per_page:N,sort_field:h.columnAccessor,sort_order:h.direction,search:S},a=await m.get(p.listApi,{params:s});if(a.data){const l=a.data.data.data||[];U(l);const i=a.data.users.filter(f=>{var u;return(u=f.roles)==null?void 0:u.some(K=>K.name==="Team Head")});console.log(i),z(i),j(a.data.data.total||0)}}catch(s){((e=s.response)==null?void 0:e.status)===403&&(window.location.href="/error")}},Y=async e=>{var s,a,l;e.preventDefault();try{if(c.current.userformRef){const i=new FormData(c.current.userformRef),f=i.get("client_user_id"),u=f?await m.post(`${p.updateApi}/${f}`,i):await m.post(p.createApi,i);(u.status===200||u.status===201)&&(C(u.data.message),y(),v({}),c.current.userformRef.reset(),_(null),g(null))}}catch(i){(a=(s=i.response)==null?void 0:s.data)!=null&&a.errors?v(i.response.data.errors):((l=i.response)==null?void 0:l.status)===403&&(window.location.href="/error")}},C=e=>{P.fire({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,title:e,icon:"success"})},M=async e=>{if(c.current.userformRef){const s=c.current.userformRef;s.reset(),s.client_user_id.value=e.client_user_id||"",s.client_user_name.value=e.client_user_name||"",s.client_user_email.value=e.client_user_email||"",s.client_user_phone.value=e.client_user_phone||"",s.client_user_designation.value=e.client_user_designation||"",s.client_sort_order.value=e.client_sort_order||"",g(e.client_user_status||"");const a=e.roles&&e.roles[0];if(a){const l={value:a.id,label:a.name};_(l)}else _(null)}},Q=async e=>{var a;if((await P.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",cancelButtonText:"No, cancel!"})).isConfirmed)try{const l=await m.delete(p.destoryApi+`/${e.client_user_id}`);(l.status===200||l.status===201)&&(C("User deleted successfully"),y())}catch(l){((a=l.response)==null?void 0:a.status)===403&&(window.location.href="/error")}},q=e=>{_(e)},V=e=>{L(e.target.value),w(1)},X=e=>{w(e)},G=e=>{B(e),w(1)},J=[{accessor:"client_user_id",title:"#",width:80,key:"id"},{accessor:"client_user_name",title:"Name",sortable:!0,key:"client_user_name_column"},{accessor:"client_user_email",title:"Email",sortable:!0,key:"email-column"},{accessor:"actions",title:"Actions",width:120,key:"actions-column",render:e=>o("div",{className:"flex space-x-2",children:[t("button",{type:"button",onClick:()=>M(e),className:"btn px-1 py-0.5 rounded text-white bg-info",children:t(te,{})},`edit-${e.client_user_id}`),t("button",{type:"button",onClick:()=>Q(e),className:"btn px-1 py-0.5 rounded text-white bg-red-600",children:t(ee,{})},`delete-${e.client_user_id}`)]})}];return t("form",{ref:e=>c.current.userformRef=e,onSubmit:Y,className:"space-y-5",children:o("div",{className:"flex flex-wrap -mx-4",children:[t("div",{className:"w-full lg:w-1/3 px-4",children:t("div",{className:"panel",children:t("div",{className:"panel-body",children:o("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[o("div",{className:"form-group",children:[t("label",{htmlFor:"client_user_name",children:"Username"}),t("input",{name:"client_user_name",type:"text",placeholder:"Username",className:"form-input"}),t("input",{type:"hidden",name:"client_user_id",id:"client_user_id"}),r.client_user_name&&t("span",{className:"text-red-500 text-sm",children:r.client_user_name})]}),o("div",{className:"form-group",children:[t("label",{htmlFor:"client_user_phone",children:"Phone"}),t("input",{name:"client_user_phone",type:"tel",placeholder:"Phone",className:"form-input"}),r.client_user_phone&&t("span",{className:"text-red-500 text-sm",children:r.client_user_phone})]}),o("div",{className:"form-group",children:[t("label",{htmlFor:"client_user_designation",children:"Designation"}),t("input",{name:"client_user_designation",type:"text",placeholder:"Designation",className:"form-input"}),r.client_user_designation&&t("span",{className:"text-red-500 text-sm",children:r.client_user_designation})]}),o("div",{className:"form-group",children:[t("label",{htmlFor:"client_user_email",children:"Email"}),t("input",{name:"client_user_email",type:"email",placeholder:"Email",className:"form-input"}),r.client_user_email&&t("span",{className:"text-red-500 text-sm",children:r.client_user_email})]}),o("div",{className:"form-group",children:[t("label",{htmlFor:"password",children:"Password"}),t("input",{name:"password",type:"password",placeholder:"Password",className:"form-input"}),r.password&&t("span",{className:"text-red-500 text-sm",children:r.password})]}),o("div",{className:"form-group",children:[t("label",{htmlFor:"client_user_status",children:"Status"}),t(T,{name:"client_user_status",placeholder:"Select an option",options:A,value:A.find(e=>e.value===F),onChange:e=>g((e==null?void 0:e.value)||null)}),r.client_user_status&&t("span",{className:"text-red-500 text-sm",children:r.client_user_status})]}),o("div",{className:"form-group",children:[t("label",{htmlFor:"client_sort_order",children:"Sort Order"}),t("input",{name:"client_sort_order",type:"text",placeholder:"Sort Order",className:"form-input"}),r.client_sort_order&&t("span",{className:"text-red-500 text-sm",children:r.client_sort_order})]}),o("div",{className:"form-group",children:[t("label",{htmlFor:"role_id",children:"Role"}),t(T,{name:"role_id",placeholder:"Select an option",options:E||[],value:k,onChange:q}),r.role_id&&t("span",{className:"text-red-500 text-sm",children:r.role_id})]}),t("div",{className:"sm:col-span-2 flex justify-end",children:t("button",{type:"submit",className:"btn btn-primary",children:"Submit"})})]})})})}),t("div",{className:"w-full lg:w-2/3 px-2 mt-6 lg:mt-0 md-mt-0",children:t("div",{className:"datatables",children:t(se,{columns:J,rows:$,title:"List of all Users",idAccessor:"client_user_id",totalRecords:I,currentPage:x,recordsPerPage:N,onPageChange:X,onRecordsPerPageChange:G,onSortChange:H,onSearchChange:V,sortStatus:h,isLoading:!1,minHeight:200,noRecordsText:"No users found",searchValue:S})})})]})})};export{ge as default};
