import{b as t,r as n,j as d,A as ce,u as oe,T as de,c as ie,a as ue,s as me,N as g,Q as he,K as R,ac as be}from"./index-f71476f7.js";import{T as fe}from"./Table-c4ae9a6d.js";import{I as pe}from"./IconBell-4219e731.js";import{S as L}from"./react-select.esm-f0223add.js";import{F as ge}from"./index-752a04ed.js";/* empty css                  */import{S as M}from"./status-483caa94.js";import{Y as F,y as z}from"./transition-ee85545a.js";import"./index-c18cdd2b.js";import"./floating-ui.dom.browser.min-b8726d47.js";import"./extends-4c19d496.js";import"./objectWithoutPropertiesLoose-f3b3ace0.js";import"./IconSquareCheck-8a60de1e.js";import"./IconStar-1d1757e4.js";import"./IconTrash-d378d806.js";const xe=r=>{const c=M.find(u=>u.value==r);return c&&typeof c.notes=="string"?c.notes:"Status Changed"},ve=r=>{const c=M.find(u=>u.value==r);return c&&typeof c.notes2=="string"?c.notes2:"Status Changed"},ye=({isOpen:r,onClose:c,comments:u=[]})=>t(F,{appear:!0,show:r,as:n.Fragment,children:d(z,{as:"div",open:r,onClose:c,className:"relative z-[51]",children:[t(F.Child,{as:n.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:t("div",{className:"fixed inset-0 bg-[black]/60"})}),t("div",{className:"fixed inset-0 overflow-y-auto",children:t("div",{className:"flex min-h-full items-center justify-center px-4 py-8",children:t(F.Child,{as:n.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:d(z.Panel,{className:"panel border-0 p-0 rounded-lg overflow-hidden w-full max-w-6xl h-[90vh] text-black dark:text-white-dark",children:[t("button",{type:"button",onClick:c,className:"absolute top-4 ltr:right-4 rtl:left-4 text-gray-400 hover:text-gray-800 dark:hover:text-gray-600 outline-none",children:t(ce,{className:"w-6 h-6"})}),t("div",{className:"text-xl font-semibold bg-[#fbfbfb] dark:bg-[#121c2c] ltr:pl-6 rtl:pr-6 py-4 ltr:pr-[60px] rtl:pl-[60px]",children:"History of the Leads"}),d("div",{className:"p-6 h-full flex flex-col",children:[t("div",{className:"flex-1 overflow-y-auto",children:t("div",{className:"table-responsive text-[#515365] dark:text-white-light font-semibold  overflow-y-hidden",children:t("div",{className:"max-w-[900px] mx-auto",children:u==null?void 0:u.map((s,l)=>{var x,_;return d("div",{className:"flex",children:[t("p",{className:"text-[#3b3f5c] dark:text-white-light min-w-[180px] max-w-[150px] text-sm font-semibold py-2.5",children:(s==null?void 0:s.created_at)||"Invalid Time"}),t("div",{className:`
                                                            relative
                                                            before:absolute before:left-1/2 before:-translate-x-1/2 before:top-[15px] 
                                                            before:w-2.5 before:h-2.5 before:border-2 before:rounded-full
                                                            after:absolute after:left-1/2 after:-translate-x-1/2 after:top-[25px] 
                                                            after:-bottom-[15px] after:w-0 after:h-auto after:border-l-2 
                                                            after:rounded-full
                                                            ${l%5===0?"before:border-primary after:border-primary":l%5===1?"before:border-dark after:border-dark":l%5===2?"before:border-success after:border-success":l%5===3?"before:border-danger after:border-danger":"before:border-warning after:border-warning"}
                                                        `}),d("div",{className:"p-2.5 self-center ltr:ml-2.5 rtl:mr-2.5 w-full",children:[d("div",{className:"flex items-center gap-2 mb-1",children:[t("span",{className:"text-[#3b3f5c] dark:text-white-light font-semibold text-[13px]",children:(s==null?void 0:s.user_id)!==null?s==null?void 0:s.user_name:l>0?(x=u[l-1])==null?void 0:x.user_name:""}),t("span",{className:"text-gray-500 dark:text-gray-400 text-[13px]",dangerouslySetInnerHTML:{__html:xe(s.lead_status||"")}}),s.lead_status==2&&t("span",{className:"text-blue-500 dark:text-blue-400 text-[13px]",children:s==null?void 0:s.agent_name}),l>0&&t("div",{className:"text-gray-500 dark:text-gray-400 text-[13px]",dangerouslySetInnerHTML:{__html:ve(((_=u[l-1])==null?void 0:_.lead_status)||"")}})]}),s.lead_comment&&t("div",{className:"bg-gray-50 dark:bg-gray-800 p-1 border-l-4 border",children:t("p",{className:"text-[#3b3f5c] dark:text-white-light text-sm italic",children:s==null?void 0:s.lead_comment})})]})]},l)})})})}),t("div",{className:"ltr:text-right rtl:text-left flex justify-end items-center mt-6 pt-4 border-t border-gray-200 dark:border-gray-600",children:t("button",{type:"button",className:"btn btn-outline-danger px-6 py-2 text-base",onClick:c,children:"Close"})})]})]})})})})]})}),Ue=()=>{const r=oe(),c=de();ie();const[u,s]=n.useState(!1),[l,x]=n.useState(new Set),[_,N]=n.useState(!1),[_e,A]=n.useState([]),[j,y]=n.useState(!0),[m,U]=n.useState(null),[h,B]=n.useState(null),[b,O]=n.useState(""),[p,T]=n.useState(""),[$,P]=n.useState(!1),[Y,E]=n.useState(null),[o,W]=n.useState({columnAccessor:"lead_id",direction:"desc"}),D=n.useRef({fetched:!1,form:null,prevPage:1,prevPerPage:10,prevSortStatus:{columnAccessor:"lead_id",direction:"desc"}}),{leads:S,loading:H,agents:k,statuses:V,total:K,current_page:w,per_page:f,last_page:Ne}=ue(e=>e.dashboardslice);n.useEffect(()=>{if(r(me("Agents Reports")),!D.current.fetched){Q(),D.current.fetched=!0;return}},[r,w,f,o,b]);const Q=()=>{r(g({page_number:b?1:w,per_page:f,sortField:o.columnAccessor,sortOrder:o.direction,search:b,agent_id:m||void 0,date_range:p,lead_status:h||void 0}))},X=n.useMemo(()=>(k==null?void 0:k.map(e=>({value:e==null?void 0:e.client_user_id,label:e==null?void 0:e.client_user_name,phone:e==null?void 0:e.client_user_phone})))||[],[k]),q=(e,a)=>{const i=new Set(l);a?i.add(e.id):i.delete(e.id),x(i),y(i.size===0),a&&i.size===v.length?N(!0):a||N(!1)},G=e=>{U(e),r(g({page_number:1,per_page:f,sortField:o.columnAccessor,sortOrder:o.direction,search:b,date_range:p,agent_id:e,lead_status:h||void 0}))},J=e=>{B(e.value),r(g({page_number:1,per_page:f,sortField:o.columnAccessor,sortOrder:o.direction,search:b,date_range:p,agent_id:m||void 0,lead_status:e.value}))},Z=()=>{if(!m){c.error("Please select an agent before Search.");return}r(g({page_number:1,per_page:f,sortField:o.columnAccessor,sortOrder:o.direction,search:b,date_range:p,agent_id:m,lead_status:h||void 0}))},I=e=>{const a=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),C=String(e.getDate()).padStart(2,"0");return`${a}-${i}-${C}`},v=n.useMemo(()=>Array.isArray(S)?S.map(e=>({id:e.lead_id||"Unknown",title:e.lead_title||"Unknown",name:e.customer_name||"Unknown",phone:e.customer_phone||"Unknown",source:e.lead_source||"Unknown",date:e.updated_at||"Unknown"})):[],[S]),ee=e=>{r(g({page_number:e,per_page:f,sortField:o.columnAccessor,sortOrder:o.direction,search:b,agent_id:m||void 0,date_range:p,lead_status:h||void 0})),A([]),y(!0)},te=e=>{r(g({page_number:1,per_page:e,sortField:o.columnAccessor,sortOrder:o.direction,search:b,agent_id:m||void 0,date_range:p,lead_status:h||void 0})),A([]),y(!0)},ae=e=>{W(e),r(g({page_number:1,per_page:f,sortField:e.columnAccessor,sortOrder:e.direction,search:b,agent_id:m||void 0,date_range:p,lead_status:h||void 0}))},se=e=>{const a=e.target.value;O(a),r(g({page_number:1,per_page:f,sortField:o.columnAccessor,sortOrder:o.direction,search:a,agent_id:m||void 0,date_range:p,lead_status:h||void 0}))},re=e=>{const a=new Set(l);e?v.forEach(i=>a.add(i.id)):v.forEach(i=>a.delete(i.id)),x(a),y(a.size===0),N(e)},le=async()=>{if(!m){c.error("Please select an agent before taking back leads.");return}if(l.size===0){c.error("Please select the leads you want to take back.");return}try{r(R(!0));const e=Array.from(l),a=await r(be({agent_id:m,lead_ids:e,status_id:h,date_range:p})).unwrap();a.status==="success"?(c.success(a.message||"Selected leads successfully taken back!"),s(!1),x(new Set),A([]),y(!0),N(!1),r(g({page_number:w,per_page:f,sortField:o.columnAccessor,sortOrder:o.direction,search:b,agent_id:m,lead_status:h||void 0}))):c.error(a.message||"Failed to take back leads.")}catch(e){c.error(e.message||"Failed to take back leads.")}finally{r(R(!1))}},ne=[{accessor:"id",title:d("div",{className:"flex items-center",children:[t("input",{type:"checkbox",className:"form-checkbox mr-2",checked:_||v.length>0&&v.every(e=>l.has(e.id)),onChange:e=>re(e.target.checked),disabled:!h}),"Select",l.size>0&&d("span",{className:"ml-2 text-xs",children:["(",l.size," selected)"]})]}),sortable:!1,render:e=>t("input",{type:"checkbox",className:"form-checkbox",checked:l.has(e.id),onChange:a=>q(e,a.target.checked),disabled:!h})},{accessor:"title",title:"Title",sortable:!0},{accessor:"name",title:"Name",sortable:!0},{accessor:"phone",title:"Phone",sortable:!0},{accessor:"source",title:"Source",sortable:!0,render:e=>{switch(e.source){case"Facebook":return t("span",{className:"badge bg-info",children:"Facebook"});case"Instagram":return t("span",{className:"badge bg-secondary",children:"Instagram"});case"created own":return t("span",{className:"badge bg-success",children:"Created own"});case"Website":return t("span",{className:"badge bg-warning",children:"Website"});case"Reshuffle":return t("span",{className:"badge bg-primary",children:"Reshuffle"});case"Walk-in":return t("span",{className:"badge bg-danger",children:"Walk-in"});case"Other":return t("span",{className:"badge bg-secondary",children:"Other"});default:return t("span",{className:"badge bg-secondary",children:"Unknown"})}}},{accessor:"date",title:"Date",sortable:!0},{accessor:"actions",title:"Actions",render:e=>{const a=S.find(i=>i.lead_id===e.id);return t("button",{type:"button",className:"btn btn-secondary btn-sm",style:{height:"23px",borderRadius:"13px"},onClick:()=>{P(!0),E((a==null?void 0:a.comments)||[])},children:" View "})}}];return d("div",{children:[d("div",{className:"panel flex flex-col md:flex-row items-start md:items-center justify-between overflow-visible whitespace-nowrap p-3 text-dark relative gap-4 md:gap-0",children:[d("div",{className:"flex items-center mb-4 md:mb-0",children:[t("div",{className:"rounded-full bg-primary p-1.5 text-white ring-2 ring-primary/30 mr-3",children:t(pe,{})}),t("span",{className:"mr-3",children:"Details of Your Agents Reports."})]}),d("div",{className:"flex flex-col md:flex-row items-stretch md:items-center gap-2 w-full md:w-auto",children:[t("div",{className:"w-full md:w-[200px]",children:t(L,{placeholder:"Select Agent Name",options:X,classNamePrefix:"custom-select",className:"custom-multiselect z-10",onChange:e=>{(e==null?void 0:e.value)!==void 0&&G(e.value)}})}),t("div",{className:"w-full md:w-[200px]",children:t(L,{placeholder:"Select a Status",options:Object.entries(V||{}).map(([e,a])=>({value:e,label:a})),formatOptionLabel:e=>{const a=e.label.match(/^(.*?)\s*\((\d+)\)$/),i=a?a[1]:e.label,C=a?a[2]:null;return d("div",{className:"flex items-center gap-1",children:[i,C&&t("span",{className:"badge bg-success ms-1",children:C})]})},classNamePrefix:"custom-select",className:"custom-multiselect z-10",onChange:e=>{(e==null?void 0:e.value)!==void 0&&J(e)}})}),t("div",{className:"w-full md:w-[200px]",children:t(ge,{options:{mode:"range",dateFormat:"Y-m-d"},className:"form-input",placeholder:"Y-m-d",onChange:e=>{if(e.length===2){const a=I(e[0]),i=I(e[1]);T(`${a},${i}`)}else T("")}})}),d("div",{className:"flex gap-2 mt-2 md:mt-0",children:[d("button",{onClick:Z,type:"button",className:"btn btn-secondary btn-sm flex items-center",children:[t(he,{}),"  Search"]}),t("button",{onClick:()=>s(!0),type:"button",className:"btn btn-danger btn-sm flex items-center",disabled:j,children:"Take Back"})]})]})]}),t("div",{className:"datatables mt-6",children:t(fe,{title:"All Leads",columns:ne,rows:v,totalRecords:K||0,currentPage:w,recordsPerPage:f,onPageChange:ee,onRecordsPerPageChange:te,onSortChange:ae,sortStatus:o,isLoading:H,onSearchChange:se,searchValue:b,noRecordsText:"No records found matching your search criteria"})}),t(ye,{isOpen:$,onClose:()=>P(!1),comments:Y}),u&&t("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:d("div",{className:"bg-white p-6 rounded-lg max-w-md",children:[t("h3",{className:"text-lg font-bold mb-4",children:"Confirm Take Back"}),d("p",{children:["Are you sure you want to take back ",l.size," selected leads?"]}),d("div",{className:"flex justify-end mt-4 space-x-2",children:[t("button",{onClick:()=>s(!1),className:"btn btn-outline-secondary",children:"Cancel"}),t("button",{onClick:le,className:"btn btn-primary",children:"Confirm"})]})]})})]})};export{Ue as default};
