import{u as H,c as J,T as K,r as o,b as Q,s as X,a2 as h,a as u,j as s,a0 as Z,S as ee,a1 as se,a3 as ae}from"./index-7d85d366.js";import{T as te}from"./Table-33825ce1.js";import{I as re}from"./IconBell-c691a1ed.js";import{I as ce}from"./IconPlus-394c1291.js";import{I as oe}from"./IconTrash-7570fdcf.js";import{S as P}from"./react-select.esm-bd6a1f5d.js";import{L as ne}from"./LeadModal-77489bda.js";/* empty css                  */import"./index-8e417d38.js";import"./floating-ui.dom.browser.min-b8726d47.js";import"./extends-4c19d496.js";import"./objectWithoutPropertiesLoose-f3b3ace0.js";import"./transition-c41608a4.js";const xe=()=>{const n=H();J();const i=K();o.useRef({fetched:!1,form:null,prevPage:1,prevPerPage:10,prevSortStatus:{columnAccessor:"id",direction:"desc"}});const[C,f]=o.useState(!1),[r,b]=o.useState(new Set),[le,S]=o.useState(!0),[_,N]=o.useState(!1),[l,T]=o.useState(""),[c,z]=o.useState({columnAccessor:"id",direction:"desc"}),[D,k]=o.useState(null),[F,ie]=o.useState(null),[I,de]=o.useState(""),{leads:v,loading:L,agents:y,total:R,last_page:ue,current_page:w,per_page:m}=Q(e=>e.leadslices),[B,p]=o.useState(!1);o.useEffect(()=>{n(X("Re-Assign Leads")),U()},[n,w,m,c,l]);const U=()=>{n(h({page:l?1:w,perPage:m,sortField:c.columnAccessor,sortOrder:c.direction,search:l}))},A=(y==null?void 0:y.map(e=>({value:e==null?void 0:e.client_user_id,label:e==null?void 0:e.client_user_name,phone:e==null?void 0:e.client_user_phone})))||[],g=o.useMemo(()=>(Array.isArray(v)?v:[]).map(e=>({id:e.lead_id||"Unknown",title:e.lead_title||"Unknown",name:e.customer_name||"Unknown",phone:e.customer_phone||"Unknown",source:e.lead_source||"Unknown",date:e.updated_at||"Unknown"})),[v]),E=()=>{N(!0)},M=(e,a)=>{const t=new Set(r);a?(t.add(e.id),p(!0)):(t.delete(e.id),p(!1)),b(t),S(t.size===0),f(!1)},j=e=>{const a=new Set(r);e?(g.forEach(t=>a.add(t.id)),p(!0)):(g.forEach(t=>a.delete(t.id)),p(!1)),b(a),S(a.size===0),f(e)},W=async(e,a)=>{if(r.size===0){i.error("Please select at least one lead to assign");return}const t=new FormData;Array.from(r).forEach(d=>t.append("lead_id[]",d)),t.append("agent_id",e.toString()),t.append("agent_phone",a.toString());try{const d=await n(Z({formData:t}));(d.payload.status===200||d.payload.status===201)&&(i.success(`${r.size} leads have been assigned successfully`),b(new Set),S(!0),f(!1),k(null),p(!1),n(h({page:l?1:w,perPage:m,sortField:c.columnAccessor,sortOrder:c.direction,search:l})))}catch{i.error("Failed to assign leads")}},Y=async()=>{if(r.size===0){i.error("Please select at least one lead to remove");return}if((await ee.fire({title:"Are you sure?",text:`You are about to remove ${r.size} selected lead(s). This action cannot be undone.`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel"})).isConfirmed)try{const a=new FormData;Array.from(r).forEach(d=>a.append("lead_id[]",d));const t=await n(se({formData:a}));t.payload.status===200||t.payload.status===201?(i.success(`${r.size} leads removed successfully`),b(new Set),S(!0),f(!1)):i.error("Failed to remove leads. Please try again.")}catch{i.error("An error occurred while removing leads.")}},$=e=>{n(h({page:e,sortField:c.columnAccessor,sortOrder:c.direction,search:l}))},O=e=>{n(h({perPage:e,sortField:c.columnAccessor,sortOrder:c.direction,search:l}))},V=e=>{z(e),n(h({sortField:e.columnAccessor,sortOrder:e.direction,search:l}))},q=e=>{const a=e.target.value;T(a),n(h({page:1,perPage:m,sortField:c.columnAccessor,sortOrder:c.direction,search:a}))},G=async e=>{k(e),await n(ae({page:1,perPage:m,sortField:c.columnAccessor,sortOrder:c.direction,search:l,date_range:I,agent_id:e,status_id:F}))},x=[{accessor:"id",title:u("div",{className:"flex items-center",children:[s("input",{type:"checkbox",className:"form-checkbox mr-2",checked:C||g.length>0&&g.every(e=>r.has(e.id)),onChange:e=>j(e.target.checked)}),"Select",r.size>0&&u("span",{className:"ml-2 text-xs",children:["(",r.size," selected)"]})]}),sortable:!1,render:e=>s("input",{type:"checkbox",className:"form-checkbox",checked:r.has(e.id),onChange:a=>M(e,a.target.checked)})},{accessor:"title",title:"Title",sortable:!0},{accessor:"name",title:"Name",sortable:!0},{accessor:"phone",title:"Phone",sortable:!0},{accessor:"source",title:"Source",sortable:!0,render:e=>{switch(e.source){case"Facebook":return s("span",{className:"badge bg-info",children:"Facebook"});case"Instagram":return s("span",{className:"badge bg-secondary",children:"Instagram"});case"created own":return s("span",{className:"badge bg-success",children:"Created own"});case"Website":return s("span",{className:"badge bg-warning",children:"Website"});case"Reshuffle":return s("span",{className:"badge bg-primary",children:"Reshuffle"});case"Walk-in":return s("span",{className:"badge bg-danger",children:"Walk-in"});case"Other":return s("span",{className:"badge bg-secondary",children:"Other"});default:return s("span",{className:"badge bg-secondary",children:"Unknown"})}}},{accessor:"date",title:"Date",sortable:!0}];return u("div",{children:[u("div",{className:"panel flex items-center justify-between overflow-visible whitespace-nowrap p-3 text-dark relative",children:[u("div",{className:"flex items-center",children:[s("div",{className:"rounded-full bg-primary p-1.5 text-white ring-2 ring-primary/30 ltr:mr-3 rtl:ml-3",children:s(re,{})}),s("span",{className:"ltr:mr-3 rtl:ml-3",children:"Details of Your New Leads: "}),u("button",{onClick:E,className:"btn btn-success btn-sm",children:[s(ce,{})," Add Lead"]})]}),u("div",{className:"flex items-center space-x-2",children:[s("div",{className:"w-full md:w-[200px]",children:s(P,{placeholder:"Select an Agent",options:A,isDisabled:B,classNamePrefix:"custom-select",className:"custom-multiselect z-10",value:A.find(e=>e.value===D)||null,onChange:e=>{(e==null?void 0:e.value)!==void 0&&G(e.value)}})}),s(P,{placeholder:"Select an option",options:A,isDisabled:r.size===0,className:"cursor-pointer custom-multiselect z-10 w-[300px]",onChange:e=>{(e==null?void 0:e.value)!==void 0&&W(e.value,e.phone)}}),s("button",{onClick:Y,type:"button",className:"btn btn-default btn-sm",style:{background:"#d33",color:"#fff"},disabled:r.size===0,children:s(oe,{})})]})]}),s("div",{className:"datatables mt-6",children:s(te,{title:"Re-Assign Leads",columns:x||[],rows:g,totalRecords:R||0,currentPage:w,recordsPerPage:m,onPageChange:$,onRecordsPerPageChange:O,onSortChange:V,sortStatus:c,isLoading:L,onSearchChange:q,searchValue:l,noRecordsText:"No records found matching your search criteria"})}),s(ne,{isOpen:_,onClose:()=>N(!1)})]})};export{xe as default};
