import{j as a,r as n,a as o,A as K,u as Q,c as X,T as G,b as J,s as Z,Q as T,a7 as g,K as A,aa as ee}from"./index-3deae604.js";import{T as ae}from"./Table-ef2e5e1a.js";import{I as te}from"./IconBell-2cfcb280.js";import{S as re}from"./react-select.esm-659a3b0b.js";import{L as se}from"./LeadModal-f96af7fa.js";/* empty css                  */import{c as D,u as ne}from"./status-6257633d.js";import"./jspdf.plugin.autotable-271f5bd7.js";import{F as le}from"./index-6c7377c0.js";/* empty css                  */import{Y as _,y as F}from"./transition-dc16cc00.js";import"./index-235d3834.js";import"./floating-ui.dom.browser.min-b8726d47.js";import"./extends-4c19d496.js";import"./objectWithoutPropertiesLoose-f3b3ace0.js";import"./IconSquareCheck-b25be9b1.js";import"./IconStar-ea415950.js";import"./IconTrash-8b9d2b8d.js";const oe=r=>{const t=D.find(d=>d.value==r);return t&&typeof t.notes=="string"?t.notes:"Status Changed"},ce=r=>{const t=D.find(d=>d.value==r);return t&&typeof t.notes2=="string"?t.notes2:"Status Changed"},de=r=>{if(!r)return"Invalid Time";const t=new Date(r);return t.toLocaleDateString()+" "+t.toLocaleTimeString()},ie=({isOpen:r,onClose:t,comments:d=[]})=>a(_,{appear:!0,show:r,as:n.Fragment,children:o(F,{as:"div",open:r,onClose:t,className:"relative z-[51]",children:[a(_.Child,{as:n.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:a("div",{className:"fixed inset-0 bg-[black]/60"})}),a("div",{className:"fixed inset-0 overflow-y-auto",children:a("div",{className:"flex min-h-full items-center justify-center px-4 py-8",children:a(_.Child,{as:n.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:o(F.Panel,{className:"panel border-0 p-0 rounded-lg overflow-hidden w-full max-w-6xl h-[90vh] text-black dark:text-white-dark",children:[a("button",{type:"button",onClick:t,className:"absolute top-4 ltr:right-4 rtl:left-4 text-gray-400 hover:text-gray-800 dark:hover:text-gray-600 outline-none",children:a(K,{className:"w-6 h-6"})}),a("div",{className:"text-xl font-semibold bg-[#fbfbfb] dark:bg-[#121c2c] ltr:pl-6 rtl:pr-6 py-4 ltr:pr-[60px] rtl:pl-[60px]",children:"History of the Leads"}),o("div",{className:"p-6 h-full flex flex-col",children:[a("div",{className:"flex-1 overflow-y-auto",children:a("div",{className:"table-responsive text-[#515365] dark:text-white-light font-semibold",children:a("div",{className:"max-w-[1200px] mx-auto",children:d==null?void 0:d.map((s,i)=>{var k,b,y;return o("div",{className:"flex",children:[a("p",{className:"text-[#3b3f5c] dark:text-white-light min-w-[150px] max-w-[180px] text-base font-semibold py-3",children:de(s.created_at)}),a("div",{className:`
                                                            relative
                                                            before:absolute before:left-1/2 before:-translate-x-1/2 before:top-[18px] 
                                                            before:w-3 before:h-3 before:border-[3px] before:rounded-full
                                                            after:absolute after:left-1/2 after:-translate-x-1/2 after:top-[30px] 
                                                            after:-bottom-[15px] after:w-0 after:h-auto after:border-l-[3px] 
                                                            after:rounded-full
                                                            ${i%5===0?"before:border-primary after:border-primary":i%5===1?"before:border-dark after:border-dark":i%5===2?"before:border-success after:border-success":i%5===3?"before:border-danger after:border-danger":"before:border-warning after:border-warning"}
                                                        `}),o("div",{className:"p-3 self-center ltr:ml-3 rtl:mr-3 w-full",children:[o("div",{className:"flex items-center gap-3 mb-2",children:[a("span",{className:"text-[#3b3f5c] dark:text-white-light font-semibold text-[15px]",children:(s==null?void 0:s.user_name)||(i>0?(k=d[i-1])==null?void 0:k.user_name:"System")}),a("span",{className:"text-gray-500 dark:text-gray-400 text-[15px]",dangerouslySetInnerHTML:{__html:oe(s.lead_status)}}),s.lead_status===2&&a("span",{className:"text-blue-500 dark:text-blue-400 text-[15px]",children:((b=s==null?void 0:s.agent)==null?void 0:b.client_user_name)||(s==null?void 0:s.agent_name)}),i>0&&a("div",{className:"text-gray-500 dark:text-gray-400 text-[15px]",dangerouslySetInnerHTML:{__html:ce((y=d[i-1])==null?void 0:y.lead_status)}})]}),s.lead_comment&&a("div",{className:"bg-gray-50 dark:bg-gray-800 p-2 border-l-4 border-gray-200 dark:border-gray-600 rounded-r",children:a("p",{className:"text-[#3b3f5c] dark:text-white-light text-base italic",children:s.lead_comment})})]})]},s.lead_comment_id)})})})}),a("div",{className:"ltr:text-right rtl:text-left flex justify-end items-center mt-6 pt-4 border-t border-gray-200 dark:border-gray-600",children:a("button",{type:"button",className:"btn btn-outline-danger px-6 py-2 text-base",onClick:t,children:"Close"})})]})]})})})})]})}),Me=()=>{const r=Q();X();const t=G();ne();const d=n.useRef({fetched:!1,form:null,prevPage:1,prevPerPage:10,prevSortStatus:{columnAccessor:"lead_id",direction:"desc"}}),[s,i]=n.useState([]),[k,b]=n.useState(!0),[y,L]=n.useState(!1),[p,R]=n.useState(null);n.useState(null);const[u,I]=n.useState(""),[l,M]=n.useState({columnAccessor:"lead_id",direction:"desc"}),[O,N]=n.useState(!1),{leads:f,loading:j,agents:v,total:U,last_page:ue,current_page:S,per_page:h}=J(e=>e.leadslices),[x,w]=n.useState(""),[B,C]=n.useState(!1),[Y,$]=n.useState(null);n.useEffect(()=>{r(Z("Agents Reports"));const e=()=>{r(g({page:u?1:S,perPage:h,sortField:l.columnAccessor,sortOrder:l.direction,search:u,date_range:x}))};if(!d.current.fetched){e(),d.current.fetched=!0;return}},[r,S,h,l,u]);const W=v==null?void 0:v.map(e=>({value:e==null?void 0:e.client_user_id,label:e==null?void 0:e.client_user_name,phone:e==null?void 0:e.client_user_phone})),z=e=>{R(e)},E=async()=>{if(!p){t.error("Please select an agent before Search.");return}r(g({page:1,perPage:h,sortField:l.columnAccessor,sortOrder:l.direction,search:u,date_range:x,agent_id:p}))},H=async()=>{if(!p){t.error("Please select an agent before taking back leads.");return}if(f.length===0){t.error("No leads found to take back.");return}try{if(A(!0),f.map(m=>m.lead_id).length===0){t.error("No leads available to take back.");return}const c=await r(ee({agent_id:p})).unwrap();c.status==="success"?(t.success(c.message||"Leads successfully taken back!"),N(!1),i([]),b(!0)):t.error(c.message||"Failed to take back leads."),r(g({page:1,perPage:h,sortField:l.columnAccessor,sortOrder:l.direction,search:u,date_range:x,agent_id:p}))}catch{t.error("Failed to take back leads.")}finally{A(!0)}},P=e=>{const c=e.getFullYear(),m=String(e.getMonth()+1).padStart(2,"0"),q=String(e.getDate()).padStart(2,"0");return`${c}-${m}-${q}`},V=n.useMemo(()=>(Array.isArray(f)?f:[]).map(e=>({id:e.lead_id||"Unknown",title:e.lead_title||"Unknown",name:e.customer_name||"Unknown",phone:e.customer_phone||"Unknown",source:e.lead_source||"Unknown",date:e.assigned_at?new Date(e.assigned_at).toLocaleString():"Unknown"})),[f]);return o("div",{children:[o("div",{className:"panel flex items-center justify-between overflow-visible whitespace-nowrap p-3 text-dark relative",children:[o("div",{className:"flex items-center",children:[o("div",{className:"rounded-full bg-primary p-1.5 text-white ring-2 ring-primary/30 ltr:mr-3 rtl:ml-3",children:[" ",a(te,{})," "]}),a("span",{className:"ltr:mr-3 rtl:ml-3",children:" Details of Your Agents Reports. "})]}),o("div",{className:"flex items-center space-x-2",children:[a("div",{className:"w-[500px]",children:a(re,{placeholder:"Select an option",options:W,classNamePrefix:"custom-select",className:"custom-multiselect z-10",onChange:e=>{(e==null?void 0:e.value)!==void 0&&z(e.value)}})}),a(le,{options:{mode:"range",dateFormat:"Y-m-d"},className:"form-input",placeholder:"Y-m-d",onChange:e=>{if(e.length===2){const c=P(e[0]),m=P(e[1]);w(`${c},${m}`)}else w("")}}),o("button",{onClick:()=>{E()},type:"button",className:"btn btn-secondary btn-sm",children:[a(T,{}),"  Search"]}),o("button",{onClick:()=>N(!0),type:"button",className:"btn btn-secondary btn-sm",children:[a(T,{}),"   Take-Back"]})]})]}),a("div",{className:"datatables mt-6",children:a(ae,{title:"All Leads",columns:[{accessor:"title",title:"Title",sortable:!0},{accessor:"name",title:"Name",sortable:!0},{accessor:"phone",title:"Phone",sortable:!0},{accessor:"source",title:"Source",sortable:!0,render:e=>{switch(e.source){case"Facebook":return a("span",{className:"badge bg-info",children:"Facebook"});case"Instagram":return a("span",{className:"badge bg-secondary",children:"Instagram"});case"created own":return a("span",{className:"badge bg-success",children:"Created own"});case"Website":return a("span",{className:"badge bg-warning",children:"Website"});case"Reshuffle":return a("span",{className:"badge bg-primary",children:"Reshuffle"});case"Walk-in":return a("span",{className:"badge bg-danger",children:"Walk-in"});case"Other":return a("span",{className:"badge bg-secondary",children:"Other"});default:return a("span",{className:"badge bg-secondary",children:"Unknown"})}}},{accessor:"date",title:"Date",sortable:!0},{accessor:"actions",title:"Actions",render:e=>{const c=f.find(m=>m.lead_id===e.id);return a("button",{type:"button",className:"btn btn-secondary btn-sm",style:{height:"23px",borderRadius:"13px"},onClick:()=>{C(!0),$((c==null?void 0:c.comments)||[])},children:"View"})}}],rows:V,totalRecords:U||0,currentPage:S,recordsPerPage:h,onPageChange:e=>{r(g({page:e,sortField:l.columnAccessor,sortOrder:l.direction,search:u,agent_id:p,date_range:x})),i([]),b(!0)},onRecordsPerPageChange:e=>{r(g({perPage:e,sortField:l.columnAccessor,sortOrder:l.direction,search:u,agent_id:p,date_range:x})),i([]),b(!0)},onSortChange:e=>{M(e),r(g({page:1,perPage:h,sortField:l.columnAccessor,sortOrder:l.direction,search:u,agent_id:p,date_range:x}))},sortStatus:l,isLoading:j,onSearchChange:e=>{const c=e.target.value;I(c),r(g({page:1,perPage:h,sortField:l.columnAccessor,sortOrder:l.direction,search:c}))},searchValue:u,noRecordsText:"No records found matching your search criteria"})}),a(se,{isOpen:y,onClose:()=>L(!1)}),a(ie,{isOpen:B,onClose:()=>C(!1),comments:Y}),O&&a("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:o("div",{className:"bg-white p-6 rounded-lg max-w-md",children:[a("h3",{className:"text-lg font-bold mb-4",children:"Confirm Take Back"}),o("p",{children:["Are you sure you want to take back ",s.length," selected leads?"]}),o("div",{className:"flex justify-end mt-4 space-x-2",children:[a("button",{onClick:()=>N(!1),className:"btn btn-outline-secondary",children:" Cancel"}),a("button",{onClick:H,className:"btn btn-primary",children:"Confirm"})]})]})})]})};export{Me as default};
