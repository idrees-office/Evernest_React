import{u as U,r as c,b as p,s as $,j as a,a as r,L as N,Y as v}from"./index-8c443b3c.js";import{_ as S}from"./react-apexcharts.min-8ee65853.js";import{a as C}from"./IconSquareCheck-2454da0b.js";import{s as f}from"./status-738f839e.js";import{C as A}from"./CustomSideNav-908594e8.js";import"./IconStar-60f4cd12.js";import"./IconTrash-313bffc7.js";import"./react-select.esm-18870520.js";import"./objectWithoutPropertiesLoose-f3b3ace0.js";import"./extends-4c19d496.js";import"./floating-ui.dom.browser.min-b8726d47.js";const K=()=>{const g=U(),[L,u]=c.useState(!0),[i,j]=c.useState(null),[b,y]=c.useState(null);p(e=>e.themeConfig.theme==="dark"||e.themeConfig.isDarkMode),p(e=>e.themeConfig.rtlClass);const[k,h]=c.useState(!1),[n,D]=c.useState({agents:[],statuses:[]}),m=p(e=>e.auth.user||{}),[x,F]=c.useState({series:[],options:{}});c.useEffect(()=>{g($("Leads Analysis"))},[g]),c.useEffect(()=>{const e=async()=>{try{u(!0);const t=new URLSearchParams;n.agents.length>0&&t.append("agents",n.agents.join(",")),n.statuses.length>0&&t.append("statuses",n.statuses.join(","));const l=await v.get(`/leads/leads-analysis?${t.toString()}`);if(l.status===200)console.log(l.data.data),j(l.data.data);else throw new Error("Failed to fetch data")}catch(t){y(t)}finally{u(!1)}};(async()=>{try{const t=new URLSearchParams;n.agents.length>0&&t.append("agents",n.agents.join(",")),n.statuses.length>0&&t.append("statuses",n.statuses.join(","));const l=await v.get(`/leads/total-leads?${t.toString()}`);if(l.status===200)F(l.data);else throw new Error("Failed to fetch agent leads chart data")}catch(t){y(t)}})(),e()},[n]);const O=e=>{if(!(i!=null&&i.daily_counts))return[];const o=i.daily_counts[e]||{},t=Object.entries(o).sort(([s],[d])=>new Date(s).getTime()-new Date(d).getTime()).map(([s,d])=>({x:s,y:d})),l=f().find(s=>s.value==e);return[{name:(l==null?void 0:l.label)||`Status ${e}`,data:t.length>0?t:[{x:new Date().toISOString().split("T")[0],y:0}]}]},T=e=>({chart:{height:160,type:"area",fontFamily:"Nunito, sans-serif",sparkline:{enabled:!0}},stroke:{curve:"smooth",width:2},colors:[e],fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.7,opacityTo:.1,stops:[0,90,100]}},grid:{padding:{top:5}},yaxis:{show:!1},tooltip:{x:{show:!0,format:"dd MMM yyyy"},y:{title:{formatter:()=>""}}}}),w=["#4361ee","#805dca","#00ab55","#e7515a","#ffbb44","#2196f3","#3b3f5c"],E=(e,o)=>{const t=f().find(s=>s.label===e),l=w[o%w.length];return{icon:(t==null?void 0:t.icon)||a(C,{className:"w-5 h-5"}),bgColor:t?`${t.bgColor}/10`:"bg-primary/10",color:l}},I=e=>{D(e),h(!1)};return L?a("div",{className:"text-center py-10",children:"Loading..."}):b?r("div",{className:"text-center py-10 text-danger",children:["Error: ",b.message]}):i?r("div",{children:[r("div",{className:"flex items-center justify-between mb-6",children:[r("ul",{className:"flex space-x-2 rtl:space-x-reverse",children:[r("li",{children:[a(N,{to:"/",className:"text-primary hover:underline",children:" Dashboard "})," "]}),a("li",{className:"before:content-['/'] ltr:before:mr-2 rtl:before:ml-2",children:a("span",{children:"Analytics"})})]}),r("div",{className:"flex space-x-2 rtl:space-x-reverse",children:[r("span",{className:"badge bg-dark text-white",children:["Overall Leads: ",i.total_leads]}),r("span",{className:"badge bg-info text-white",children:["Filtered Leads: ",Object.values(i.status_counts).reduce((e,o)=>e+o,0)," leads"]})]}),r("div",{className:"flex items-center",children:[a(N,{to:"/pages/leads/dashboard",className:"btn btn-success btn-sm",children:" Lead Dashboard "}),"    ",(m==null?void 0:m.roles[0].name)==="super admin"&&a("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:()=>h(!0),children:" Update Filter "})]})]}),r("div",{className:"pt-5",children:[a("div",{className:"grid sm:grid-cols-2 xl:grid-cols-4 gap-6 mb-6",children:Object.entries(i.percentages).map(([e,o],t)=>{const l=Number(e),s=f().find(_=>_.value==l),d=E((s==null?void 0:s.label)||"",t);return r("div",{className:"panel h-full p-0 rounded-2xl shadow-md bg-white dark:bg-gray-900",children:[r("div",{className:"flex items-center p-5",children:[a("div",{className:`flex items-center justify-center w-12 h-12 rounded-full ${d.bgColor}`,style:{color:d.color},children:(s==null?void 0:s.icon)||a(C,{className:"w-5 h-5"})}),r("div",{className:"ml-4",children:[r("p",{className:"text-2xl font-bold text-gray-800 dark:text-white",children:[o,"%"]}),a("span",{className:"text-sm text-gray-500 dark:text-white-light",children:(s==null?void 0:s.label)||`Status ${e}`}),r("p",{className:"text-sm text-gray-500 dark:text-white-light mt-1",children:[i.status_counts[e]," leads"]})]})]}),a("div",{className:"relative h-40",children:a(S,{series:O(l),options:T(d.color),type:"area",height:160,className:"absolute bottom-0 w-full overflow-hidden"})})]},e)})}),a("div",{className:"grid mb-6",children:r("div",{className:"panel h-full",children:[a("div",{className:"flex items-start justify-between dark:text-white-light mb-5 p-5 border-b border-white-light dark:border-[#1b2e4b]",children:a("h5",{className:"font-semibold text-lg",children:"Total Leads Agent Wise"})}),a(S,{series:x.series,options:x.options,type:"bar",height:160})]})})]}),a(A,{isOpen:k,onClose:()=>h(!1),onFilterUpdate:I,initialFilters:n,leadId:null,onSuccess:()=>{}})]}):a("div",{className:"text-center py-10",children:"No data available"})};export{K as default};
