import{u as E,r as d,b as f,s as T,j as t,a,L as k,P as U,F as P,Y as R}from"./index-51f22d1e.js";import{_ as C,I as $}from"./IconChatDots-e409031a.js";import{a as S}from"./IconSquareCheck-62da9a27.js";import{s as b}from"./status-65c1fd98.js";import{C as J}from"./CustomSideNav-deb46ded.js";import"./IconStar-511b1ba7.js";import"./IconTrash-cda6fc4e.js";import"./react-select.esm-1d861681.js";import"./objectWithoutPropertiesLoose-f3b3ace0.js";import"./extends-4c19d496.js";import"./floating-ui.dom.browser.min-b8726d47.js";const ee=()=>{var v;const g=E(),[_,u]=d.useState(!0),[i,D]=d.useState(null),[x,F]=d.useState(null),h=f(e=>e.themeConfig.theme==="dark"||e.themeConfig.isDarkMode),y=f(e=>e.themeConfig.rtlClass)==="rtl",[L,p]=d.useState(!1),[c,j]=d.useState({agents:[],statuses:[]}),m=f(e=>e.auth.user||{});d.useEffect(()=>{g(T("Leads Analysis"))},[g]),d.useEffect(()=>{(async()=>{try{u(!0);const r=new URLSearchParams;c.agents.length>0&&r.append("agents",c.agents.join(",")),c.statuses.length>0&&r.append("statuses",c.statuses.join(","));const l=await R.get(`/leads/leads-analysis?${r.toString()}`);if(l.status===200)console.log(l.data.data),D(l.data.data);else throw new Error("Failed to fetch data")}catch(r){F(r)}finally{u(!1)}})()},[c]);const O=e=>{if(!(i!=null&&i.daily_counts))return[];const r=i.daily_counts[e]||{},l=Object.entries(r).sort(([s],[o])=>new Date(s).getTime()-new Date(o).getTime()).map(([s,o])=>({x:s,y:o})),n=b().find(s=>s.value==e);return[{name:(n==null?void 0:n.label)||`Status ${e}`,data:l.length>0?l:[{x:new Date().toISOString().split("T")[0],y:0}]}]},A=e=>({chart:{height:160,type:"area",fontFamily:"Nunito, sans-serif",sparkline:{enabled:!0}},stroke:{curve:"smooth",width:2},colors:[e],fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.7,opacityTo:.1,stops:[0,90,100]}},grid:{padding:{top:5}},yaxis:{show:!1},tooltip:{x:{show:!0,format:"dd MMM yyyy"},y:{title:{formatter:()=>""}}}}),N=["#4361ee","#805dca","#00ab55","#e7515a","#ffbb44","#2196f3","#3b3f5c"],I=(e,r)=>{const l=b().find(s=>s.label===e),n=N[r%N.length];return{icon:(l==null?void 0:l.icon)||t(S,{className:"w-5 h-5"}),bgColor:l?`${l.bgColor}/10`:"bg-primary/10",color:n}},z=e=>{j(e),p(!1)};if(_)return t("div",{className:"text-center py-10",children:"Loading..."});if(x)return a("div",{className:"text-center py-10 text-danger",children:["Error: ",x.message]});if(!i)return t("div",{className:"text-center py-10",children:"No data available"});const w={series:[{name:"Direct",data:[58,44,55,57,56,61,58,63,60,66,56,63]},{name:"Organic",data:[91,76,85,101,98,87,105,91,114,94,66,70]}],options:{chart:{height:360,type:"bar",fontFamily:"Nunito, sans-serif",toolbar:{show:!1}},dataLabels:{enabled:!1},stroke:{width:2,colors:["transparent"]},colors:["#5c1ac3","#ffbb44"],dropShadow:{enabled:!0,blur:3,color:"#515365",opacity:.4},plotOptions:{bar:{horizontal:!1,columnWidth:"55%",borderRadius:8,borderRadiusApplication:"end"}},legend:{position:"bottom",horizontalAlign:"center",fontSize:"14px",itemMargin:{horizontal:8,vertical:8}},grid:{borderColor:h?"#191e3a":"#e0e6ed",padding:{left:20,right:20},xaxis:{lines:{show:!1}}},xaxis:{categories:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],axisBorder:{show:!0,color:h?"#3b3f5c":"#e0e6ed"}},yaxis:{tickAmount:6,opposite:!!y,labels:{offsetX:y?-10:0}},fill:{type:"gradient",gradient:{shade:h?"dark":"light",type:"vertical",shadeIntensity:.3,inverseColors:!1,opacityFrom:1,opacityTo:.8,stops:[0,100]}},tooltip:{marker:{show:!0}}}};return a("div",{children:[a("div",{className:"flex items-center justify-between mb-6",children:[a("ul",{className:"flex space-x-2 rtl:space-x-reverse",children:[a("li",{children:[t(k,{to:"/",className:"text-primary hover:underline",children:" Dashboard "})," "]}),t("li",{className:"before:content-['/'] ltr:before:mr-2 rtl:before:ml-2",children:t("span",{children:"Analytics"})})]}),a("div",{className:"flex space-x-2 rtl:space-x-reverse",children:[a("span",{className:"badge bg-dark text-white",children:["Overall Leads: ",i.total_leads]}),a("span",{className:"badge bg-info text-white",children:["Filtered Leads: ",Object.values(i.status_counts).reduce((e,r)=>e+r,0)," leads"]})]}),a("div",{className:"flex items-center",children:[t(k,{to:"/pages/leads/dashboard",className:"btn btn-success btn-sm",children:" Lead Dashboard "}),"    ",(m==null?void 0:m.roles[0].name)==="super admin"&&t("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:()=>p(!0),children:" Update Filter "})]})]}),a("div",{className:"pt-5",children:[t("div",{className:"grid sm:grid-cols-2 xl:grid-cols-4 gap-6 mb-6",children:Object.entries(i.percentages).map(([e,r],l)=>{const n=Number(e),s=b().find(M=>M.value==n),o=I((s==null?void 0:s.label)||"",l);return a("div",{className:"panel h-full p-0 rounded-2xl shadow-md bg-white dark:bg-gray-900",children:[a("div",{className:"flex items-center p-5",children:[t("div",{className:`flex items-center justify-center w-12 h-12 rounded-full ${o.bgColor}`,style:{color:o.color},children:(s==null?void 0:s.icon)||t(S,{className:"w-5 h-5"})}),a("div",{className:"ml-4",children:[a("p",{className:"text-2xl font-bold text-gray-800 dark:text-white",children:[r,"%"]}),t("span",{className:"text-sm text-gray-500 dark:text-white-light",children:(s==null?void 0:s.label)||`Status ${e}`}),a("p",{className:"text-sm text-gray-500 dark:text-white-light mt-1",children:[i.status_counts[e]," leads"]})]})]}),t("div",{className:"relative h-40",children:t(C,{series:O(n),options:A(o.color),type:"area",height:160,className:"absolute bottom-0 w-full overflow-hidden"})})]},e)})}),a("div",{className:"grid lg:grid-cols-3 gap-6 mb-6",children:[a("div",{className:"panel h-full p-0 lg:col-span-2",children:[t("div",{className:"flex items-start justify-between dark:text-white-light mb-5 p-5 border-b border-white-light dark:border-[#1b2e4b]",children:t("h5",{className:"font-semibold text-lg",children:"Unique Visitors"})}),t(C,{options:w.options,series:w.series,type:"bar",height:360,className:"overflow-hidden"})]}),a("div",{className:"panel h-full",children:[t("div",{className:"flex items-start justify-between dark:text-white-light mb-5 -mx-5 p-5 pt-0 border-b border-white-light dark:border-[#1b2e4b]",children:t("h5",{className:"font-semibold text-lg",children:"Last Activities Report"})}),t(U,{className:"perfect-scrollbar relative h-[360px] ltr:pr-3 rtl:pl-3 ltr:-mr-3 rtl:-ml-3",children:t("div",{className:"space-y-7",children:(v=i.recent_comments)==null?void 0:v.map(e=>{var r;return a("div",{className:"flex",children:[t("div",{className:"shrink-0 ltr:mr-2 rtl:ml-2 relative z-10 before:w-[2px] before:h-[calc(100%-24px)] before:bg-white-dark/30 before:absolute before:top-10 before:left-4",children:t("div",{className:"bg-primary shadow-primary w-8 h-8 rounded-full flex items-center justify-center text-white",children:t($,{className:"w-4 h-4"})})}),a("div",{children:[a("h5",{className:"font-semibold dark:text-white-light",children:[" ",e.lead_comment," "]}),a("p",{className:"text-white-dark text-xs",children:["Lead : ",e.lead.lead_title," | ",e.created_at]}),t("span",{className:"badge bg-success text-white",children:e.agent_id?a(P,{children:[" ",((r=e==null?void 0:e.agents)==null?void 0:r.client_user_name)||"Null"," "]}):t("span",{className:"badge bg-success text-white",children:"No Agent Assigned"})})]})]},e.lead_comment_id)})})})]})]})]}),t(J,{isOpen:L,onClose:()=>p(!1),onFilterUpdate:z,initialFilters:c,leadId:null,onSuccess:()=>{}})]})};export{ee as default};
