import{j as t,r as n,a as c,A as ie,u as ue,c as me,T as he,b as pe,s as fe,Q as R,a3 as x,K as M,ab as ge}from"./index-c5439c4c.js";import{T as be}from"./Table-d620ae2d.js";import{I as xe}from"./IconBell-4a11cbe9.js";import{S as z}from"./react-select.esm-f91cd7c3.js";import{L as ye}from"./LeadModal-0e3570c8.js";/* empty css                  */import{c as j,u as Se}from"./status-6e00c60b.js";import"./jspdf.plugin.autotable-7337cd99.js";import{F as Ne}from"./index-6e654a65.js";/* empty css                  */import{Y as T,y as O}from"./transition-99725022.js";import"./index-25858b06.js";import"./floating-ui.dom.browser.min-b8726d47.js";import"./extends-4c19d496.js";import"./objectWithoutPropertiesLoose-f3b3ace0.js";import"./IconSquareCheck-bba19465.js";import"./IconStar-31ad9f4a.js";import"./IconTrash-6e9d8eed.js";const we=s=>{const r=j.find(i=>i.value==s);return r&&typeof r.notes=="string"?r.notes:"Status Changed"},ve=s=>{const r=j.find(i=>i.value==s);return r&&typeof r.notes2=="string"?r.notes2:"Status Changed"},ke=s=>{if(!s)return"Invalid Time";const r=new Date(s);return r.toLocaleDateString()+" "+r.toLocaleTimeString()},_e=({isOpen:s,onClose:r,comments:i=[]})=>t(T,{appear:!0,show:s,as:n.Fragment,children:c(O,{as:"div",open:s,onClose:r,className:"relative z-[51]",children:[t(T.Child,{as:n.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:t("div",{className:"fixed inset-0 bg-[black]/60"})}),t("div",{className:"fixed inset-0 overflow-y-auto",children:t("div",{className:"flex min-h-full items-center justify-center px-4 py-8",children:t(T.Child,{as:n.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:c(O.Panel,{className:"panel border-0 p-0 rounded-lg overflow-hidden w-full max-w-6xl h-[90vh] text-black dark:text-white-dark",children:[t("button",{type:"button",onClick:r,className:"absolute top-4 ltr:right-4 rtl:left-4 text-gray-400 hover:text-gray-800 dark:hover:text-gray-600 outline-none",children:t(ie,{className:"w-6 h-6"})}),t("div",{className:"text-xl font-semibold bg-[#fbfbfb] dark:bg-[#121c2c] ltr:pl-6 rtl:pr-6 py-4 ltr:pr-[60px] rtl:pl-[60px]",children:"History of the Leads"}),c("div",{className:"p-6 h-full flex flex-col",children:[t("div",{className:"flex-1 overflow-y-auto",children:t("div",{className:"table-responsive text-[#515365] dark:text-white-light font-semibold",children:t("div",{className:"max-w-[1200px] mx-auto",children:i==null?void 0:i.map((d,u)=>{var C,y,N;return c("div",{className:"flex",children:[t("p",{className:"text-[#3b3f5c] dark:text-white-light min-w-[150px] max-w-[180px] text-base font-semibold py-3",children:ke(d.created_at)}),t("div",{className:`
                                                            relative
                                                            before:absolute before:left-1/2 before:-translate-x-1/2 before:top-[18px] 
                                                            before:w-3 before:h-3 before:border-[3px] before:rounded-full
                                                            after:absolute after:left-1/2 after:-translate-x-1/2 after:top-[30px] 
                                                            after:-bottom-[15px] after:w-0 after:h-auto after:border-l-[3px] 
                                                            after:rounded-full
                                                            ${u%5===0?"before:border-primary after:border-primary":u%5===1?"before:border-dark after:border-dark":u%5===2?"before:border-success after:border-success":u%5===3?"before:border-danger after:border-danger":"before:border-warning after:border-warning"}
                                                        `}),c("div",{className:"p-3 self-center ltr:ml-3 rtl:mr-3 w-full",children:[c("div",{className:"flex items-center gap-3 mb-2",children:[t("span",{className:"text-[#3b3f5c] dark:text-white-light font-semibold text-[15px]",children:(d==null?void 0:d.user_name)||(u>0?(C=i[u-1])==null?void 0:C.user_name:"System")}),t("span",{className:"text-gray-500 dark:text-gray-400 text-[15px]",dangerouslySetInnerHTML:{__html:we(d.lead_status)}}),d.lead_status===2&&t("span",{className:"text-blue-500 dark:text-blue-400 text-[15px]",children:((y=d==null?void 0:d.agent)==null?void 0:y.client_user_name)||(d==null?void 0:d.agent_name)}),u>0&&t("div",{className:"text-gray-500 dark:text-gray-400 text-[15px]",dangerouslySetInnerHTML:{__html:ve((N=i[u-1])==null?void 0:N.lead_status)}})]}),d.lead_comment&&t("div",{className:"bg-gray-50 dark:bg-gray-800 p-2 border-l-4 border-gray-200 dark:border-gray-600 rounded-r",children:t("p",{className:"text-[#3b3f5c] dark:text-white-light text-base italic",children:d.lead_comment})})]})]},d.lead_comment_id)})})})}),t("div",{className:"ltr:text-right rtl:text-left flex justify-end items-center mt-6 pt-4 border-t border-gray-200 dark:border-gray-600",children:t("button",{type:"button",className:"btn btn-outline-danger px-6 py-2 text-base",onClick:r,children:"Close"})})]})]})})})})]})}),Ve=()=>{const s=ue();me();const r=he();Se();const i=n.useRef({fetched:!1,form:null,prevPage:1,prevPerPage:10,prevSortStatus:{columnAccessor:"lead_id",direction:"desc"}}),[d,u]=n.useState([]),[C,y]=n.useState(!0),[N,U]=n.useState(!1),[h,B]=n.useState(null),[p,$]=n.useState(null),[m,Y]=n.useState(""),[l,E]=n.useState({columnAccessor:"lead_id",direction:"desc"}),[W,P]=n.useState(!1),[H,w]=n.useState(!1),[f,A]=n.useState(new Set),{leads:v,loading:V,agents:F,statuses:q,total_leads:Ce,total:K,last_page:Pe,current_page:k,per_page:g}=pe(e=>e.leadslices),[b,D]=n.useState(""),[Q,L]=n.useState(!1),[X,G]=n.useState(null);n.useEffect(()=>{s(fe("Agents Reports"));const e=()=>{s(x({page:m?1:k,perPage:g,sortField:l.columnAccessor,sortOrder:l.direction,search:m,agent_id:h,date_range:b,status_id:p}))};if(!i.current.fetched){e(),i.current.fetched=!0;return}},[s,k,g,l,m]);const J=F==null?void 0:F.map(e=>({value:e==null?void 0:e.client_user_id,label:e==null?void 0:e.client_user_name,phone:e==null?void 0:e.client_user_phone})),Z=(e,a)=>{const o=new Set(f);a?o.add(e.id):o.delete(e.id),A(o),y(o.size===0),a&&o.size===S.length?w(!0):a||w(!1)},ee=async e=>{B(e),await s(x({page:1,perPage:g,sortField:l.columnAccessor,sortOrder:l.direction,search:m,date_range:b,agent_id:e,status_id:p}))},te=async e=>{$(e.value),await s(x({page:1,perPage:g,sortField:l.columnAccessor,sortOrder:l.direction,search:m,date_range:b,agent_id:h,status_id:e.value}))},ae=async()=>{if(!h){r.error("Please select an agent before Search.");return}await s(x({page:1,perPage:g,sortField:l.columnAccessor,sortOrder:l.direction,search:m,date_range:b,agent_id:h,status_id:p}))},se=async()=>{if(!h){r.error("Please select an agent before taking back leads.");return}if(f.size===0){r.error("Please select the leads you want to take back.");return}try{M(!0);const e=Array.from(f),a=await s(ge({agent_id:h,lead_ids:e,status_id:p,date_range:b})).unwrap();a.status==="success"?(r.success(a.message||"Selected leads successfully taken back!"),P(!1),A(new Set),u([]),y(!0),w(!1),s(x({page:k,perPage:g,sortField:l.columnAccessor,sortOrder:l.direction,search:m,date_range:b,agent_id:h,status_id:p}))):r.error(a.message||"Failed to take back leads.")}catch(e){r.error(e.message||"Failed to take back leads.")}finally{M(!1)}},I=e=>{const a=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),_=String(e.getDate()).padStart(2,"0");return`${a}-${o}-${_}`},S=n.useMemo(()=>(Array.isArray(v)?v:[]).map(e=>({id:e.lead_id||"Unknown",title:e.lead_title||"Unknown",name:e.customer_name||"Unknown",phone:e.customer_phone||"Unknown",source:e.lead_source||"Unknown",date:e.assigned_at?new Date(e.assigned_at).toLocaleString():"Unknown"})),[v]),re=e=>{s(x({page:e,sortField:l.columnAccessor,sortOrder:l.direction,search:m,agent_id:h,date_range:b,status_id:p})),u([]),y(!0)},le=e=>{s(x({perPage:e,sortField:l.columnAccessor,sortOrder:l.direction,search:m,agent_id:h,date_range:b,status_id:p})),u([]),y(!0)},ne=e=>{E(e),s(x({page:1,perPage:g,sortField:l.columnAccessor,sortOrder:l.direction,search:m,agent_id:h,date_range:b,status_id:p}))},ce=e=>{const a=e.target.value;Y(a),s(x({page:1,perPage:g,sortField:l.columnAccessor,sortOrder:l.direction,search:a}))},oe=e=>{const a=new Set(f);e?S.forEach(o=>a.add(o.id)):S.forEach(o=>a.delete(o.id)),A(a),y(a.size===0),w(e)},de=[{accessor:"id",title:c("div",{className:"flex items-center",children:[t("input",{type:"checkbox",className:"form-checkbox mr-2",checked:H||S.length>0&&S.every(e=>f.has(e.id)),onChange:e=>oe(e.target.checked),disabled:!p}),"Select",f.size>0&&c("span",{className:"ml-2 text-xs",children:["(",f.size," selected)"]})]}),sortable:!1,render:e=>t("input",{type:"checkbox",className:"form-checkbox",checked:f.has(e.id),onChange:a=>Z(e,a.target.checked),disabled:!p})},{accessor:"title",title:"Title",sortable:!0},{accessor:"name",title:"Name",sortable:!0},{accessor:"phone",title:"Phone",sortable:!0},{accessor:"source",title:"Source",sortable:!0,render:e=>{switch(e.source){case"Facebook":return t("span",{className:"badge bg-info",children:"Facebook"});case"Instagram":return t("span",{className:"badge bg-secondary",children:"Instagram"});case"created own":return t("span",{className:"badge bg-success",children:"Created own"});case"Website":return t("span",{className:"badge bg-warning",children:"Website"});case"Reshuffle":return t("span",{className:"badge bg-primary",children:"Reshuffle"});case"Walk-in":return t("span",{className:"badge bg-danger",children:"Walk-in"});case"Other":return t("span",{className:"badge bg-secondary",children:"Other"});default:return t("span",{className:"badge bg-secondary",children:"Unknown"})}}},{accessor:"date",title:"Date",sortable:!0},{accessor:"actions",title:"Actions",render:e=>{const a=v.find(o=>o.lead_id===e.id);return t("button",{type:"button",className:"btn btn-secondary btn-sm",style:{height:"23px",borderRadius:"13px"},onClick:()=>{L(!0),G((a==null?void 0:a.comments)||[])},children:"View"})}}];return c("div",{children:[c("div",{className:"panel flex flex-col md:flex-row items-start md:items-center justify-between overflow-visible whitespace-nowrap p-3 text-dark relative gap-4 md:gap-0",children:[c("div",{className:"flex items-center mb-4 md:mb-0",children:[t("div",{className:"rounded-full bg-primary p-1.5 text-white ring-2 ring-primary/30 mr-3",children:t(xe,{})}),t("span",{className:"mr-3",children:"Details of Your Agents Reports."})]}),c("div",{className:"flex flex-col md:flex-row items-stretch md:items-center gap-2 w-full md:w-auto",children:[t("div",{className:"w-full md:w-[200px]",children:t(z,{placeholder:"Select an option",options:J,classNamePrefix:"custom-select",className:"custom-multiselect z-10",onChange:e=>{(e==null?void 0:e.value)!==void 0&&ee(e.value)}})}),t("div",{className:"w-full md:w-[200px]",children:t(z,{placeholder:"Select a Status",options:Object.entries(q||{}).map(([e,a])=>({value:e,label:a})),formatOptionLabel:e=>{const a=e.label.match(/^(.*?)\s*\((\d+)\)$/),o=a?a[1]:e.label,_=a?a[2]:null;return c("div",{className:"flex items-center gap-1",children:[" ",o," ",_&&t("span",{className:"badge bg-success ms-1",children:_})," "]})},classNamePrefix:"custom-select",className:"custom-multiselect z-10",onChange:e=>{(e==null?void 0:e.value)!==void 0&&te(e)}})}),t("div",{className:"w-full md:w-[200px]",children:t(Ne,{options:{mode:"range",dateFormat:"Y-m-d"},className:"form-input",placeholder:"Y-m-d",onChange:e=>{if(e.length===2){const a=I(e[0]),o=I(e[1]);D(`${a},${o}`)}else D("")}})}),c("div",{className:"flex gap-2 mt-2 md:mt-0",children:[c("button",{onClick:()=>{ae()},type:"button",className:"btn btn-secondary btn-sm flex items-center",children:[t(R,{}),"  Search"]}),c("button",{onClick:()=>P(!0),type:"button",className:"btn btn-secondary btn-sm flex items-center",children:[t(R,{}),"  Take-Back"]})]})]})]}),t("div",{className:"datatables mt-6",children:t(be,{title:"All Leads",columns:de,rows:S,totalRecords:K||0,currentPage:k,recordsPerPage:g,onPageChange:re,onRecordsPerPageChange:le,onSortChange:ne,sortStatus:l,isLoading:V,onSearchChange:ce,searchValue:m,noRecordsText:"No records found matching your search criteria"})}),t(ye,{isOpen:N,onClose:()=>U(!1)}),t(_e,{isOpen:Q,onClose:()=>L(!1),comments:X}),W&&t("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:c("div",{className:"bg-white p-6 rounded-lg max-w-md",children:[t("h3",{className:"text-lg font-bold mb-4",children:"Confirm Take Back"}),c("p",{children:["Are you sure you want to take back ",f.size," selected leads?"]}),c("div",{className:"flex justify-end mt-4 space-x-2",children:[t("button",{onClick:()=>P(!1),className:"btn btn-outline-secondary",children:" Cancel"}),t("button",{onClick:se,className:"btn btn-primary",children:"Confirm"})]})]})})]})};export{Ve as default};
