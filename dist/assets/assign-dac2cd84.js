import{u as U,c as E,T as j,r as t,b as M,s as W,a as d,j as a,Y,Z as z,S as H,_ as V}from"./index-fe5baaac.js";import{T as Z}from"./Table-e1ed3aa9.js";import{I as $}from"./IconBell-d99e5090.js";import{I as q}from"./IconPlus-eedb2f6d.js";import{I as G}from"./IconTrash-43205dbe.js";import{L as J}from"./loader-88e97bac.js";import{S as K}from"./react-select.esm-7abf61d7.js";import{L as O}from"./LeadModal-a00a8d17.js";/* empty css                  */import"./floating-ui.dom.browser.min-b8726d47.js";import"./extends-4c19d496.js";import"./objectWithoutPropertiesLoose-f3b3ace0.js";import"./transition-f432e32a.js";const Se=()=>{const h=U();E();const c=j(),p=t.useRef({fetched:!1,form:null,prevPage:1,prevPerPage:10,prevSortStatus:{columnAccessor:"id",direction:"desc"}}),[l,u]=t.useState([]),[N,m]=t.useState(!0),[k,v]=t.useState(!1),[f,_]=t.useState(""),[P,x]=t.useState(""),[b,i]=t.useState(1),[S,L]=t.useState(10),[g,T]=t.useState({columnAccessor:"id",direction:"desc"}),{leads:y,loading:C,agents:w,total:A,last_page:Q}=M(e=>e.leadslices);t.useEffect(()=>{h(W("New Leads"));const e=()=>{h(Y({page:b,perPage:S,sortField:g.columnAccessor,sortOrder:g.direction,search:P}))};if(!p.current.fetched){p.current.fetched=!0,e();return}e(),p.current.prevPage=b,p.current.prevPerPage=S,p.current.prevSortStatus=g},[h,b,S,g,P]),t.useEffect(()=>{(f.length>=3||f.length===0)&&(x(f),i(1))},[f]);const D=w==null?void 0:w.map(e=>({value:e==null?void 0:e.client_user_id,label:e==null?void 0:e.client_user_name,phone:e==null?void 0:e.client_user_phone})),I=(Array.isArray(y)?y:[]).map(e=>({id:e.lead_id||"Unknown",title:e.lead_title||"Unknown",name:e.customer_name||"Unknown",phone:e.customer_phone||"Unknown",source:e.lead_source||"Unknown",date:e.created_at?new Date(e.created_at).toLocaleString():"Unknown"})),R=()=>{v(!0)},B=(e,r)=>{r?(u(o=>[...o,e]),m(!1)):(u(o=>o.filter(n=>n.id!==e.id)),l.length===1&&m(!0))},F=async(e,r)=>{if(l.length===0){c.error("Please select at least one lead to assign");return}const o=l.map(s=>s.id),n=new FormData;o.forEach(s=>n.append("lead_id[]",s)),n.append("agent_id",e.toString()),n.append("agent_phone",r.toString());try{const s=await h(z({formData:n}));(s.payload.status===200||s.payload.status===201)&&(c.success("Leads Have Been Assigned Successfully"),i(1),u([]),m(!0))}catch{c.error("Failed to assign leads")}};return d("div",{children:[d("div",{className:"panel flex items-center justify-between overflow-visible whitespace-nowrap p-3 text-dark relative",children:[d("div",{className:"flex items-center",children:[d("div",{className:"rounded-full bg-primary p-1.5 text-white ring-2 ring-primary/30 ltr:mr-3 rtl:ml-3",children:[" ",a($,{})," "]}),a("span",{className:"ltr:mr-3 rtl:ml-3",children:"Details of Your New Leads: "}),d("button",{onClick:R,className:"btn btn-success btn-sm",children:[" ",a(q,{})," Add Lead "]})]}),d("div",{className:"flex items-center space-x-2",children:[a(K,{placeholder:"Select an option",options:D,isDisabled:N,className:"cursor-pointer custom-multiselect z-10 w-[300px]",onChange:e=>{(e==null?void 0:e.value)!==void 0&&F(e.value,e.phone)}}),d("button",{onClick:async()=>{if(l.length===0){c.error("Please select at least one lead to remove");return}if((await H.fire({title:"Are you sure?",text:`You are about to remove ${l.length} selected lead(s). This action cannot be undone.`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel"})).isConfirmed)try{const r=l.map(s=>s.id),o=new FormData;r.forEach(s=>o.append("lead_id[]",s));const n=await h(V({formData:o}));n.payload.status===200||n.payload.status===201?(c.success("Lead removed successfully"),u([]),i(1),m(!0)):c.error("Failed to remove leads. Please try again.")}catch{c.error("An error occurred while removing leads.")}},type:"button",className:"btn btn-default btn-sm",style:{background:"#d33",color:"#fff"},children:[" ",a(G,{})," "]})]})]}),a("div",{className:"datatables mt-6",children:C?a(J,{}):a(Z,{title:"New Leads",columns:[{accessor:"id",title:"Select",sortable:!1,render:e=>a("input",{type:"checkbox",className:"form-checkbox",checked:l.some(r=>r.id===e.id),onChange:r=>B(e,r.target.checked)})},{accessor:"title",title:"Title",sortable:!0},{accessor:"name",title:"Name",sortable:!0},{accessor:"phone",title:"Phone",sortable:!0},{accessor:"source",title:"Source",sortable:!0,render:e=>{switch(e.source){case"Facebook":return a("span",{className:"badge bg-info",children:"Facebook"});case"Instagram":return a("span",{className:"badge bg-secondary",children:"Instagram"});case"created own":return a("span",{className:"badge bg-success",children:"Created own"});case"Website":return a("span",{className:"badge bg-warning",children:"Website"});case"Reshuffle":return a("span",{className:"badge bg-primary",children:"Reshuffle"});case"Walk-in":return a("span",{className:"badge bg-danger",children:"Walk-in"});case"Other":return a("span",{className:"badge bg-secondary",children:"Other"});default:return a("span",{className:"badge bg-secondary",children:"Unknown"})}}},{accessor:"date",title:"Date",sortable:!0}],rows:I,totalRecords:A||0,currentPage:b,recordsPerPage:S,onPageChange:e=>{i(e),u([]),m(!0)},onRecordsPerPageChange:e=>{L(e),i(1),u([]),m(!0)},onSortChange:e=>{T(e),i(1)},sortStatus:g,isLoading:C,onSearchChange:e=>{_(e.target.value),i(1)},searchValue:f,noRecordsText:"No records found matching your search criteria"})}),a(O,{isOpen:k,onClose:()=>v(!1)})]})};export{Se as default};
