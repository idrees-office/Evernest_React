import{r,b as t,j as s,X as F,u as le,a as de,T as ie,s as ce,Y as w,S as p,F as pe}from"./index-f71476f7.js";import{l as B,a as ue}from"./status-483caa94.js";import{S as H}from"./react-select.esm-f0223add.js";import{I as me}from"./IconTrashLines-de68c122.js";import{I as fe}from"./IconPencil-61864d41.js";import{T as he}from"./Table-c4ae9a6d.js";/* empty css                  */import{F as E}from"./index-752a04ed.js";/* empty css                  */import{I as ve}from"./IconEye-4d3ce8fe.js";import{Y as q,y as z}from"./transition-ee85545a.js";import"./IconSquareCheck-8a60de1e.js";import"./IconStar-1d1757e4.js";import"./IconTrash-d378d806.js";import"./objectWithoutPropertiesLoose-f3b3ace0.js";import"./extends-4c19d496.js";import"./floating-ui.dom.browser.min-b8726d47.js";import"./index-c18cdd2b.js";const ge=({leave:l,isOpen:g,onClose:A,onSubmit:c})=>{r.useState(0);const _=r.useRef(null),[m,u]=r.useState(null),[f,b]=r.useState(null),[y,C]=r.useState(null),[h,P]=r.useState(""),[d,D]=r.useState({});r.useEffect(()=>{g&&(b(l.start_date?new Date(l.start_date):null),u(l.end_date?new Date(l.end_date):null),C(null))},[g,l]);const Y=o=>{const i=(o==null?void 0:o.value)||null;C(i),b(l.start_date?new Date(l.start_date):null),u(l.end_date?new Date(l.end_date):null),i==="reject"&&(b(null),u(null))},x=o=>{o&&o.preventDefault();const i={};if(y==="approve"&&(f||(i.approved_start_date="Approved start date is required"),m||(i.approved_end_date="Approved end date is required")),Object.keys(i).length>0){D(i);return}D({}),c({action:y,approved_start_date:S(f),approved_end_date:S(m),response:h.trim()})},T=[{value:"approve",label:"Approve"},{value:"reject",label:"Reject"}],S=o=>{if(!o)return"";const i=o.getFullYear(),$=String(o.getMonth()+1).padStart(2,"0"),j=String(o.getDate()).padStart(2,"0");return`${i}-${$}-${j}`};return t(q,{appear:!0,show:g,as:r.Fragment,children:s(z,{as:"div",open:g,onClose:A,className:"relative z-50",children:[t(q.Child,{as:r.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:t("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm"})}),t("form",{encType:"multipart/form-data",ref:_,onSubmit:x,children:t("div",{className:"fixed inset-0 overflow-y-auto",children:t("div",{className:"flex min-h-full items-center justify-center p-4 text-center",children:t(q.Child,{as:r.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:s(z.Panel,{className:"w-full max-w-md transform overflow-hidden rounded-xl bg-white p-6 text-left align-middle shadow-xl transition-all",children:[t(z.Title,{as:"h3",className:"text-lg font-semibold leading-6 text-gray-900",children:"Process Leave Request"}),s("small",{children:[" ",l==null?void 0:l.reason," "]}),s("div",{className:"mt-6 space-y-5",children:[s("div",{children:[t("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Action"}),t(H,{options:T,name:"action",value:T.find(o=>o.value==y),onChange:Y,placeholder:"Select action...",className:"react-select-container",classNamePrefix:"react-select",isSearchable:!1}),d.action&&t("span",{className:"text-red-500 text-sm",children:d.action})]}),y==="approve"&&s("div",{className:"space-y-4",children:[s("div",{children:[t("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Approved Start Date"}),t(E,{options:{dateFormat:"Y-m-d"},value:f,name:"approved_start_date",className:"form-input w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",placeholder:"Select start date",onChange:o=>{b(o[0])}}),d.approved_start_date&&s("span",{className:"text-red-500 text-sm",children:[" ",d.approved_start_date," "]})]}),s("div",{children:[t("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Approved End Date"}),t(E,{options:{dateFormat:"Y-m-d"},value:m,name:"approved_end_date",onChange:o=>{u(o[0])},className:"form-input w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",placeholder:"Select end date"}),d.approved_end_date&&t("span",{className:"text-red-500 text-sm",children:d.approved_end_date})]})]}),s("div",{children:[t("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Give Your Response"}),t("textarea",{name:"response",id:"response",className:"form-input",value:h,onChange:o=>P(o.target.value)}),d.response&&t("span",{className:"text-red-500 text-sm",children:d.response})]})]}),s("div",{className:"mt-8 flex justify-end space-x-3",children:[t("button",{type:"button",className:"inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",onClick:A,children:"   Cancel"}),t("button",{type:"button",className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",onClick:x,children:" Submit"})]})]})})})})})]})})},L={createApi:`${F()}/users/leave_request`,listApi:`${F()}/users/leaves_list`,deleteApi:`${F()}/users/delete_leave`,aprovalLeaveApi:`${F()}/users/aprove_leave`},je=()=>{le();const l=r.useRef({userformRef:null}),[g,A]=r.useState([]),[c,_]=r.useState({}),[m,u]=r.useState(1),[f,b]=r.useState(10),[y,C]=r.useState(0),[h,P]=r.useState({columnAccessor:"id",direction:"asc"}),[d,D]=r.useState(""),[Y,x]=r.useState(null),[T,S]=r.useState(null),[o,i]=r.useState(null),[$,j]=r.useState(0),[X,J]=r.useState(0),M=de(e=>e.auth.user||{}),[K,I]=r.useState(!1),[Q,V]=r.useState(null),U=ie();r.useEffect(()=>{ce("Create Leave"),k()},[m,f,h,d]);const k=async()=>{var e;try{const n={page:m,per_page:f,sort_field:h.columnAccessor,sort_order:h.direction,search:d},a=await w.get(L.listApi,{params:n});if(a.data){A(a.data.data.leaves||[]),C(a.data.data.leaves.length||0),j(a.data.data.allowed_leave||0);const N=a.data.data.leaves.filter(R=>R.status===2&&R.client_user_id===M.client_user_id).reduce((R,oe)=>R+(oe.days||0),0);J(a.data.data.allowed_leave-N)}}catch(n){((e=n.response)==null?void 0:e.status)===403&&(window.location.href="/error"),Z()}},W=async e=>{var n;e.preventDefault();try{if(l.current.userformRef){const a=new FormData(l.current.userformRef),v=a.get("id"),N=v?await w.post(`${L.createApi}/${v}`,a):await w.post(L.createApi,a);(N.status===200||N.status===201)&&(G(N.data.message),k(),_({}),l.current.userformRef.reset())}}catch(a){(n=a.response)!=null&&n.data&&_(a.response.data),a.status===422&&p.fire({icon:"warning",title:"Incomplete Leave Request",text:""+a.response.data.message})}},G=e=>{p.fire({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,title:e,icon:"success"})},Z=()=>{p.fire({text:"Something went wrong on the server",icon:"error",title:"Server Error"})},O=async e=>{if(e.status=2){U.info("Cannot update leave — its already approved. Thank you.");return}if(l.current.userformRef){const n=l.current.userformRef;n.reset(),n.id.value=e.id||"",x(new Date(e.start_date)),S(new Date(e.end_date)),i(e.leave_type),n.reason.value=e.reason||""}},ee=async e=>{if(e.status=2){U.info("Cannot Delete leave — its already approved. Thank you.");return}if((await p.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",cancelButtonText:"No, cancel!"})).isConfirmed)try{const a=await w.delete(L.deleteApi+`/${e.id}`);(a.status===200||a.status===201)&&(G("Leave deleted successfully"),k())}catch(a){a.status==403||a.status==404?p.fire(a.response.data.message||"Validation failed."):p.fire("Error","Something went wrong.","error")}},te=e=>{D(e.target.value),u(1)},ae=e=>{u(e)},se=e=>{b(e),u(1)},re=async e=>{V(e),I(!0)},ne=async e=>{var n;try{const a=new FormData;a.append("id",Q.id),a.append("approved_by",M.client_user_id),a.append("action",e.action),e.action==="approve"&&(a.append("approved_start_date",e.approved_start_date),a.append("approved_end_date",e.approved_end_date)),a.append("response",e.response);const v=await w.post(L.aprovalLeaveApi,a);(v.status===200||v.status===201)&&(k(),_({}),p.fire("Success!",v.data.message,"success"))}catch(a){((n=a.response)==null?void 0:n.status)===422?(p.fire("Error",a.response.data.message||"Validation failed.","error"),I(!1)):p.fire("Error","Something went wrong.","error")}};return s("form",{ref:e=>l.current.userformRef=e,onSubmit:W,className:"space-y-5",children:[s("div",{className:"flex flex-wrap -mx-4",children:[t("div",{className:"w-full lg:w-2/3 px-2 mt-6 lg:mt-0 md-mt-0",children:t("div",{className:"datatables",children:t(he,{columns:[{accessor:"id",title:"#",width:80,key:"id"},{accessor:"leave_type",title:"Leave Type",sortable:!0,render:e=>{const n=B.find(a=>a.value===e.leave_type);return n?s("span",{className:"bg-secondary badge",children:[" ",n.label," "]}):"-"},key:"leave_type"},{accessor:"client_user_name",title:"Agent Name",sortable:!0,render:e=>{var n;return((n=e.user)==null?void 0:n.client_user_name)||"-"},key:"client_user_name"},{accessor:"start_date",title:"Start Date",sortable:!0,render:e=>e.status===1?t("div",{children:e.start_date}):e.status===2&&e.approved_start_date?t("div",{children:e.approved_start_date}):t("div",{children:e.start_date}),key:"start_date"},{accessor:"end_date",title:"End Date",sortable:!0,render:e=>e.status===1?t("div",{children:e.end_date}):e.status===2&&e.approved_end_date?t("div",{children:e.approved_end_date}):t("div",{children:e.end_date}),key:"end_date"},{accessor:"days",title:"Total Days",sortable:!0,render:e=>e.days?s("span",{className:"bg-success badge",children:[" ",e.days," "]}):"-",key:"days"},{accessor:"status",title:"Leave Status",sortable:!0,render:e=>{const n=ue.find(a=>a.value==e.status);return n?s("span",{className:"bg-dark badge",children:[" ",n.label," "]}):"-"},key:"status"},{accessor:"actions",title:"Actions",width:120,key:"actions-column",render:e=>s("div",{className:"flex space-x-2",children:[s(pe,{children:[t("button",{type:"button",onClick:()=>re(e),className:"btn px-1 py-0.5 rounded text-white bg-green-600",children:t(ve,{})},`view-${e.id}`),t("button",{type:"button",onClick:()=>ee(e),className:"btn px-1 py-0.5 rounded text-white bg-red-600",children:t(me,{})},`delete-${e.id}`)]}),t("button",{type:"button",onClick:()=>O(e),className:"btn px-1 py-0.5 rounded text-white bg-info",children:t(fe,{})},`edit-${e.id}`)]})}],rows:g,title:"List of all Leaves",idAccessor:"id",totalRecords:y,currentPage:m,recordsPerPage:f,onPageChange:ae,onRecordsPerPageChange:se,onSortChange:P,onSearchChange:te,sortStatus:h,isLoading:!1,minHeight:200,noRecordsText:"No Leaves found",searchValue:d})})}),t("div",{className:"w-full lg:w-1/3 px-3",children:t("div",{className:"panel",children:s("div",{className:"panel-body",children:[s("div",{className:"flex justify-end",children:[s("span",{className:"badge bg-info text-white mr-2",children:[" Total Allow Leave ",$," "]}),s("span",{className:"badge bg-dark text-white",children:["Remaining Leave ",X||0," "]})]}),s("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[s("div",{className:"form-group sm:col-span-2",children:[t("label",{htmlFor:"title",children:"Leave Start Date"}),t(E,{name:"start_date",value:Y,options:{dateFormat:"Y-m-d"},className:"form-input",placeholder:"Y-m-d",onChange:e=>{x(e[0])}}),t("input",{type:"hidden",name:"id",id:"id"}),c.start_date&&t("span",{className:"text-red-500 text-sm",children:c.start_date})]}),s("div",{className:"form-group sm:col-span-2",children:[t("label",{htmlFor:"title",children:"Leave End Date"}),t(E,{name:"end_date",value:T,options:{dateFormat:"Y-m-d"},className:"form-input",placeholder:"Y-m-d",onChange:e=>{S(e[0])}}),c.end_date&&t("span",{className:"text-red-500 text-sm",children:c.end_date})]}),s("div",{className:"form-group sm:col-span-2",children:[t("label",{htmlFor:"leave_type",children:"Leave Type"}),t(H,{name:"leave_type",placeholder:"Employee Type",options:B,value:B.find(e=>e.value===o),onChange:e=>i((e==null?void 0:e.value)||null)}),c.leave_type&&s("span",{className:"text-red-500 text-sm",children:[" ",c.leave_type," "]})]}),s("div",{className:"form-group sm:col-span-2",children:[t("label",{htmlFor:"reason",children:"Leave Reason"}),t("textarea",{name:"reason",id:"reason",className:"form-input",style:{height:"316px"}}),c.reason&&s("span",{className:"text-red-500 text-sm",children:[" ",c.reason," "]})]}),t("div",{className:"sm:col-span-2 flex justify-end",children:t("button",{type:"submit",className:"btn btn-success w-full",children:" Submit "})})]})]})})})]}),t(ge,{leave:Q,isOpen:K,onClose:()=>I(!1),onSubmit:ne})]})};export{je as default};
