import{j as t,r as l,a as c,A as ne,u as le,c as oe,T as ce,b as de,s as ie,Q as D,a3 as h,K as L,aa as ue}from"./index-464d9cbd.js";import{T as me}from"./Table-8468f8bc.js";import{I as pe}from"./IconBell-d1c74b6c.js";import{S as R}from"./react-select.esm-265c4686.js";import{L as fe}from"./LeadModal-7e89c3a4.js";/* empty css                  */import{c as M,u as he}from"./status-cda4dca5.js";import"./jspdf.plugin.autotable-a3648079.js";import{F as ge}from"./index-bfaaf69b.js";/* empty css                  */import{Y as S,y as I}from"./transition-99bd2e8c.js";import"./index-ee09ae0e.js";import"./floating-ui.dom.browser.min-b8726d47.js";import"./extends-4c19d496.js";import"./objectWithoutPropertiesLoose-f3b3ace0.js";import"./IconSquareCheck-8e247ebb.js";import"./IconStar-d67c4b4a.js";import"./IconTrash-e58ba19b.js";const be=r=>{const a=M.find(d=>d.value==r);return a&&typeof a.notes=="string"?a.notes:"Status Changed"},xe=r=>{const a=M.find(d=>d.value==r);return a&&typeof a.notes2=="string"?a.notes2:"Status Changed"},ye=r=>{if(!r)return"Invalid Time";const a=new Date(r);return a.toLocaleDateString()+" "+a.toLocaleTimeString()},Ne=({isOpen:r,onClose:a,comments:d=[]})=>t(S,{appear:!0,show:r,as:l.Fragment,children:c(I,{as:"div",open:r,onClose:a,className:"relative z-[51]",children:[t(S.Child,{as:l.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:t("div",{className:"fixed inset-0 bg-[black]/60"})}),t("div",{className:"fixed inset-0 overflow-y-auto",children:t("div",{className:"flex min-h-full items-center justify-center px-4 py-8",children:t(S.Child,{as:l.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:c(I.Panel,{className:"panel border-0 p-0 rounded-lg overflow-hidden w-full max-w-6xl h-[90vh] text-black dark:text-white-dark",children:[t("button",{type:"button",onClick:a,className:"absolute top-4 ltr:right-4 rtl:left-4 text-gray-400 hover:text-gray-800 dark:hover:text-gray-600 outline-none",children:t(ne,{className:"w-6 h-6"})}),t("div",{className:"text-xl font-semibold bg-[#fbfbfb] dark:bg-[#121c2c] ltr:pl-6 rtl:pr-6 py-4 ltr:pr-[60px] rtl:pl-[60px]",children:"History of the Leads"}),c("div",{className:"p-6 h-full flex flex-col",children:[t("div",{className:"flex-1 overflow-y-auto",children:t("div",{className:"table-responsive text-[#515365] dark:text-white-light font-semibold",children:t("div",{className:"max-w-[1200px] mx-auto",children:d==null?void 0:d.map((o,i)=>{var v,x,N;return c("div",{className:"flex",children:[t("p",{className:"text-[#3b3f5c] dark:text-white-light min-w-[150px] max-w-[180px] text-base font-semibold py-3",children:ye(o.created_at)}),t("div",{className:`
                                                            relative
                                                            before:absolute before:left-1/2 before:-translate-x-1/2 before:top-[18px] 
                                                            before:w-3 before:h-3 before:border-[3px] before:rounded-full
                                                            after:absolute after:left-1/2 after:-translate-x-1/2 after:top-[30px] 
                                                            after:-bottom-[15px] after:w-0 after:h-auto after:border-l-[3px] 
                                                            after:rounded-full
                                                            ${i%5===0?"before:border-primary after:border-primary":i%5===1?"before:border-dark after:border-dark":i%5===2?"before:border-success after:border-success":i%5===3?"before:border-danger after:border-danger":"before:border-warning after:border-warning"}
                                                        `}),c("div",{className:"p-3 self-center ltr:ml-3 rtl:mr-3 w-full",children:[c("div",{className:"flex items-center gap-3 mb-2",children:[t("span",{className:"text-[#3b3f5c] dark:text-white-light font-semibold text-[15px]",children:(o==null?void 0:o.user_name)||(i>0?(v=d[i-1])==null?void 0:v.user_name:"System")}),t("span",{className:"text-gray-500 dark:text-gray-400 text-[15px]",dangerouslySetInnerHTML:{__html:be(o.lead_status)}}),o.lead_status===2&&t("span",{className:"text-blue-500 dark:text-blue-400 text-[15px]",children:((x=o==null?void 0:o.agent)==null?void 0:x.client_user_name)||(o==null?void 0:o.agent_name)}),i>0&&t("div",{className:"text-gray-500 dark:text-gray-400 text-[15px]",dangerouslySetInnerHTML:{__html:xe((N=d[i-1])==null?void 0:N.lead_status)}})]}),o.lead_comment&&t("div",{className:"bg-gray-50 dark:bg-gray-800 p-2 border-l-4 border-gray-200 dark:border-gray-600 rounded-r",children:t("p",{className:"text-[#3b3f5c] dark:text-white-light text-base italic",children:o.lead_comment})})]})]},o.lead_comment_id)})})})}),t("div",{className:"ltr:text-right rtl:text-left flex justify-end items-center mt-6 pt-4 border-t border-gray-200 dark:border-gray-600",children:t("button",{type:"button",className:"btn btn-outline-danger px-6 py-2 text-base",onClick:a,children:"Close"})})]})]})})})})]})}),Ye=()=>{const r=le();oe();const a=ce();he();const d=l.useRef({fetched:!1,form:null,prevPage:1,prevPerPage:10,prevSortStatus:{columnAccessor:"lead_id",direction:"desc"}}),[o,i]=l.useState([]),[v,x]=l.useState(!0),[N,j]=l.useState(!1),[m,O]=l.useState(null),[g,U]=l.useState(null),[u,B]=l.useState(""),[s,Y]=l.useState({columnAccessor:"lead_id",direction:"desc"}),[$,_]=l.useState(!1),{leads:y,loading:z,agents:k,statuses:W,total_leads:C,total:E,last_page:ve,current_page:w,per_page:p}=de(e=>e.leadslices),[f,P]=l.useState(""),[H,A]=l.useState(!1),[V,q]=l.useState(null);l.useEffect(()=>{r(ie("Agents Reports"));const e=()=>{r(h({page:u?1:w,perPage:p,sortField:s.columnAccessor,sortOrder:s.direction,search:u,agent_id:m,date_range:f,status_id:g}))};if(!d.current.fetched){e(),d.current.fetched=!0;return}},[r,w,p,s,u]);const K=k==null?void 0:k.map(e=>({value:e==null?void 0:e.client_user_id,label:e==null?void 0:e.client_user_name,phone:e==null?void 0:e.client_user_phone})),Q=async e=>{O(e),await r(h({page:1,perPage:p,sortField:s.columnAccessor,sortOrder:s.direction,search:u,date_range:f,agent_id:e,status_id:g}))},F=e=>{U(e.value)},X=async()=>{if(!m){a.error("Please select an agent before Search.");return}await r(h({page:1,perPage:p,sortField:s.columnAccessor,sortOrder:s.direction,search:u,date_range:f,agent_id:m,status_id:g}))},G=async()=>{if(!m){a.error("Please select an agent before taking back leads.");return}if(C===0){a.error("No leads found to take back.");return}try{if(L(!0),y.map(b=>b.lead_id).length===0){a.error("No leads available to take back.");return}const n=await r(ue({agent_id:m,status_id:g,date_range:f})).unwrap();n.status==="success"?(a.success(n.message||"Leads successfully taken back!"),_(!1),console.log(n),i([]),x(!0)):a.error(n.message||"Failed to take back leads."),r(h({page:1,perPage:p,sortField:s.columnAccessor,sortOrder:s.direction,search:u,date_range:f,agent_id:m,status_id:F}))}catch{a.error("Failed to take back leads.")}finally{L(!0)}},T=e=>{const n=e.getFullYear(),b=String(e.getMonth()+1).padStart(2,"0"),se=String(e.getDate()).padStart(2,"0");return`${n}-${b}-${se}`},J=l.useMemo(()=>(Array.isArray(y)?y:[]).map(e=>({id:e.lead_id||"Unknown",title:e.lead_title||"Unknown",name:e.customer_name||"Unknown",phone:e.customer_phone||"Unknown",source:e.lead_source||"Unknown",date:e.assigned_at?new Date(e.assigned_at).toLocaleString():"Unknown"})),[y]),Z=e=>{r(h({page:e,sortField:s.columnAccessor,sortOrder:s.direction,search:u,agent_id:m,date_range:f,status_id:g})),i([]),x(!0)},ee=e=>{r(h({perPage:e,sortField:s.columnAccessor,sortOrder:s.direction,search:u,agent_id:m,date_range:f,status_id:g})),i([]),x(!0)},te=e=>{Y(e),r(h({page:1,perPage:p,sortField:s.columnAccessor,sortOrder:s.direction,search:u,agent_id:m,date_range:f,status_id:g}))},ae=e=>{const n=e.target.value;B(n),r(h({page:1,perPage:p,sortField:s.columnAccessor,sortOrder:s.direction,search:n}))},re=[{accessor:"title",title:"Title",sortable:!0},{accessor:"name",title:"Name",sortable:!0},{accessor:"phone",title:"Phone",sortable:!0},{accessor:"source",title:"Source",sortable:!0,render:e=>{switch(e.source){case"Facebook":return t("span",{className:"badge bg-info",children:"Facebook"});case"Instagram":return t("span",{className:"badge bg-secondary",children:"Instagram"});case"created own":return t("span",{className:"badge bg-success",children:"Created own"});case"Website":return t("span",{className:"badge bg-warning",children:"Website"});case"Reshuffle":return t("span",{className:"badge bg-primary",children:"Reshuffle"});case"Walk-in":return t("span",{className:"badge bg-danger",children:"Walk-in"});case"Other":return t("span",{className:"badge bg-secondary",children:"Other"});default:return t("span",{className:"badge bg-secondary",children:"Unknown"})}}},{accessor:"date",title:"Date",sortable:!0},{accessor:"actions",title:"Actions",render:e=>{const n=y.find(b=>b.lead_id===e.id);return t("button",{type:"button",className:"btn btn-secondary btn-sm",style:{height:"23px",borderRadius:"13px"},onClick:()=>{A(!0),q((n==null?void 0:n.comments)||[])},children:"View"})}}];return c("div",{children:[c("div",{className:"panel flex flex-col md:flex-row items-start md:items-center justify-between overflow-visible whitespace-nowrap p-3 text-dark relative gap-4 md:gap-0",children:[c("div",{className:"flex items-center mb-4 md:mb-0",children:[t("div",{className:"rounded-full bg-primary p-1.5 text-white ring-2 ring-primary/30 mr-3",children:t(pe,{})}),t("span",{className:"mr-3",children:"Details of Your Agents Reports."})]}),c("div",{className:"flex flex-col md:flex-row items-stretch md:items-center gap-2 w-full md:w-auto",children:[t("div",{className:"w-full md:w-[200px]",children:t(R,{placeholder:"Select an option",options:K,classNamePrefix:"custom-select",className:"custom-multiselect z-10",onChange:e=>{(e==null?void 0:e.value)!==void 0&&Q(e.value)}})}),t("div",{className:"w-full md:w-[200px]",children:t(R,{placeholder:"Select a Status",options:Object.entries(W||{}).map(([e,n])=>({value:e,label:n})),classNamePrefix:"custom-select",className:"custom-multiselect z-10",onChange:e=>{(e==null?void 0:e.value)!==void 0&&F(e)}})}),t("div",{className:"w-full md:w-[200px]",children:t(ge,{options:{mode:"range",dateFormat:"Y-m-d"},className:"form-input",placeholder:"Y-m-d",onChange:e=>{if(e.length===2){const n=T(e[0]),b=T(e[1]);P(`${n},${b}`)}else P("")}})}),c("div",{className:"flex gap-2 mt-2 md:mt-0",children:[c("button",{onClick:()=>{X()},type:"button",className:"btn btn-secondary btn-sm flex items-center",children:[t(D,{}),"  Search"]}),c("button",{onClick:()=>_(!0),type:"button",className:"btn btn-secondary btn-sm flex items-center",children:[t(D,{}),"  Take-Back"]})]})]})]}),t("div",{className:"datatables mt-6",children:t(me,{title:"All Leads",columns:re,rows:J,totalRecords:E||0,currentPage:w,recordsPerPage:p,onPageChange:Z,onRecordsPerPageChange:ee,onSortChange:te,sortStatus:s,isLoading:z,onSearchChange:ae,searchValue:u,noRecordsText:"No records found matching your search criteria"})}),t(fe,{isOpen:N,onClose:()=>j(!1)}),t(Ne,{isOpen:H,onClose:()=>A(!1),comments:V}),$&&t("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:c("div",{className:"bg-white p-6 rounded-lg max-w-md",children:[t("h3",{className:"text-lg font-bold mb-4",children:"Confirm Take Back"}),c("p",{children:["Are you sure you want to take back ",C," selected leads?"]}),c("div",{className:"flex justify-end mt-4 space-x-2",children:[t("button",{onClick:()=>_(!1),className:"btn btn-outline-secondary",children:" Cancel"}),t("button",{onClick:G,className:"btn btn-primary",children:"Confirm"})]})]})})]})};export{Ye as default};
