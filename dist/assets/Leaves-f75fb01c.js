import{X as g,u as re,r as n,a as ne,T as oe,s as le,Y as p,S as o,j as r,b as a,F as ie}from"./index-0676b19a.js";import{l as N,a as de}from"./status-4b816717.js";import{S as ce}from"./react-select.esm-1f13a092.js";import{I as pe}from"./IconTrashLines-531a8764.js";import{I as ue}from"./IconPencil-9ff1e2ef.js";import{T as me}from"./Table-0c63e2a4.js";/* empty css                  */import{F as k}from"./index-070db2d1.js";/* empty css                  */import{I as ve}from"./IconEye-a9f80298.js";import{A as he}from"./ApprovalModal-5729e762.js";import"./IconSquareCheck-39723b4c.js";import"./IconStar-5cf9082e.js";import"./IconTrash-6b909176.js";import"./IconCalendar-f38eea09.js";import"./objectWithoutPropertiesLoose-f3b3ace0.js";import"./extends-4c19d496.js";import"./floating-ui.dom.browser.min-b8726d47.js";import"./index-16a97232.js";import"./transition-cea5b86d.js";const u={createApi:`${g()}/users/leave_request`,listApi:`${g()}/users/leaves_list`,deleteApi:`${g()}/users/delete_leave`,aprovalLeaveApi:`${g()}/users/aprove_leave`},Ye=()=>{re();const d=n.useRef({userformRef:null}),[E,P]=n.useState([]),[l,_]=n.useState({}),[y,b]=n.useState(1),[S,F]=n.useState(10),[$,I]=n.useState(0),[m,Y]=n.useState({columnAccessor:"id",direction:"asc"}),[x,B]=n.useState(""),[j,L]=n.useState(null),[q,A]=n.useState(null),[O,T]=n.useState(null),[z,M]=n.useState(0),[Q,U]=n.useState(0),C=ne(e=>e.auth.user||{}),[H,v]=n.useState(!1),[w,X]=n.useState(null),R=oe();n.useEffect(()=>{le("Create Leave"),h()},[y,S,m,x]);const h=async()=>{var e;try{const s={page:y,per_page:S,sort_field:m.columnAccessor,sort_order:m.direction,search:x},t=await p.get(u.listApi,{params:s});if(t.data){P(t.data.data.leaves||[]),I(t.data.data.leaves.length||0),M(t.data.data.allowed_leave||0);const c=t.data.data.leaves.filter(f=>f.status===2&&f.client_user_id===C.client_user_id).reduce((f,se)=>f+(se.days||0),0);U(t.data.data.allowed_leave-c)}}catch(s){((e=s.response)==null?void 0:e.status)===403&&(window.location.href="/error"),J()}},G=async e=>{var s;e.preventDefault();try{if(d.current.userformRef){const t=new FormData(d.current.userformRef),i=t.get("id"),c=i?await p.post(`${u.createApi}/${i}`,t):await p.post(u.createApi,t);(c.status===200||c.status===201)&&(D(c.data.message),h(),_({}),d.current.userformRef.reset())}}catch(t){(s=t.response)!=null&&s.data&&_(t.response.data),t.status===422&&o.fire({icon:"warning",title:"Incomplete Leave Request",text:""+t.response.data.message})}},D=e=>{o.fire({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,title:e,icon:"success"})},J=()=>{o.fire({text:"Something went wrong on the server",icon:"error",title:"Server Error"})},K=async e=>{if(e.status=2){R.info("Cannot update leave — its already approved. Thank you.");return}if(d.current.userformRef){const s=d.current.userformRef;s.reset(),s.id.value=e.id||"",L(new Date(e.start_date)),A(new Date(e.end_date)),T(e.leave_type),s.reason.value=e.reason||""}},W=async e=>{if(e.status=2){R.info("Cannot Delete leave — its already approved. Thank you.");return}if((await o.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",cancelButtonText:"No, cancel!"})).isConfirmed)try{const t=await p.delete(u.deleteApi+`/${e.id}`);(t.status===200||t.status===201)&&(D("Leave deleted successfully"),h())}catch(t){t.status==403||t.status==404?o.fire(t.response.data.message||"Validation failed."):o.fire("Error","Something went wrong.","error")}},Z=e=>{B(e.target.value),b(1)},V=e=>{b(e)},ee=e=>{F(e),b(1)},te=async e=>{X(e),v(!0)},ae=async e=>{var s;try{const t=new FormData;t.append("id",w.id),t.append("approved_by",C.client_user_id),t.append("action",e.action),e.action==="approve"&&(e.approved_start_date&&t.append("approved_start_date",e.approved_start_date),e.approved_end_date&&t.append("approved_end_date",e.approved_end_date)),t.append("response",e.response);const i=await p.post(u.aprovalLeaveApi,t);(i.status===200||i.status===201)&&(h(),_({}),o.fire("Success!",i.data.message,"success"),v(!1))}catch(t){((s=t.response)==null?void 0:s.status)===422?o.fire("Error",t.response.data.message||"Validation failed.","error"):o.fire("Error","Something went wrong.","error"),v(!1)}};return r("form",{ref:e=>d.current.userformRef=e,onSubmit:G,className:"space-y-5",children:[r("div",{className:"flex flex-wrap -mx-4",children:[a("div",{className:"w-full lg:w-2/3 px-2 mt-6 lg:mt-0 md-mt-0",children:a("div",{className:"datatables",children:a(me,{columns:[{accessor:"id",title:"#",width:80,key:"id"},{accessor:"leave_type",title:"Leave Type",sortable:!0,render:e=>{const s=N.find(t=>t.value===e.leave_type);return s?r("span",{className:"bg-secondary badge",children:[" ",s.label," "]}):"-"},key:"leave_type"},{accessor:"client_user_name",title:"Agent Name",sortable:!0,render:e=>{var s;return((s=e.user)==null?void 0:s.client_user_name)||"-"},key:"client_user_name"},{accessor:"start_date",title:"Start Date",sortable:!0,render:e=>e.status===1?a("div",{children:e.start_date}):e.status===2&&e.approved_start_date?a("div",{children:e.approved_start_date}):a("div",{children:e.start_date}),key:"start_date"},{accessor:"end_date",title:"End Date",sortable:!0,render:e=>e.status===1?a("div",{children:e.end_date}):e.status===2&&e.approved_end_date?a("div",{children:e.approved_end_date}):a("div",{children:e.end_date}),key:"end_date"},{accessor:"days",title:"Total Days",sortable:!0,render:e=>e.days?r("span",{className:"bg-success badge",children:[" ",e.days," "]}):"-",key:"days"},{accessor:"status",title:"Leave Status",sortable:!0,render:e=>{const s=de.find(t=>t.value==e.status);return s?r("span",{className:"bg-dark badge",children:[" ",s.label," "]}):"-"},key:"status"},{accessor:"actions",title:"Actions",width:120,key:"actions-column",render:e=>r("div",{className:"flex space-x-2",children:[r(ie,{children:[a("button",{type:"button",disabled:e.status==2,onClick:()=>te(e),className:"btn px-1 py-0.5 rounded text-white bg-green-600",children:a(ve,{})},`view-${e.id}`),a("button",{type:"button",onClick:()=>W(e),className:"btn px-1 py-0.5 rounded text-white bg-red-600",children:a(pe,{})},`delete-${e.id}`)]}),a("button",{type:"button",onClick:()=>K(e),className:"btn px-1 py-0.5 rounded text-white bg-info",children:a(ue,{})},`edit-${e.id}`)]})}],rows:E,title:"List of all Leaves",idAccessor:"id",totalRecords:$,currentPage:y,recordsPerPage:S,onPageChange:V,onRecordsPerPageChange:ee,onSortChange:Y,onSearchChange:Z,sortStatus:m,isLoading:!1,minHeight:200,noRecordsText:"No Leaves found",searchValue:x})})}),a("div",{className:"w-full lg:w-1/3 px-3",children:a("div",{className:"panel",children:r("div",{className:"panel-body",children:[r("div",{className:"flex justify-end",children:[r("span",{className:"badge bg-info text-white mr-2",children:[" Total Allow Leave ",z," "]}),r("span",{className:"badge bg-dark text-white",children:["Remaining Leave ",Q||0," "]})]}),r("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[r("div",{className:"form-group sm:col-span-2",children:[a("label",{htmlFor:"title",children:"Leave Start Date"}),a(k,{name:"start_date",value:j,options:{dateFormat:"Y-m-d"},className:"form-input",placeholder:"Y-m-d",onChange:e=>{L(e[0])}}),a("input",{type:"hidden",name:"id",id:"id"}),l.start_date&&a("span",{className:"text-red-500 text-sm",children:l.start_date})]}),r("div",{className:"form-group sm:col-span-2",children:[a("label",{htmlFor:"title",children:"Leave End Date"}),a(k,{name:"end_date",value:q,options:{dateFormat:"Y-m-d"},className:"form-input",placeholder:"Y-m-d",onChange:e=>{A(e[0])}}),l.end_date&&a("span",{className:"text-red-500 text-sm",children:l.end_date})]}),r("div",{className:"form-group sm:col-span-2",children:[a("label",{htmlFor:"leave_type",children:"Leave Type"}),a(ce,{name:"leave_type",placeholder:"Employee Type",options:N,value:N.find(e=>e.value===O),onChange:e=>T((e==null?void 0:e.value)||null)}),l.leave_type&&r("span",{className:"text-red-500 text-sm",children:[" ",l.leave_type," "]})]}),r("div",{className:"form-group sm:col-span-2",children:[a("label",{htmlFor:"reason",children:"Leave Reason"}),a("textarea",{name:"reason",id:"reason",className:"form-input",style:{height:"316px"}}),l.reason&&r("span",{className:"text-red-500 text-sm",children:[" ",l.reason," "]})]}),a("div",{className:"sm:col-span-2 flex justify-end",children:a("button",{type:"submit",className:"btn btn-success w-full",children:" Submit "})})]})]})})})]}),w&&a(he,{request:w,isOpen:H,onClose:()=>v(!1),onSubmit:ae,modalType:"leave",title:"Process Leave Request",descriptionField:"reason",requireDateRange:!0})]})};export{Ye as default};
