import{u as P,r as c,b as p,s as U,j as t,a,L as v,P as $,F as M,Y as S}from"./index-1a498c6b.js";import{_ as k,I as z}from"./IconChatDots-ee950918.js";import{a as C}from"./IconSquareCheck-77ed1e21.js";import{s as f}from"./status-9b1dbba3.js";import{C as R}from"./CustomSideNav-39b708d2.js";import"./IconStar-9b67224a.js";import"./IconTrash-8141b0fb.js";import"./react-select.esm-59bd051e.js";import"./objectWithoutPropertiesLoose-f3b3ace0.js";import"./extends-4c19d496.js";import"./floating-ui.dom.browser.min-b8726d47.js";const Z=()=>{var w;const g=P(),[L,b]=c.useState(!0),[n,_]=c.useState(null),[u,x]=c.useState(null);p(e=>e.themeConfig.theme==="dark"||e.themeConfig.isDarkMode),p(e=>e.themeConfig.rtlClass);const[j,h]=c.useState(!1),[o,D]=c.useState({agents:[],statuses:[]}),m=p(e=>e.auth.user||{}),[y,F]=c.useState({series:[],options:{}});c.useEffect(()=>{g(U("Leads Analysis"))},[g]),c.useEffect(()=>{const e=async()=>{try{b(!0);const s=new URLSearchParams;o.agents.length>0&&s.append("agents",o.agents.join(",")),o.statuses.length>0&&s.append("statuses",o.statuses.join(","));const r=await S.get(`/leads/leads-analysis?${s.toString()}`);if(r.status===200)console.log(r.data.data),_(r.data.data);else throw new Error("Failed to fetch data")}catch(s){x(s)}finally{b(!1)}};(async()=>{try{const s=new URLSearchParams;o.agents.length>0&&s.append("agents",o.agents.join(",")),o.statuses.length>0&&s.append("statuses",o.statuses.join(","));const r=await S.get(`/leads/total-leads?${s.toString()}`);if(r.status===200)F(r.data);else throw new Error("Failed to fetch agent leads chart data")}catch(s){x(s)}})(),e()},[o]);const I=e=>{if(!(n!=null&&n.daily_counts))return[];const i=n.daily_counts[e]||{},s=Object.entries(i).sort(([l],[d])=>new Date(l).getTime()-new Date(d).getTime()).map(([l,d])=>({x:l,y:d})),r=f().find(l=>l.value==e);return[{name:(r==null?void 0:r.label)||`Status ${e}`,data:s.length>0?s:[{x:new Date().toISOString().split("T")[0],y:0}]}]},O=e=>({chart:{height:160,type:"area",fontFamily:"Nunito, sans-serif",sparkline:{enabled:!0}},stroke:{curve:"smooth",width:2},colors:[e],fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.7,opacityTo:.1,stops:[0,90,100]}},grid:{padding:{top:5}},yaxis:{show:!1},tooltip:{x:{show:!0,format:"dd MMM yyyy"},y:{title:{formatter:()=>""}}}}),N=["#4361ee","#805dca","#00ab55","#e7515a","#ffbb44","#2196f3","#3b3f5c"],T=(e,i)=>{const s=f().find(l=>l.label===e),r=N[i%N.length];return{icon:(s==null?void 0:s.icon)||t(C,{className:"w-5 h-5"}),bgColor:s?`${s.bgColor}/10`:"bg-primary/10",color:r}},A=e=>{D(e),h(!1)};return L?t("div",{className:"text-center py-10",children:"Loading..."}):u?a("div",{className:"text-center py-10 text-danger",children:["Error: ",u.message]}):n?a("div",{children:[a("div",{className:"flex items-center justify-between mb-6",children:[a("ul",{className:"flex space-x-2 rtl:space-x-reverse",children:[a("li",{children:[t(v,{to:"/",className:"text-primary hover:underline",children:" Dashboard "})," "]}),t("li",{className:"before:content-['/'] ltr:before:mr-2 rtl:before:ml-2",children:t("span",{children:"Analytics"})})]}),a("div",{className:"flex space-x-2 rtl:space-x-reverse",children:[a("span",{className:"badge bg-dark text-white",children:["Overall Leads: ",n.total_leads]}),a("span",{className:"badge bg-info text-white",children:["Filtered Leads: ",Object.values(n.status_counts).reduce((e,i)=>e+i,0)," leads"]})]}),a("div",{className:"flex items-center",children:[t(v,{to:"/pages/leads/dashboard",className:"btn btn-success btn-sm",children:" Lead Dashboard "}),"    ",(m==null?void 0:m.roles[0].name)==="super admin"&&t("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:()=>h(!0),children:" Update Filter "})]})]}),a("div",{className:"pt-5",children:[t("div",{className:"grid sm:grid-cols-2 xl:grid-cols-4 gap-6 mb-6",children:Object.entries(n.percentages).map(([e,i],s)=>{const r=Number(e),l=f().find(E=>E.value==r),d=T((l==null?void 0:l.label)||"",s);return a("div",{className:"panel h-full p-0 rounded-2xl shadow-md bg-white dark:bg-gray-900",children:[a("div",{className:"flex items-center p-5",children:[t("div",{className:`flex items-center justify-center w-12 h-12 rounded-full ${d.bgColor}`,style:{color:d.color},children:(l==null?void 0:l.icon)||t(C,{className:"w-5 h-5"})}),a("div",{className:"ml-4",children:[a("p",{className:"text-2xl font-bold text-gray-800 dark:text-white",children:[i,"%"]}),t("span",{className:"text-sm text-gray-500 dark:text-white-light",children:(l==null?void 0:l.label)||`Status ${e}`}),a("p",{className:"text-sm text-gray-500 dark:text-white-light mt-1",children:[n.status_counts[e]," leads"]})]})]}),t("div",{className:"relative h-40",children:t(k,{series:I(r),options:O(d.color),type:"area",height:160,className:"absolute bottom-0 w-full overflow-hidden"})})]},e)})}),a("div",{className:"grid lg:grid-cols-3 gap-6 mb-6",children:[a("div",{className:"panel h-full p-0 lg:col-span-2",children:[t("div",{className:"flex items-start justify-between dark:text-white-light mb-5 p-5 border-b border-white-light dark:border-[#1b2e4b]",children:t("h5",{className:"font-semibold text-lg",children:"Total leads Agent Wise"})}),t(k,{options:y.options,series:y.series,type:"bar",height:360,className:"overflow-hidden"})]}),a("div",{className:"panel h-full",children:[t("div",{className:"flex items-start justify-between dark:text-white-light mb-5 -mx-5 p-5 pt-0 border-b border-white-light dark:border-[#1b2e4b]",children:t("h5",{className:"font-semibold text-lg",children:"Last Activities Report"})}),t($,{className:"perfect-scrollbar relative h-[360px] ltr:pr-3 rtl:pl-3 ltr:-mr-3 rtl:-ml-3",children:t("div",{className:"space-y-7",children:(w=n.recent_comments)==null?void 0:w.map(e=>{var i;return a("div",{className:"flex",children:[t("div",{className:"shrink-0 ltr:mr-2 rtl:ml-2 relative z-10 before:w-[2px] before:h-[calc(100%-24px)] before:bg-white-dark/30 before:absolute before:top-10 before:left-4",children:t("div",{className:"bg-primary shadow-primary w-8 h-8 rounded-full flex items-center justify-center text-white",children:t(z,{className:"w-4 h-4"})})}),a("div",{children:[a("h5",{className:"font-semibold dark:text-white-light",children:[" ",e.lead_comment," "]}),a("p",{className:"text-white-dark text-xs",children:["Lead : ",e.lead.lead_title," | ",e.created_at]}),t("span",{className:"badge bg-success text-white",children:e.agent_id?a(M,{children:[" ",((i=e==null?void 0:e.agents)==null?void 0:i.client_user_name)||"Null"," "]}):t("span",{className:"badge bg-success text-white",children:"No Agent Assigned"})})]})]},e.lead_comment_id)})})})]})]})]}),t(R,{isOpen:j,onClose:()=>h(!1),onFilterUpdate:A,initialFilters:o,leadId:null,onSuccess:()=>{}})]}):t("div",{className:"text-center py-10",children:"No data available"})};export{Z as default};
