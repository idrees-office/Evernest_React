import{X as u,u as K,r as n,s as W,Y as d,S as y,j as t,a as o}from"./index-7d85d366.js";import{o as E}from"./status-5ce75f11.js";import{S as $}from"./react-select.esm-bd6a1f5d.js";import{I as Z}from"./IconTrashLines-241e7a79.js";import{I as ee}from"./IconPencil-8b9bb90b.js";import{T as te}from"./Table-33825ce1.js";import"./IconSquareCheck-7aa0ac6d.js";import"./IconStar-4d98d836.js";import"./IconTrash-7570fdcf.js";import"./objectWithoutPropertiesLoose-f3b3ace0.js";import"./extends-4c19d496.js";import"./floating-ui.dom.browser.min-b8726d47.js";import"./index-8e417d38.js";const m={createApi:`${u()}/users/create_user`,roleApi:`${u()}/users/get_user_role?for_select=1`,listApi:`${u()}/users/user_list`,destoryApi:`${u()}/users/delete_user`,updateApi:`${u()}/users/update_user`},he=()=>{const b=K(),c=n.useRef({userformRef:null}),[F,T]=n.useState([]),[U,h]=n.useState(null),[r,R]=n.useState({}),[D,k]=n.useState(null),[B,p]=n.useState(null),C=n.useRef(!1),[f,g]=n.useState(1),[w,I]=n.useState(10),[j,L]=n.useState(0),[_,z]=n.useState({columnAccessor:"client_user_id",direction:"asc"}),[x,O]=n.useState("");n.useEffect(()=>{C.current||(b(W("Create User")),Y(),C.current=!0)},[b]),n.useEffect(()=>{N()},[f,w,_,x]);const Y=async()=>{var e;try{const s=await d.get(m.roleApi);if(s.data){const a=s.data.map(l=>({value:l.id,label:l.name}));k(a)}}catch(s){((e=s.response)==null?void 0:e.status)===403&&(window.location.href="/error")}},N=async()=>{var e;try{const s={page:f,per_page:w,sort_field:_.columnAccessor,sort_order:_.direction,search:x},a=await d.get(m.listApi,{params:s});a.data&&(T(a.data.data.data||[]),L(a.data.data.total||0))}catch(s){((e=s.response)==null?void 0:e.status)===403&&(window.location.href="/error"),S()}},Q=async e=>{var s,a,l;e.preventDefault();try{if(c.current.userformRef){const i=new FormData(c.current.userformRef),A=i.get("client_user_id"),v=A?await d.post(`${m.updateApi}/${A}`,i):await d.post(m.createApi,i);(v.status===200||v.status===201)&&(P(v.data.message),N(),R({}),c.current.userformRef.reset(),p(null),h(null))}}catch(i){(a=(s=i.response)==null?void 0:s.data)!=null&&a.errors?R(i.response.data.errors):((l=i.response)==null?void 0:l.status)===403?window.location.href="/error":S()}},P=e=>{y.fire({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,title:e,icon:"success"})},S=()=>{y.fire({text:"Something went wrong on the server",icon:"error",title:"Server Error"})},q=async e=>{if(c.current.userformRef){const s=c.current.userformRef;s.reset(),s.client_user_id.value=e.client_user_id||"",s.client_user_name.value=e.client_user_name||"",s.client_user_email.value=e.client_user_email||"",s.client_user_phone.value=e.client_user_phone||"",s.client_user_designation.value=e.client_user_designation||"",s.client_sort_order.value=e.client_sort_order||"",h(e.client_user_status||"");const a=e.roles&&e.roles[0];if(a){const l={value:a.id,label:a.name};p(l)}else p(null)}},H=async e=>{var a;if((await y.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",cancelButtonText:"No, cancel!"})).isConfirmed)try{const l=await d.delete(m.destoryApi+`/${e.client_user_id}`);(l.status===200||l.status===201)&&(P("User deleted successfully"),N())}catch(l){((a=l.response)==null?void 0:a.status)===403&&(window.location.href="/error"),S()}},M=e=>{p(e)},V=e=>{O(e.target.value),g(1)},X=e=>{g(e)},G=e=>{I(e),g(1)},J=[{accessor:"client_user_id",title:"#",width:80,key:"id"},{accessor:"client_user_name",title:"Name",sortable:!0,key:"client_user_name_column"},{accessor:"client_user_email",title:"Email",sortable:!0,key:"email-column"},{accessor:"actions",title:"Actions",width:120,key:"actions-column",render:e=>o("div",{className:"flex space-x-2",children:[t("button",{type:"button",onClick:()=>q(e),className:"btn px-1 py-0.5 rounded text-white bg-info",children:t(ee,{})},`edit-${e.client_user_id}`),t("button",{type:"button",onClick:()=>H(e),className:"btn px-1 py-0.5 rounded text-white bg-red-600",children:t(Z,{})},`delete-${e.client_user_id}`)]})}];return t("form",{ref:e=>c.current.userformRef=e,onSubmit:Q,className:"space-y-5",children:o("div",{className:"flex flex-wrap -mx-4",children:[t("div",{className:"w-full lg:w-1/3 px-4",children:t("div",{className:"panel",children:t("div",{className:"panel-body",children:o("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[o("div",{className:"form-group",children:[t("label",{htmlFor:"client_user_name",children:"Username"}),t("input",{name:"client_user_name",type:"text",placeholder:"Username",className:"form-input"}),t("input",{type:"hidden",name:"client_user_id",id:"client_user_id"}),r.client_user_name&&t("span",{className:"text-red-500 text-sm",children:r.client_user_name})]}),o("div",{className:"form-group",children:[t("label",{htmlFor:"client_user_phone",children:"Phone"}),t("input",{name:"client_user_phone",type:"tel",placeholder:"Phone",className:"form-input"}),r.client_user_phone&&t("span",{className:"text-red-500 text-sm",children:r.client_user_phone})]}),o("div",{className:"form-group",children:[t("label",{htmlFor:"client_user_designation",children:"Designation"}),t("input",{name:"client_user_designation",type:"text",placeholder:"Designation",className:"form-input"}),r.client_user_designation&&t("span",{className:"text-red-500 text-sm",children:r.client_user_designation})]}),o("div",{className:"form-group",children:[t("label",{htmlFor:"client_user_email",children:"Email"}),t("input",{name:"client_user_email",type:"email",placeholder:"Email",className:"form-input"}),r.client_user_email&&t("span",{className:"text-red-500 text-sm",children:r.client_user_email})]}),o("div",{className:"form-group",children:[t("label",{htmlFor:"password",children:"Password"}),t("input",{name:"password",type:"password",placeholder:"Password",className:"form-input"}),r.password&&t("span",{className:"text-red-500 text-sm",children:r.password})]}),o("div",{className:"form-group",children:[t("label",{htmlFor:"client_user_status",children:"Status"}),t($,{name:"client_user_status",placeholder:"Select an option",options:E,value:E.find(e=>e.value===U),onChange:e=>h((e==null?void 0:e.value)||null)}),r.client_user_status&&t("span",{className:"text-red-500 text-sm",children:r.client_user_status})]}),o("div",{className:"form-group",children:[t("label",{htmlFor:"client_sort_order",children:"Sort Order"}),t("input",{name:"client_sort_order",type:"text",placeholder:"Sort Order",className:"form-input"}),r.client_sort_order&&t("span",{className:"text-red-500 text-sm",children:r.client_sort_order})]}),o("div",{className:"form-group",children:[t("label",{htmlFor:"role_id",children:"Role"}),t($,{name:"role_id",placeholder:"Select an option",options:D||[],value:B,onChange:M}),r.role_id&&t("span",{className:"text-red-500 text-sm",children:r.role_id})]}),t("div",{className:"sm:col-span-2 flex justify-end",children:t("button",{type:"submit",className:"btn btn-primary",children:"Submit"})})]})})})}),t("div",{className:"w-full lg:w-2/3 px-2 mt-6 lg:mt-0 md-mt-0",children:t("div",{className:"datatables",children:t(te,{columns:J,rows:F,title:"List of all Users",idAccessor:"client_user_id",totalRecords:j,currentPage:f,recordsPerPage:w,onPageChange:X,onRecordsPerPageChange:G,onSortChange:z,onSearchChange:V,sortStatus:_,isLoading:!1,minHeight:200,noRecordsText:"No users found",searchValue:x})})})]})})};export{he as default};
