import{u as j,c as O,T as W,r as c,b as Y,s as $,a2 as h,a as u,j as s,a0 as V,S as q,a1 as G}from"./index-6e6d1ce1.js";import{T as H}from"./Table-f83c021d.js";import{I as J}from"./IconBell-815881d9.js";import{I as K}from"./IconPlus-7d18cc24.js";import{I as Q}from"./IconTrash-99a4db60.js";import{S as X}from"./react-select.esm-0a7bdeea.js";import{L as Z}from"./LeadModal-320bb095.js";/* empty css                  */import"./index-61720e5b.js";import"./floating-ui.dom.browser.min-b8726d47.js";import"./extends-4c19d496.js";import"./objectWithoutPropertiesLoose-f3b3ace0.js";import"./transition-c4f8190f.js";const fe=()=>{const n=j();O();const l=W();c.useRef({fetched:!1,form:null,prevPage:1,prevPerPage:10,prevSortStatus:{columnAccessor:"id",direction:"desc"}});const[N,p]=c.useState(!1),[t,f]=c.useState(new Set),[ee,g]=c.useState(!0),[x,v]=c.useState(!1),[i,P]=c.useState(""),[o,A]=c.useState({columnAccessor:"id",direction:"desc"}),{leads:S,loading:C,agents:w,total:_,last_page:se,current_page:y,per_page:b}=Y(e=>e.leadslices);c.useEffect(()=>{n($("Re-Assign Leads")),T()},[n,y,b,o,i]);const T=()=>{n(h({page:i?1:y,perPage:b,sortField:o.columnAccessor,sortOrder:o.direction,search:i}))},I=(w==null?void 0:w.map(e=>({value:e==null?void 0:e.client_user_id,label:e==null?void 0:e.client_user_name,phone:e==null?void 0:e.client_user_phone})))||[],m=c.useMemo(()=>(Array.isArray(S)?S:[]).map(e=>({id:e.lead_id||"Unknown",title:e.lead_title||"Unknown",name:e.customer_name||"Unknown",phone:e.customer_phone||"Unknown",source:e.lead_source||"Unknown",date:e.updated_at||"Unknown"})),[S]),z=()=>{v(!0)},D=(e,a)=>{const r=new Set(t);a?r.add(e.id):r.delete(e.id),f(r),g(r.size===0),p(!1)},F=e=>{const a=new Set(t);e?m.forEach(r=>a.add(r.id)):m.forEach(r=>a.delete(r.id)),f(a),g(a.size===0),p(e)},L=async(e,a)=>{if(t.size===0){l.error("Please select at least one lead to assign");return}const r=new FormData;Array.from(t).forEach(d=>r.append("lead_id[]",d)),r.append("agent_id",e.toString()),r.append("agent_phone",a.toString());try{const d=await n(V({formData:r}));(d.payload.status===200||d.payload.status===201)&&(l.success(`${t.size} leads have been assigned successfully`),f(new Set),g(!0),p(!1))}catch{l.error("Failed to assign leads")}},R=async()=>{if(t.size===0){l.error("Please select at least one lead to remove");return}if((await q.fire({title:"Are you sure?",text:`You are about to remove ${t.size} selected lead(s). This action cannot be undone.`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel"})).isConfirmed)try{const a=new FormData;Array.from(t).forEach(d=>a.append("lead_id[]",d));const r=await n(G({formData:a}));r.payload.status===200||r.payload.status===201?(l.success(`${t.size} leads removed successfully`),f(new Set),g(!0),p(!1)):l.error("Failed to remove leads. Please try again.")}catch{l.error("An error occurred while removing leads.")}},B=e=>{n(h({page:e,sortField:o.columnAccessor,sortOrder:o.direction,search:i}))},U=e=>{n(h({perPage:e,sortField:o.columnAccessor,sortOrder:o.direction,search:i}))},E=e=>{A(e),n(h({sortField:e.columnAccessor,sortOrder:e.direction,search:i}))},M=e=>{const a=e.target.value;P(a),n(h({page:1,perPage:b,sortField:o.columnAccessor,sortOrder:o.direction,search:a}))},k=[{accessor:"id",title:u("div",{className:"flex items-center",children:[s("input",{type:"checkbox",className:"form-checkbox mr-2",checked:N||m.length>0&&m.every(e=>t.has(e.id)),onChange:e=>F(e.target.checked)}),"Select",t.size>0&&u("span",{className:"ml-2 text-xs",children:["(",t.size," selected)"]})]}),sortable:!1,render:e=>s("input",{type:"checkbox",className:"form-checkbox",checked:t.has(e.id),onChange:a=>D(e,a.target.checked)})},{accessor:"title",title:"Title",sortable:!0},{accessor:"name",title:"Name",sortable:!0},{accessor:"phone",title:"Phone",sortable:!0},{accessor:"source",title:"Source",sortable:!0,render:e=>{switch(e.source){case"Facebook":return s("span",{className:"badge bg-info",children:"Facebook"});case"Instagram":return s("span",{className:"badge bg-secondary",children:"Instagram"});case"created own":return s("span",{className:"badge bg-success",children:"Created own"});case"Website":return s("span",{className:"badge bg-warning",children:"Website"});case"Reshuffle":return s("span",{className:"badge bg-primary",children:"Reshuffle"});case"Walk-in":return s("span",{className:"badge bg-danger",children:"Walk-in"});case"Other":return s("span",{className:"badge bg-secondary",children:"Other"});default:return s("span",{className:"badge bg-secondary",children:"Unknown"})}}},{accessor:"date",title:"Date",sortable:!0}];return u("div",{children:[u("div",{className:"panel flex items-center justify-between overflow-visible whitespace-nowrap p-3 text-dark relative",children:[u("div",{className:"flex items-center",children:[s("div",{className:"rounded-full bg-primary p-1.5 text-white ring-2 ring-primary/30 ltr:mr-3 rtl:ml-3",children:s(J,{})}),s("span",{className:"ltr:mr-3 rtl:ml-3",children:"Details of Your New Leads: "}),u("button",{onClick:z,className:"btn btn-success btn-sm",children:[s(K,{})," Add Lead"]})]}),u("div",{className:"flex items-center space-x-2",children:[s(X,{placeholder:"Select an option",options:I,isDisabled:t.size===0,className:"cursor-pointer custom-multiselect z-10 w-[300px]",onChange:e=>{(e==null?void 0:e.value)!==void 0&&L(e.value,e.phone)}}),s("button",{onClick:R,type:"button",className:"btn btn-default btn-sm",style:{background:"#d33",color:"#fff"},disabled:t.size===0,children:s(Q,{})})]})]}),s("div",{className:"datatables mt-6",children:s(H,{title:"Re-Assign Leads",columns:k||[],rows:m,totalRecords:_||0,currentPage:y,recordsPerPage:b,onPageChange:B,onRecordsPerPageChange:U,onSortChange:E,sortStatus:o,isLoading:C,onSearchChange:M,searchValue:i,noRecordsText:"No records found matching your search criteria"})}),s(Z,{isOpen:x,onClose:()=>v(!1)})]})};export{fe as default};
