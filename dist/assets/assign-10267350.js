import{u as O,T as B,r as i,b as P,s as M,a as g,F as U,j as s,$ as f,a0 as j,S as E,a1 as W}from"./index-84f84a7f.js";import{T as Y}from"./Table-f511d59f.js";import{I as V}from"./IconBell-285d7888.js";import{I as $}from"./IconPlus-815807b2.js";import{I as z}from"./IconTrash-28c264d9.js";import{S as H}from"./react-select.esm-547b7c98.js";import{L as q}from"./LeadModal-bd55d887.js";/* empty css                  */import"./index-f9fcc564.js";import"./floating-ui.dom.browser.min-b8726d47.js";import"./extends-4c19d496.js";import"./objectWithoutPropertiesLoose-f3b3ace0.js";import"./transition-1f05e38d.js";const he=()=>{const o=O(),d=B(),[u,m]=i.useState([]),[N,h]=i.useState(!0),[C,y]=i.useState(!1),[n,_]=i.useState(""),v=i.useRef({fetched:!1,form:null,prevPage:1,prevPerPage:10,prevSortStatus:{columnAccessor:"id",direction:"desc"}}),[r,k]=i.useState({columnAccessor:"id",direction:"desc"}),{leads:w,loading:x,agents:S,total:L,current_page:b,per_page:p}=P(e=>e.leadslices);P(e=>e.auth.user||{}),i.useEffect(()=>{o(M("New Leads"));const e=()=>{o(f({page:n?1:b,perPage:p,sortField:r.columnAccessor,sortOrder:r.direction,search:n}))};if(!v.current.fetched){e(),v.current.fetched=!0;return}},[o,b,p,r,n]);const A=(S==null?void 0:S.map(e=>({value:e==null?void 0:e.client_user_id,label:e==null?void 0:e.client_user_name,phone:e==null?void 0:e.client_user_phone,customLabel:g(U,{children:[e==null?void 0:e.client_user_name,(e==null?void 0:e.client_user_designation)&&s("span",{style:{marginLeft:8},children:s("span",{className:"badge bg-success",style:{color:"#fff"},children:e.client_user_designation})})]})})))||[],F=({label:e,customLabel:a})=>a||e,T=i.useMemo(()=>(Array.isArray(w)?w:[]).map(e=>({id:e.lead_id||"Unknown",title:e.lead_title||"Unknown",name:e.customer_name||"Unknown",phone:e.customer_phone||"Unknown",source:e.lead_source||"Unknown",date:e.created_at})),[w]),D=()=>{y(!0)},I=(e,a)=>{a?(m(l=>[...l,e]),h(!1)):(m(l=>l.filter(c=>c.id!==e.id)),u.length===1&&h(!0))},R=async(e,a)=>{if(u.length===0){d.error("Please select at least one lead to assign");return}const l=u.map(t=>t.id),c=new FormData;l.forEach(t=>c.append("lead_id[]",t)),c.append("agent_id",e.toString()),c.append("agent_phone",a.toString());try{const t=await o(j({formData:c}));(t.payload.status===200||t.payload.status===201)&&(d.success("Leads Have Been Assigned Successfully"),m([]),h(!0),o(f({page:n?1:b,perPage:p,sortField:r.columnAccessor,sortOrder:r.direction,search:n})))}catch{d.error("Failed to assign leads")}};return g("div",{children:[g("div",{className:"panel flex items-center justify-between overflow-visible whitespace-nowrap p-3 text-dark relative",children:[g("div",{className:"flex items-center",children:[s("div",{className:"rounded-full bg-primary p-1.5 text-white ring-2 ring-primary/30 ltr:mr-3 rtl:ml-3",children:s(V,{})}),s("span",{className:"ltr:mr-3 rtl:ml-3",children:"Details of Your New Leads: "}),g("button",{onClick:D,className:"btn btn-success btn-sm",children:[s($,{})," Add Lead"]})]}),g("div",{className:"flex items-center space-x-2",children:[s(H,{placeholder:"Select an option",options:A,isDisabled:N,className:"cursor-pointer custom-multiselect z-10 w-[300px]",formatOptionLabel:F,getOptionLabel:e=>e.label,getOptionValue:e=>e.value,onChange:e=>{(e==null?void 0:e.value)!==void 0&&R(e.value,e.phone)}}),s("button",{onClick:async()=>{if(u.length===0){d.error("Please select at least one lead to remove");return}if((await E.fire({title:"Are you sure?",text:`You are about to remove ${u.length} selected lead(s). This action cannot be undone.`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel"})).isConfirmed)try{const a=u.map(t=>t.id),l=new FormData;a.forEach(t=>l.append("lead_id[]",t));const c=await o(W({formData:l}));c.payload.status===200||c.payload.status===201?(d.success("Lead removed successfully"),m([]),h(!0)):d.error("Failed to remove leads. Please try again.")}catch{d.error("An error occurred while removing leads.")}},type:"button",className:"btn btn-default btn-sm",style:{background:"#d33",color:"#fff"},children:s(z,{})})]})]}),s("div",{className:"datatables mt-6",children:s(Y,{title:"New Leads",columns:[{accessor:"id",title:"Select",sortable:!1,render:e=>s("input",{type:"checkbox",className:"form-checkbox",checked:u.some(a=>a.id===e.id),onChange:a=>I(e,a.target.checked)})},{accessor:"title",title:"Title",sortable:!0},{accessor:"name",title:"Name",sortable:!0},{accessor:"phone",title:"Phone",sortable:!0},{accessor:"source",title:"Source",sortable:!0,render:e=>{switch(e.source){case"Facebook":return s("span",{className:"badge bg-info",children:"Facebook"});case"Instagram":return s("span",{className:"badge bg-secondary",children:"Instagram"});case"created own":return s("span",{className:"badge bg-success",children:"Created own"});case"Website":return s("span",{className:"badge bg-warning",children:"Website"});case"Reshuffle":return s("span",{className:"badge bg-primary",children:"Reshuffle"});case"Walk-in":return s("span",{className:"badge bg-danger",children:"Walk-in"});case"Marketing":return s("span",{className:"badge bg-success",children:"Marketing"});case"Other":return s("span",{className:"badge bg-secondary",children:"Other"});default:return s("span",{className:"badge bg-secondary",children:"Unknown"})}}},{accessor:"date",title:"Date",sortable:!0}],rows:T,totalRecords:L||0,currentPage:b,recordsPerPage:p,onPageChange:e=>{o(f({page:e,sortField:r.columnAccessor,sortOrder:r.direction,search:n})),m([]),h(!0)},onRecordsPerPageChange:e=>{o(f({perPage:e,sortField:r.columnAccessor,sortOrder:r.direction,search:n})),m([]),h(!0)},onSortChange:e=>{k(e),o(f({page:1,perPage:p,sortField:r.columnAccessor,sortOrder:r.direction,search:n}))},sortStatus:r,isLoading:x,onSearchChange:e=>{const a=e.target.value;_(a),o(f({page:1,perPage:p,sortField:r.columnAccessor,sortOrder:r.direction,search:a}))},searchValue:n,noRecordsText:"No records found matching your search criteria"})}),s(q,{isOpen:C,onClose:()=>y(!1)})]})};export{he as default};
