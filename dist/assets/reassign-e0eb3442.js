import{u as O,c as j,T as W,r as l,b as Y,s as $,a2 as m,a as u,j as s,a0 as V,S as q,a1 as G}from"./index-b77f25f2.js";import{T as H}from"./Table-e7e3a632.js";import{I as J}from"./IconBell-2b00178e.js";import{I as K}from"./IconPlus-51ee374a.js";import{I as Q}from"./IconTrash-03544b6c.js";import{S as X}from"./react-select.esm-da870a24.js";import{L as Z}from"./LeadModal-3beec7b4.js";/* empty css                  */import"./index-4b5e6f93.js";import"./floating-ui.dom.browser.min-b8726d47.js";import"./extends-4c19d496.js";import"./objectWithoutPropertiesLoose-f3b3ace0.js";import"./transition-96472d1d.js";const fe=()=>{const c=O();j();const i=W();l.useRef({fetched:!1,form:null,prevPage:1,prevPerPage:10,prevSortStatus:{columnAccessor:"id",direction:"desc"}});const[N,f]=l.useState(!1),[t,g]=l.useState(new Set),[ee,b]=l.useState(!0),[x,v]=l.useState(!1),[n,P]=l.useState(""),[o,A]=l.useState({columnAccessor:"id",direction:"desc"}),{leads:w,loading:C,agents:y,total:_,last_page:se,current_page:S,per_page:h}=Y(e=>e.leadslices);l.useEffect(()=>{c($("Re-Assign Leads")),T()},[c,S,h,o,n]);const T=()=>{c(m({page:n?1:S,perPage:h,sortField:o.columnAccessor,sortOrder:o.direction,search:n}))},I=(y==null?void 0:y.map(e=>({value:e==null?void 0:e.client_user_id,label:e==null?void 0:e.client_user_name,phone:e==null?void 0:e.client_user_phone})))||[],p=l.useMemo(()=>(Array.isArray(w)?w:[]).map(e=>({id:e.lead_id||"Unknown",title:e.lead_title||"Unknown",name:e.customer_name||"Unknown",phone:e.customer_phone||"Unknown",source:e.lead_source||"Unknown",date:e.updated_at||"Unknown"})),[w]),z=()=>{v(!0)},F=(e,a)=>{const r=new Set(t);a?r.add(e.id):r.delete(e.id),g(r),b(r.size===0),f(!1)},D=e=>{const a=new Set(t);e?p.forEach(r=>a.add(r.id)):p.forEach(r=>a.delete(r.id)),g(a),b(a.size===0),f(e)},L=async(e,a)=>{if(t.size===0){i.error("Please select at least one lead to assign");return}const r=new FormData;Array.from(t).forEach(d=>r.append("lead_id[]",d)),r.append("agent_id",e.toString()),r.append("agent_phone",a.toString());try{const d=await c(V({formData:r}));(d.payload.status===200||d.payload.status===201)&&(i.success(`${t.size} leads have been assigned successfully`),g(new Set),b(!0),f(!1),c(m({page:n?1:S,perPage:h,sortField:o.columnAccessor,sortOrder:o.direction,search:n})))}catch{i.error("Failed to assign leads")}},R=async()=>{if(t.size===0){i.error("Please select at least one lead to remove");return}if((await q.fire({title:"Are you sure?",text:`You are about to remove ${t.size} selected lead(s). This action cannot be undone.`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel"})).isConfirmed)try{const a=new FormData;Array.from(t).forEach(d=>a.append("lead_id[]",d));const r=await c(G({formData:a}));r.payload.status===200||r.payload.status===201?(i.success(`${t.size} leads removed successfully`),g(new Set),b(!0),f(!1)):i.error("Failed to remove leads. Please try again.")}catch{i.error("An error occurred while removing leads.")}},B=e=>{c(m({page:e,sortField:o.columnAccessor,sortOrder:o.direction,search:n}))},U=e=>{c(m({perPage:e,sortField:o.columnAccessor,sortOrder:o.direction,search:n}))},E=e=>{A(e),c(m({sortField:e.columnAccessor,sortOrder:e.direction,search:n}))},M=e=>{const a=e.target.value;P(a),c(m({page:1,perPage:h,sortField:o.columnAccessor,sortOrder:o.direction,search:a}))},k=[{accessor:"id",title:u("div",{className:"flex items-center",children:[s("input",{type:"checkbox",className:"form-checkbox mr-2",checked:N||p.length>0&&p.every(e=>t.has(e.id)),onChange:e=>D(e.target.checked)}),"Select",t.size>0&&u("span",{className:"ml-2 text-xs",children:["(",t.size," selected)"]})]}),sortable:!1,render:e=>s("input",{type:"checkbox",className:"form-checkbox",checked:t.has(e.id),onChange:a=>F(e,a.target.checked)})},{accessor:"title",title:"Title",sortable:!0},{accessor:"name",title:"Name",sortable:!0},{accessor:"phone",title:"Phone",sortable:!0},{accessor:"source",title:"Source",sortable:!0,render:e=>{switch(e.source){case"Facebook":return s("span",{className:"badge bg-info",children:"Facebook"});case"Instagram":return s("span",{className:"badge bg-secondary",children:"Instagram"});case"created own":return s("span",{className:"badge bg-success",children:"Created own"});case"Website":return s("span",{className:"badge bg-warning",children:"Website"});case"Reshuffle":return s("span",{className:"badge bg-primary",children:"Reshuffle"});case"Walk-in":return s("span",{className:"badge bg-danger",children:"Walk-in"});case"Other":return s("span",{className:"badge bg-secondary",children:"Other"});default:return s("span",{className:"badge bg-secondary",children:"Unknown"})}}},{accessor:"date",title:"Date",sortable:!0}];return u("div",{children:[u("div",{className:"panel flex items-center justify-between overflow-visible whitespace-nowrap p-3 text-dark relative",children:[u("div",{className:"flex items-center",children:[s("div",{className:"rounded-full bg-primary p-1.5 text-white ring-2 ring-primary/30 ltr:mr-3 rtl:ml-3",children:s(J,{})}),s("span",{className:"ltr:mr-3 rtl:ml-3",children:"Details of Your New Leads: "}),u("button",{onClick:z,className:"btn btn-success btn-sm",children:[s(K,{})," Add Lead"]})]}),u("div",{className:"flex items-center space-x-2",children:[s(X,{placeholder:"Select an option",options:I,isDisabled:t.size===0,className:"cursor-pointer custom-multiselect z-10 w-[300px]",onChange:e=>{(e==null?void 0:e.value)!==void 0&&L(e.value,e.phone)}}),s("button",{onClick:R,type:"button",className:"btn btn-default btn-sm",style:{background:"#d33",color:"#fff"},disabled:t.size===0,children:s(Q,{})})]})]}),s("div",{className:"datatables mt-6",children:s(H,{title:"Re-Assign Leads",columns:k||[],rows:p,totalRecords:_||0,currentPage:S,recordsPerPage:h,onPageChange:B,onRecordsPerPageChange:U,onSortChange:E,sortStatus:o,isLoading:C,onSearchChange:M,searchValue:n,noRecordsText:"No records found matching your search criteria"})}),s(Z,{isOpen:x,onClose:()=>v(!1)})]})};export{fe as default};
